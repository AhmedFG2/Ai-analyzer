import{b as cf,r as df,s as Hm,e as Km}from"./tensorflow-DJoy86qR.js";import{c as jm}from"./models-BWMAVmp2.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var ff={exports:{}},mo={},hf={exports:{}},re={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Di=Symbol.for("react.element"),zm=Symbol.for("react.portal"),Wm=Symbol.for("react.fragment"),Ym=Symbol.for("react.strict_mode"),qm=Symbol.for("react.profiler"),Xm=Symbol.for("react.provider"),Qm=Symbol.for("react.context"),Jm=Symbol.for("react.forward_ref"),Zm=Symbol.for("react.suspense"),eg=Symbol.for("react.memo"),tg=Symbol.for("react.lazy"),Qu=Symbol.iterator;function ng(n){return n===null||typeof n!="object"?null:(n=Qu&&n[Qu]||n["@@iterator"],typeof n=="function"?n:null)}var mf={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},gf=Object.assign,pf={};function Fr(n,e,t){this.props=n,this.context=e,this.refs=pf,this.updater=t||mf}Fr.prototype.isReactComponent={};Fr.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Fr.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function yf(){}yf.prototype=Fr.prototype;function Ml(n,e,t){this.props=n,this.context=e,this.refs=pf,this.updater=t||mf}var Ul=Ml.prototype=new yf;Ul.constructor=Ml;gf(Ul,Fr.prototype);Ul.isPureReactComponent=!0;var Ju=Array.isArray,vf=Object.prototype.hasOwnProperty,Bl={current:null},xf={key:!0,ref:!0,__self:!0,__source:!0};function Ef(n,e,t){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)vf.call(e,r)&&!xf.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Di,type:n,key:s,ref:o,props:i,_owner:Bl.current}}function rg(n,e){return{$$typeof:Di,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function $l(n){return typeof n=="object"&&n!==null&&n.$$typeof===Di}function ig(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Zu=/\/+/g;function Po(n,e){return typeof n=="object"&&n!==null&&n.key!=null?ig(""+n.key):e.toString(36)}function fs(n,e,t,r,i){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case Di:case zm:o=!0}}if(o)return o=n,i=i(o),n=r===""?"."+Po(o,0):r,Ju(i)?(t="",n!=null&&(t=n.replace(Zu,"$&/")+"/"),fs(i,e,t,"",function(u){return u})):i!=null&&($l(i)&&(i=rg(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(Zu,"$&/")+"/")+n)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Ju(n))for(var a=0;a<n.length;a++){s=n[a];var l=r+Po(s,a);o+=fs(s,e,t,l,i)}else if(l=ng(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=r+Po(s,a++),o+=fs(s,e,t,l,i);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ni(n,e,t){if(n==null)return n;var r=[],i=0;return fs(n,r,"","",function(s){return e.call(t,s,i++)}),r}function sg(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Xe={current:null},hs={transition:null},og={ReactCurrentDispatcher:Xe,ReactCurrentBatchConfig:hs,ReactCurrentOwner:Bl};function Sf(){throw Error("act(...) is not supported in production builds of React.")}re.Children={map:Ni,forEach:function(n,e,t){Ni(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Ni(n,function(){e++}),e},toArray:function(n){return Ni(n,function(e){return e})||[]},only:function(n){if(!$l(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};re.Component=Fr;re.Fragment=Wm;re.Profiler=qm;re.PureComponent=Ml;re.StrictMode=Ym;re.Suspense=Zm;re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=og;re.act=Sf;re.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=gf({},n.props),i=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Bl.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)vf.call(e,l)&&!xf.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:Di,type:n.type,key:i,ref:s,props:r,_owner:o}};re.createContext=function(n){return n={$$typeof:Qm,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Xm,_context:n},n.Consumer=n};re.createElement=Ef;re.createFactory=function(n){var e=Ef.bind(null,n);return e.type=n,e};re.createRef=function(){return{current:null}};re.forwardRef=function(n){return{$$typeof:Jm,render:n}};re.isValidElement=$l;re.lazy=function(n){return{$$typeof:tg,_payload:{_status:-1,_result:n},_init:sg}};re.memo=function(n,e){return{$$typeof:eg,type:n,compare:e===void 0?null:e}};re.startTransition=function(n){var e=hs.transition;hs.transition={};try{n()}finally{hs.transition=e}};re.unstable_act=Sf;re.useCallback=function(n,e){return Xe.current.useCallback(n,e)};re.useContext=function(n){return Xe.current.useContext(n)};re.useDebugValue=function(){};re.useDeferredValue=function(n){return Xe.current.useDeferredValue(n)};re.useEffect=function(n,e){return Xe.current.useEffect(n,e)};re.useId=function(){return Xe.current.useId()};re.useImperativeHandle=function(n,e,t){return Xe.current.useImperativeHandle(n,e,t)};re.useInsertionEffect=function(n,e){return Xe.current.useInsertionEffect(n,e)};re.useLayoutEffect=function(n,e){return Xe.current.useLayoutEffect(n,e)};re.useMemo=function(n,e){return Xe.current.useMemo(n,e)};re.useReducer=function(n,e,t){return Xe.current.useReducer(n,e,t)};re.useRef=function(n){return Xe.current.useRef(n)};re.useState=function(n){return Xe.current.useState(n)};re.useSyncExternalStore=function(n,e,t){return Xe.current.useSyncExternalStore(n,e,t)};re.useTransition=function(){return Xe.current.useTransition()};re.version="18.3.1";hf.exports=re;var ne=hf.exports;const ag=cf(ne);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lg=ne,ug=Symbol.for("react.element"),cg=Symbol.for("react.fragment"),dg=Object.prototype.hasOwnProperty,fg=lg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hg={key:!0,ref:!0,__self:!0,__source:!0};function Tf(n,e,t){var r,i={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)dg.call(e,r)&&!hg.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ug,type:n,key:s,ref:o,props:i,_owner:fg.current}}mo.Fragment=cg;mo.jsx=Tf;mo.jsxs=Tf;ff.exports=mo;var D=ff.exports,Lf={exports:{}},dt={},Af={exports:{}},Rf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(O,P){var _=O.length;O.push(P);e:for(;0<_;){var W=_-1>>>1,j=O[W];if(0<i(j,P))O[W]=P,O[_]=j,_=W;else break e}}function t(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var P=O[0],_=O.pop();if(_!==P){O[0]=_;e:for(var W=0,j=O.length,te=j>>>1;W<te;){var oe=2*(W+1)-1,pe=O[oe],ce=oe+1,de=O[ce];if(0>i(pe,_))ce<j&&0>i(de,pe)?(O[W]=de,O[ce]=_,W=ce):(O[W]=pe,O[oe]=_,W=oe);else if(ce<j&&0>i(de,_))O[W]=de,O[ce]=_,W=ce;else break e}}return P}function i(O,P){var _=O.sortIndex-P.sortIndex;return _!==0?_:O.id-P.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,d=null,f=3,m=!1,h=!1,g=!1,y=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(O){for(var P=t(u);P!==null;){if(P.callback===null)r(u);else if(P.startTime<=O)r(u),P.sortIndex=P.expirationTime,e(l,P);else break;P=t(u)}}function T(O){if(g=!1,E(O),!h)if(t(l)!==null)h=!0,K(S);else{var P=t(u);P!==null&&Q(T,P.startTime-O)}}function S(O,P){h=!1,g&&(g=!1,p(C),C=-1),m=!0;var _=f;try{for(E(P),d=t(l);d!==null&&(!(d.expirationTime>P)||O&&!F());){var W=d.callback;if(typeof W=="function"){d.callback=null,f=d.priorityLevel;var j=W(d.expirationTime<=P);P=n.unstable_now(),typeof j=="function"?d.callback=j:d===t(l)&&r(l),E(P)}else r(l);d=t(l)}if(d!==null)var te=!0;else{var oe=t(u);oe!==null&&Q(T,oe.startTime-P),te=!1}return te}finally{d=null,f=_,m=!1}}var A=!1,L=null,C=-1,N=5,w=-1;function F(){return!(n.unstable_now()-w<N)}function z(){if(L!==null){var O=n.unstable_now();w=O;var P=!0;try{P=L(!0,O)}finally{P?U():(A=!1,L=null)}}else A=!1}var U;if(typeof x=="function")U=function(){x(z)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,Y=V.port2;V.port1.onmessage=z,U=function(){Y.postMessage(null)}}else U=function(){y(z,0)};function K(O){L=O,A||(A=!0,U())}function Q(O,P){C=y(function(){O(n.unstable_now())},P)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(O){O.callback=null},n.unstable_continueExecution=function(){h||m||(h=!0,K(S))},n.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<O?Math.floor(1e3/O):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(O){switch(f){case 1:case 2:case 3:var P=3;break;default:P=f}var _=f;f=P;try{return O()}finally{f=_}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(O,P){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var _=f;f=O;try{return P()}finally{f=_}},n.unstable_scheduleCallback=function(O,P,_){var W=n.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?W+_:W):_=W,O){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=_+j,O={id:c++,callback:P,priorityLevel:O,startTime:_,expirationTime:j,sortIndex:-1},_>W?(O.sortIndex=_,e(u,O),t(l)===null&&O===t(u)&&(g?(p(C),C=-1):g=!0,Q(T,_-W))):(O.sortIndex=j,e(l,O),h||m||(h=!0,K(S))),O},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(O){var P=f;return function(){var _=f;f=P;try{return O.apply(this,arguments)}finally{f=_}}}})(Rf);Af.exports=Rf;var mg=Af.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gg=ne,ct=mg;function M(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var If=new Set,ui={};function Xn(n,e){Lr(n,e),Lr(n+"Capture",e)}function Lr(n,e){for(ui[n]=e,n=0;n<e.length;n++)If.add(e[n])}var nn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Da=Object.prototype.hasOwnProperty,pg=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ec={},tc={};function yg(n){return Da.call(tc,n)?!0:Da.call(ec,n)?!1:pg.test(n)?tc[n]=!0:(ec[n]=!0,!1)}function vg(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function xg(n,e,t,r){if(e===null||typeof e>"u"||vg(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qe(n,e,t,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var $e={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){$e[n]=new Qe(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];$e[e]=new Qe(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){$e[n]=new Qe(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){$e[n]=new Qe(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){$e[n]=new Qe(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){$e[n]=new Qe(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){$e[n]=new Qe(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){$e[n]=new Qe(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){$e[n]=new Qe(n,5,!1,n.toLowerCase(),null,!1,!1)});var Gl=/[\-:]([a-z])/g;function Vl(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Gl,Vl);$e[e]=new Qe(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Gl,Vl);$e[e]=new Qe(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Gl,Vl);$e[e]=new Qe(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){$e[n]=new Qe(n,1,!1,n.toLowerCase(),null,!1,!1)});$e.xlinkHref=new Qe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){$e[n]=new Qe(n,1,!1,n.toLowerCase(),null,!0,!0)});function Hl(n,e,t,r){var i=$e.hasOwnProperty(e)?$e[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(xg(e,t,i,r)&&(t=null),r||i===null?yg(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var an=gg.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Mi=Symbol.for("react.element"),rr=Symbol.for("react.portal"),ir=Symbol.for("react.fragment"),Kl=Symbol.for("react.strict_mode"),_a=Symbol.for("react.profiler"),wf=Symbol.for("react.provider"),Cf=Symbol.for("react.context"),jl=Symbol.for("react.forward_ref"),ba=Symbol.for("react.suspense"),Pa=Symbol.for("react.suspense_list"),zl=Symbol.for("react.memo"),dn=Symbol.for("react.lazy"),kf=Symbol.for("react.offscreen"),nc=Symbol.iterator;function $r(n){return n===null||typeof n!="object"?null:(n=nc&&n[nc]||n["@@iterator"],typeof n=="function"?n:null)}var Te=Object.assign,Fo;function qr(n){if(Fo===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Fo=e&&e[1]||""}return`
`+Fo+n}var Oo=!1;function No(n,e){if(!n||Oo)return"";Oo=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(n,[],e)}else{try{e.call()}catch(u){r=u}n.call(e.prototype)}else{try{throw Error()}catch(u){r=u}n()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{Oo=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?qr(n):""}function Eg(n){switch(n.tag){case 5:return qr(n.type);case 16:return qr("Lazy");case 13:return qr("Suspense");case 19:return qr("SuspenseList");case 0:case 2:case 15:return n=No(n.type,!1),n;case 11:return n=No(n.type.render,!1),n;case 1:return n=No(n.type,!0),n;default:return""}}function Fa(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ir:return"Fragment";case rr:return"Portal";case _a:return"Profiler";case Kl:return"StrictMode";case ba:return"Suspense";case Pa:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Cf:return(n.displayName||"Context")+".Consumer";case wf:return(n._context.displayName||"Context")+".Provider";case jl:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case zl:return e=n.displayName||null,e!==null?e:Fa(n.type)||"Memo";case dn:e=n._payload,n=n._init;try{return Fa(n(e))}catch{}}return null}function Sg(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fa(e);case 8:return e===Kl?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function In(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Df(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Tg(n){var e=Df(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ui(n){n._valueTracker||(n._valueTracker=Tg(n))}function _f(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Df(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function bs(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Oa(n,e){var t=e.checked;return Te({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function rc(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=In(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bf(n,e){e=e.checked,e!=null&&Hl(n,"checked",e,!1)}function Na(n,e){bf(n,e);var t=In(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Ma(n,e.type,t):e.hasOwnProperty("defaultValue")&&Ma(n,e.type,In(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function ic(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Ma(n,e,t){(e!=="number"||bs(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var Xr=Array.isArray;function pr(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+In(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Ua(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(M(91));return Te({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function sc(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(M(92));if(Xr(t)){if(1<t.length)throw Error(M(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:In(t)}}function Pf(n,e){var t=In(e.value),r=In(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function oc(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Ff(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ba(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Ff(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Bi,Of=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Bi=Bi||document.createElement("div"),Bi.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Bi.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function ci(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Zr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lg=["Webkit","ms","Moz","O"];Object.keys(Zr).forEach(function(n){Lg.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Zr[e]=Zr[n]})});function Nf(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Zr.hasOwnProperty(n)&&Zr[n]?(""+e).trim():e+"px"}function Mf(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=Nf(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var Ag=Te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $a(n,e){if(e){if(Ag[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(M(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(M(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(M(61))}if(e.style!=null&&typeof e.style!="object")throw Error(M(62))}}function Ga(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Va=null;function Wl(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Ha=null,yr=null,vr=null;function ac(n){if(n=Pi(n)){if(typeof Ha!="function")throw Error(M(280));var e=n.stateNode;e&&(e=xo(e),Ha(n.stateNode,n.type,e))}}function Uf(n){yr?vr?vr.push(n):vr=[n]:yr=n}function Bf(){if(yr){var n=yr,e=vr;if(vr=yr=null,ac(n),e)for(n=0;n<e.length;n++)ac(e[n])}}function $f(n,e){return n(e)}function Gf(){}var Mo=!1;function Vf(n,e,t){if(Mo)return n(e,t);Mo=!0;try{return $f(n,e,t)}finally{Mo=!1,(yr!==null||vr!==null)&&(Gf(),Bf())}}function di(n,e){var t=n.stateNode;if(t===null)return null;var r=xo(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(M(231,e,typeof t));return t}var Ka=!1;if(nn)try{var Gr={};Object.defineProperty(Gr,"passive",{get:function(){Ka=!0}}),window.addEventListener("test",Gr,Gr),window.removeEventListener("test",Gr,Gr)}catch{Ka=!1}function Rg(n,e,t,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var ei=!1,Ps=null,Fs=!1,ja=null,Ig={onError:function(n){ei=!0,Ps=n}};function wg(n,e,t,r,i,s,o,a,l){ei=!1,Ps=null,Rg.apply(Ig,arguments)}function Cg(n,e,t,r,i,s,o,a,l){if(wg.apply(this,arguments),ei){if(ei){var u=Ps;ei=!1,Ps=null}else throw Error(M(198));Fs||(Fs=!0,ja=u)}}function Qn(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Hf(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function lc(n){if(Qn(n)!==n)throw Error(M(188))}function kg(n){var e=n.alternate;if(!e){if(e=Qn(n),e===null)throw Error(M(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===t)return lc(i),n;if(s===r)return lc(i),e;s=s.sibling}throw Error(M(188))}if(t.return!==r.return)t=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===t){o=!0,t=i,r=s;break}if(a===r){o=!0,r=i,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,r=i;break}if(a===r){o=!0,r=s,t=i;break}a=a.sibling}if(!o)throw Error(M(189))}}if(t.alternate!==r)throw Error(M(190))}if(t.tag!==3)throw Error(M(188));return t.stateNode.current===t?n:e}function Kf(n){return n=kg(n),n!==null?jf(n):null}function jf(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=jf(n);if(e!==null)return e;n=n.sibling}return null}var zf=ct.unstable_scheduleCallback,uc=ct.unstable_cancelCallback,Dg=ct.unstable_shouldYield,_g=ct.unstable_requestPaint,Re=ct.unstable_now,bg=ct.unstable_getCurrentPriorityLevel,Yl=ct.unstable_ImmediatePriority,Wf=ct.unstable_UserBlockingPriority,Os=ct.unstable_NormalPriority,Pg=ct.unstable_LowPriority,Yf=ct.unstable_IdlePriority,go=null,Ht=null;function Fg(n){if(Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(go,n,void 0,(n.current.flags&128)===128)}catch{}}var Dt=Math.clz32?Math.clz32:Mg,Og=Math.log,Ng=Math.LN2;function Mg(n){return n>>>=0,n===0?32:31-(Og(n)/Ng|0)|0}var $i=64,Gi=4194304;function Qr(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Ns(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~i;a!==0?r=Qr(a):(s&=o,s!==0&&(r=Qr(s)))}else o=t&~i,o!==0?r=Qr(o):s!==0&&(r=Qr(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Dt(e),i=1<<t,r|=n[t],e&=~i;return r}function Ug(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Bg(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-Dt(s),a=1<<o,l=i[o];l===-1?(!(a&t)||a&r)&&(i[o]=Ug(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function za(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function qf(){var n=$i;return $i<<=1,!($i&4194240)&&($i=64),n}function Uo(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function _i(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Dt(e),n[e]=t}function $g(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Dt(t),s=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~s}}function ql(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Dt(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var ue=0;function Xf(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Qf,Xl,Jf,Zf,eh,Wa=!1,Vi=[],vn=null,xn=null,En=null,fi=new Map,hi=new Map,mn=[],Gg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function cc(n,e){switch(n){case"focusin":case"focusout":vn=null;break;case"dragenter":case"dragleave":xn=null;break;case"mouseover":case"mouseout":En=null;break;case"pointerover":case"pointerout":fi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":hi.delete(e.pointerId)}}function Vr(n,e,t,r,i,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Pi(e),e!==null&&Xl(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function Vg(n,e,t,r,i){switch(e){case"focusin":return vn=Vr(vn,n,e,t,r,i),!0;case"dragenter":return xn=Vr(xn,n,e,t,r,i),!0;case"mouseover":return En=Vr(En,n,e,t,r,i),!0;case"pointerover":var s=i.pointerId;return fi.set(s,Vr(fi.get(s)||null,n,e,t,r,i)),!0;case"gotpointercapture":return s=i.pointerId,hi.set(s,Vr(hi.get(s)||null,n,e,t,r,i)),!0}return!1}function th(n){var e=Nn(n.target);if(e!==null){var t=Qn(e);if(t!==null){if(e=t.tag,e===13){if(e=Hf(t),e!==null){n.blockedOn=e,eh(n.priority,function(){Jf(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function ms(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Ya(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);Va=r,t.target.dispatchEvent(r),Va=null}else return e=Pi(t),e!==null&&Xl(e),n.blockedOn=t,!1;e.shift()}return!0}function dc(n,e,t){ms(n)&&t.delete(e)}function Hg(){Wa=!1,vn!==null&&ms(vn)&&(vn=null),xn!==null&&ms(xn)&&(xn=null),En!==null&&ms(En)&&(En=null),fi.forEach(dc),hi.forEach(dc)}function Hr(n,e){n.blockedOn===e&&(n.blockedOn=null,Wa||(Wa=!0,ct.unstable_scheduleCallback(ct.unstable_NormalPriority,Hg)))}function mi(n){function e(i){return Hr(i,n)}if(0<Vi.length){Hr(Vi[0],n);for(var t=1;t<Vi.length;t++){var r=Vi[t];r.blockedOn===n&&(r.blockedOn=null)}}for(vn!==null&&Hr(vn,n),xn!==null&&Hr(xn,n),En!==null&&Hr(En,n),fi.forEach(e),hi.forEach(e),t=0;t<mn.length;t++)r=mn[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<mn.length&&(t=mn[0],t.blockedOn===null);)th(t),t.blockedOn===null&&mn.shift()}var xr=an.ReactCurrentBatchConfig,Ms=!0;function Kg(n,e,t,r){var i=ue,s=xr.transition;xr.transition=null;try{ue=1,Ql(n,e,t,r)}finally{ue=i,xr.transition=s}}function jg(n,e,t,r){var i=ue,s=xr.transition;xr.transition=null;try{ue=4,Ql(n,e,t,r)}finally{ue=i,xr.transition=s}}function Ql(n,e,t,r){if(Ms){var i=Ya(n,e,t,r);if(i===null)Yo(n,e,r,Us,t),cc(n,r);else if(Vg(i,n,e,t,r))r.stopPropagation();else if(cc(n,r),e&4&&-1<Gg.indexOf(n)){for(;i!==null;){var s=Pi(i);if(s!==null&&Qf(s),s=Ya(n,e,t,r),s===null&&Yo(n,e,r,Us,t),s===i)break;i=s}i!==null&&r.stopPropagation()}else Yo(n,e,r,null,t)}}var Us=null;function Ya(n,e,t,r){if(Us=null,n=Wl(r),n=Nn(n),n!==null)if(e=Qn(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Hf(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Us=n,null}function nh(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bg()){case Yl:return 1;case Wf:return 4;case Os:case Pg:return 16;case Yf:return 536870912;default:return 16}default:return 16}}var pn=null,Jl=null,gs=null;function rh(){if(gs)return gs;var n,e=Jl,t=e.length,r,i="value"in pn?pn.value:pn.textContent,s=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(r=1;r<=o&&e[t-r]===i[s-r];r++);return gs=i.slice(n,1<r?1-r:void 0)}function ps(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Hi(){return!0}function fc(){return!1}function ft(n){function e(t,r,i,s,o){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Hi:fc,this.isPropagationStopped=fc,this}return Te(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Hi)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Hi)},persist:function(){},isPersistent:Hi}),e}var Or={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zl=ft(Or),bi=Te({},Or,{view:0,detail:0}),zg=ft(bi),Bo,$o,Kr,po=Te({},bi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Kr&&(Kr&&n.type==="mousemove"?(Bo=n.screenX-Kr.screenX,$o=n.screenY-Kr.screenY):$o=Bo=0,Kr=n),Bo)},movementY:function(n){return"movementY"in n?n.movementY:$o}}),hc=ft(po),Wg=Te({},po,{dataTransfer:0}),Yg=ft(Wg),qg=Te({},bi,{relatedTarget:0}),Go=ft(qg),Xg=Te({},Or,{animationName:0,elapsedTime:0,pseudoElement:0}),Qg=ft(Xg),Jg=Te({},Or,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Zg=ft(Jg),ep=Te({},Or,{data:0}),mc=ft(ep),tp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},np={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ip(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=rp[n])?!!e[n]:!1}function eu(){return ip}var sp=Te({},bi,{key:function(n){if(n.key){var e=tp[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ps(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?np[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eu,charCode:function(n){return n.type==="keypress"?ps(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ps(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),op=ft(sp),ap=Te({},po,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gc=ft(ap),lp=Te({},bi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eu}),up=ft(lp),cp=Te({},Or,{propertyName:0,elapsedTime:0,pseudoElement:0}),dp=ft(cp),fp=Te({},po,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),hp=ft(fp),mp=[9,13,27,32],tu=nn&&"CompositionEvent"in window,ti=null;nn&&"documentMode"in document&&(ti=document.documentMode);var gp=nn&&"TextEvent"in window&&!ti,ih=nn&&(!tu||ti&&8<ti&&11>=ti),pc=" ",yc=!1;function sh(n,e){switch(n){case"keyup":return mp.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function oh(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var sr=!1;function pp(n,e){switch(n){case"compositionend":return oh(e);case"keypress":return e.which!==32?null:(yc=!0,pc);case"textInput":return n=e.data,n===pc&&yc?null:n;default:return null}}function yp(n,e){if(sr)return n==="compositionend"||!tu&&sh(n,e)?(n=rh(),gs=Jl=pn=null,sr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ih&&e.locale!=="ko"?null:e.data;default:return null}}var vp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vc(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!vp[n.type]:e==="textarea"}function ah(n,e,t,r){Uf(r),e=Bs(e,"onChange"),0<e.length&&(t=new Zl("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var ni=null,gi=null;function xp(n){vh(n,0)}function yo(n){var e=lr(n);if(_f(e))return n}function Ep(n,e){if(n==="change")return e}var lh=!1;if(nn){var Vo;if(nn){var Ho="oninput"in document;if(!Ho){var xc=document.createElement("div");xc.setAttribute("oninput","return;"),Ho=typeof xc.oninput=="function"}Vo=Ho}else Vo=!1;lh=Vo&&(!document.documentMode||9<document.documentMode)}function Ec(){ni&&(ni.detachEvent("onpropertychange",uh),gi=ni=null)}function uh(n){if(n.propertyName==="value"&&yo(gi)){var e=[];ah(e,gi,n,Wl(n)),Vf(xp,e)}}function Sp(n,e,t){n==="focusin"?(Ec(),ni=e,gi=t,ni.attachEvent("onpropertychange",uh)):n==="focusout"&&Ec()}function Tp(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return yo(gi)}function Lp(n,e){if(n==="click")return yo(e)}function Ap(n,e){if(n==="input"||n==="change")return yo(e)}function Rp(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var bt=typeof Object.is=="function"?Object.is:Rp;function pi(n,e){if(bt(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!Da.call(e,i)||!bt(n[i],e[i]))return!1}return!0}function Sc(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Tc(n,e){var t=Sc(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Sc(t)}}function ch(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?ch(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function dh(){for(var n=window,e=bs();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=bs(n.document)}return e}function nu(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function Ip(n){var e=dh(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&ch(t.ownerDocument.documentElement,t)){if(r!==null&&nu(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!n.extend&&s>r&&(i=r,r=s,s=i),i=Tc(t,s);var o=Tc(t,r);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),s>r?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var wp=nn&&"documentMode"in document&&11>=document.documentMode,or=null,qa=null,ri=null,Xa=!1;function Lc(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Xa||or==null||or!==bs(r)||(r=or,"selectionStart"in r&&nu(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ri&&pi(ri,r)||(ri=r,r=Bs(qa,"onSelect"),0<r.length&&(e=new Zl("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=or)))}function Ki(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var ar={animationend:Ki("Animation","AnimationEnd"),animationiteration:Ki("Animation","AnimationIteration"),animationstart:Ki("Animation","AnimationStart"),transitionend:Ki("Transition","TransitionEnd")},Ko={},fh={};nn&&(fh=document.createElement("div").style,"AnimationEvent"in window||(delete ar.animationend.animation,delete ar.animationiteration.animation,delete ar.animationstart.animation),"TransitionEvent"in window||delete ar.transitionend.transition);function vo(n){if(Ko[n])return Ko[n];if(!ar[n])return n;var e=ar[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in fh)return Ko[n]=e[t];return n}var hh=vo("animationend"),mh=vo("animationiteration"),gh=vo("animationstart"),ph=vo("transitionend"),yh=new Map,Ac="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cn(n,e){yh.set(n,e),Xn(e,[n])}for(var jo=0;jo<Ac.length;jo++){var zo=Ac[jo],Cp=zo.toLowerCase(),kp=zo[0].toUpperCase()+zo.slice(1);Cn(Cp,"on"+kp)}Cn(hh,"onAnimationEnd");Cn(mh,"onAnimationIteration");Cn(gh,"onAnimationStart");Cn("dblclick","onDoubleClick");Cn("focusin","onFocus");Cn("focusout","onBlur");Cn(ph,"onTransitionEnd");Lr("onMouseEnter",["mouseout","mouseover"]);Lr("onMouseLeave",["mouseout","mouseover"]);Lr("onPointerEnter",["pointerout","pointerover"]);Lr("onPointerLeave",["pointerout","pointerover"]);Xn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Xn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Xn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Xn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Xn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Xn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dp=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jr));function Rc(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,Cg(r,e,void 0,n),n.currentTarget=null}function vh(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Rc(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Rc(i,a,u),s=l}}}if(Fs)throw n=ja,Fs=!1,ja=null,n}function me(n,e){var t=e[tl];t===void 0&&(t=e[tl]=new Set);var r=n+"__bubble";t.has(r)||(xh(e,n,2,!1),t.add(r))}function Wo(n,e,t){var r=0;e&&(r|=4),xh(t,n,r,e)}var ji="_reactListening"+Math.random().toString(36).slice(2);function yi(n){if(!n[ji]){n[ji]=!0,If.forEach(function(t){t!=="selectionchange"&&(Dp.has(t)||Wo(t,!1,n),Wo(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[ji]||(e[ji]=!0,Wo("selectionchange",!1,e))}}function xh(n,e,t,r){switch(nh(e)){case 1:var i=Kg;break;case 4:i=jg;break;default:i=Ql}t=i.bind(null,e,t,n),i=void 0,!Ka||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Yo(n,e,t,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=Nn(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}Vf(function(){var u=s,c=Wl(t),d=[];e:{var f=yh.get(n);if(f!==void 0){var m=Zl,h=n;switch(n){case"keypress":if(ps(t)===0)break e;case"keydown":case"keyup":m=op;break;case"focusin":h="focus",m=Go;break;case"focusout":h="blur",m=Go;break;case"beforeblur":case"afterblur":m=Go;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=hc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Yg;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=up;break;case hh:case mh:case gh:m=Qg;break;case ph:m=dp;break;case"scroll":m=zg;break;case"wheel":m=hp;break;case"copy":case"cut":case"paste":m=Zg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=gc}var g=(e&4)!==0,y=!g&&n==="scroll",p=g?f!==null?f+"Capture":null:f;g=[];for(var x=u,E;x!==null;){E=x;var T=E.stateNode;if(E.tag===5&&T!==null&&(E=T,p!==null&&(T=di(x,p),T!=null&&g.push(vi(x,T,E)))),y)break;x=x.return}0<g.length&&(f=new m(f,h,null,t,c),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==Va&&(h=t.relatedTarget||t.fromElement)&&(Nn(h)||h[rn]))break e;if((m||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,m?(h=t.relatedTarget||t.toElement,m=u,h=h?Nn(h):null,h!==null&&(y=Qn(h),h!==y||h.tag!==5&&h.tag!==6)&&(h=null)):(m=null,h=u),m!==h)){if(g=hc,T="onMouseLeave",p="onMouseEnter",x="mouse",(n==="pointerout"||n==="pointerover")&&(g=gc,T="onPointerLeave",p="onPointerEnter",x="pointer"),y=m==null?f:lr(m),E=h==null?f:lr(h),f=new g(T,x+"leave",m,t,c),f.target=y,f.relatedTarget=E,T=null,Nn(c)===u&&(g=new g(p,x+"enter",h,t,c),g.target=E,g.relatedTarget=y,T=g),y=T,m&&h)t:{for(g=m,p=h,x=0,E=g;E;E=Jn(E))x++;for(E=0,T=p;T;T=Jn(T))E++;for(;0<x-E;)g=Jn(g),x--;for(;0<E-x;)p=Jn(p),E--;for(;x--;){if(g===p||p!==null&&g===p.alternate)break t;g=Jn(g),p=Jn(p)}g=null}else g=null;m!==null&&Ic(d,f,m,g,!1),h!==null&&y!==null&&Ic(d,y,h,g,!0)}}e:{if(f=u?lr(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var S=Ep;else if(vc(f))if(lh)S=Ap;else{S=Tp;var A=Sp}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=Lp);if(S&&(S=S(n,u))){ah(d,S,t,c);break e}A&&A(n,f,u),n==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&Ma(f,"number",f.value)}switch(A=u?lr(u):window,n){case"focusin":(vc(A)||A.contentEditable==="true")&&(or=A,qa=u,ri=null);break;case"focusout":ri=qa=or=null;break;case"mousedown":Xa=!0;break;case"contextmenu":case"mouseup":case"dragend":Xa=!1,Lc(d,t,c);break;case"selectionchange":if(wp)break;case"keydown":case"keyup":Lc(d,t,c)}var L;if(tu)e:{switch(n){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else sr?sh(n,t)&&(C="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(C="onCompositionStart");C&&(ih&&t.locale!=="ko"&&(sr||C!=="onCompositionStart"?C==="onCompositionEnd"&&sr&&(L=rh()):(pn=c,Jl="value"in pn?pn.value:pn.textContent,sr=!0)),A=Bs(u,C),0<A.length&&(C=new mc(C,n,null,t,c),d.push({event:C,listeners:A}),L?C.data=L:(L=oh(t),L!==null&&(C.data=L)))),(L=gp?pp(n,t):yp(n,t))&&(u=Bs(u,"onBeforeInput"),0<u.length&&(c=new mc("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=L))}vh(d,e)})}function vi(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Bs(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=di(n,t),s!=null&&r.unshift(vi(n,s,i)),s=di(n,e),s!=null&&r.push(vi(n,s,i))),n=n.return}return r}function Jn(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ic(n,e,t,r,i){for(var s=e._reactName,o=[];t!==null&&t!==r;){var a=t,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=di(t,s),l!=null&&o.unshift(vi(t,l,a))):i||(l=di(t,s),l!=null&&o.push(vi(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var _p=/\r\n?/g,bp=/\u0000|\uFFFD/g;function wc(n){return(typeof n=="string"?n:""+n).replace(_p,`
`).replace(bp,"")}function zi(n,e,t){if(e=wc(e),wc(n)!==e&&t)throw Error(M(425))}function $s(){}var Qa=null,Ja=null;function Za(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var el=typeof setTimeout=="function"?setTimeout:void 0,Pp=typeof clearTimeout=="function"?clearTimeout:void 0,Cc=typeof Promise=="function"?Promise:void 0,Fp=typeof queueMicrotask=="function"?queueMicrotask:typeof Cc<"u"?function(n){return Cc.resolve(null).then(n).catch(Op)}:el;function Op(n){setTimeout(function(){throw n})}function qo(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),mi(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);mi(e)}function Sn(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function kc(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Nr=Math.random().toString(36).slice(2),$t="__reactFiber$"+Nr,xi="__reactProps$"+Nr,rn="__reactContainer$"+Nr,tl="__reactEvents$"+Nr,Np="__reactListeners$"+Nr,Mp="__reactHandles$"+Nr;function Nn(n){var e=n[$t];if(e)return e;for(var t=n.parentNode;t;){if(e=t[rn]||t[$t]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=kc(n);n!==null;){if(t=n[$t])return t;n=kc(n)}return e}n=t,t=n.parentNode}return null}function Pi(n){return n=n[$t]||n[rn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function lr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(M(33))}function xo(n){return n[xi]||null}var nl=[],ur=-1;function kn(n){return{current:n}}function ge(n){0>ur||(n.current=nl[ur],nl[ur]=null,ur--)}function he(n,e){ur++,nl[ur]=n.current,n.current=e}var wn={},ze=kn(wn),nt=kn(!1),Kn=wn;function Ar(n,e){var t=n.type.contextTypes;if(!t)return wn;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in t)i[s]=e[s];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function rt(n){return n=n.childContextTypes,n!=null}function Gs(){ge(nt),ge(ze)}function Dc(n,e,t){if(ze.current!==wn)throw Error(M(168));he(ze,e),he(nt,t)}function Eh(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(M(108,Sg(n)||"Unknown",i));return Te({},t,r)}function Vs(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||wn,Kn=ze.current,he(ze,n),he(nt,nt.current),!0}function _c(n,e,t){var r=n.stateNode;if(!r)throw Error(M(169));t?(n=Eh(n,e,Kn),r.__reactInternalMemoizedMergedChildContext=n,ge(nt),ge(ze),he(ze,n)):ge(nt),he(nt,t)}var Jt=null,Eo=!1,Xo=!1;function Sh(n){Jt===null?Jt=[n]:Jt.push(n)}function Up(n){Eo=!0,Sh(n)}function Dn(){if(!Xo&&Jt!==null){Xo=!0;var n=0,e=ue;try{var t=Jt;for(ue=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Jt=null,Eo=!1}catch(i){throw Jt!==null&&(Jt=Jt.slice(n+1)),zf(Yl,Dn),i}finally{ue=e,Xo=!1}}return null}var cr=[],dr=0,Hs=null,Ks=0,gt=[],pt=0,jn=null,Zt=1,en="";function bn(n,e){cr[dr++]=Ks,cr[dr++]=Hs,Hs=n,Ks=e}function Th(n,e,t){gt[pt++]=Zt,gt[pt++]=en,gt[pt++]=jn,jn=n;var r=Zt;n=en;var i=32-Dt(r)-1;r&=~(1<<i),t+=1;var s=32-Dt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,Zt=1<<32-Dt(e)+i|t<<i|r,en=s+n}else Zt=1<<s|t<<i|r,en=n}function ru(n){n.return!==null&&(bn(n,1),Th(n,1,0))}function iu(n){for(;n===Hs;)Hs=cr[--dr],cr[dr]=null,Ks=cr[--dr],cr[dr]=null;for(;n===jn;)jn=gt[--pt],gt[pt]=null,en=gt[--pt],gt[pt]=null,Zt=gt[--pt],gt[pt]=null}var ut=null,lt=null,ve=!1,Ct=null;function Lh(n,e){var t=yt(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function bc(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ut=n,lt=Sn(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ut=n,lt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=jn!==null?{id:Zt,overflow:en}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=yt(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ut=n,lt=null,!0):!1;default:return!1}}function rl(n){return(n.mode&1)!==0&&(n.flags&128)===0}function il(n){if(ve){var e=lt;if(e){var t=e;if(!bc(n,e)){if(rl(n))throw Error(M(418));e=Sn(t.nextSibling);var r=ut;e&&bc(n,e)?Lh(r,t):(n.flags=n.flags&-4097|2,ve=!1,ut=n)}}else{if(rl(n))throw Error(M(418));n.flags=n.flags&-4097|2,ve=!1,ut=n}}}function Pc(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ut=n}function Wi(n){if(n!==ut)return!1;if(!ve)return Pc(n),ve=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Za(n.type,n.memoizedProps)),e&&(e=lt)){if(rl(n))throw Ah(),Error(M(418));for(;e;)Lh(n,e),e=Sn(e.nextSibling)}if(Pc(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(M(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){lt=Sn(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}lt=null}}else lt=ut?Sn(n.stateNode.nextSibling):null;return!0}function Ah(){for(var n=lt;n;)n=Sn(n.nextSibling)}function Rr(){lt=ut=null,ve=!1}function su(n){Ct===null?Ct=[n]:Ct.push(n)}var Bp=an.ReactCurrentBatchConfig;function jr(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(M(309));var r=t.stateNode}if(!r)throw Error(M(147,n));var i=r,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(M(284));if(!t._owner)throw Error(M(290,n))}return n}function Yi(n,e){throw n=Object.prototype.toString.call(e),Error(M(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function Fc(n){var e=n._init;return e(n._payload)}function Rh(n){function e(p,x){if(n){var E=p.deletions;E===null?(p.deletions=[x],p.flags|=16):E.push(x)}}function t(p,x){if(!n)return null;for(;x!==null;)e(p,x),x=x.sibling;return null}function r(p,x){for(p=new Map;x!==null;)x.key!==null?p.set(x.key,x):p.set(x.index,x),x=x.sibling;return p}function i(p,x){return p=Rn(p,x),p.index=0,p.sibling=null,p}function s(p,x,E){return p.index=E,n?(E=p.alternate,E!==null?(E=E.index,E<x?(p.flags|=2,x):E):(p.flags|=2,x)):(p.flags|=1048576,x)}function o(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,x,E,T){return x===null||x.tag!==6?(x=ra(E,p.mode,T),x.return=p,x):(x=i(x,E),x.return=p,x)}function l(p,x,E,T){var S=E.type;return S===ir?c(p,x,E.props.children,T,E.key):x!==null&&(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===dn&&Fc(S)===x.type)?(T=i(x,E.props),T.ref=jr(p,x,E),T.return=p,T):(T=Ls(E.type,E.key,E.props,null,p.mode,T),T.ref=jr(p,x,E),T.return=p,T)}function u(p,x,E,T){return x===null||x.tag!==4||x.stateNode.containerInfo!==E.containerInfo||x.stateNode.implementation!==E.implementation?(x=ia(E,p.mode,T),x.return=p,x):(x=i(x,E.children||[]),x.return=p,x)}function c(p,x,E,T,S){return x===null||x.tag!==7?(x=Gn(E,p.mode,T,S),x.return=p,x):(x=i(x,E),x.return=p,x)}function d(p,x,E){if(typeof x=="string"&&x!==""||typeof x=="number")return x=ra(""+x,p.mode,E),x.return=p,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Mi:return E=Ls(x.type,x.key,x.props,null,p.mode,E),E.ref=jr(p,null,x),E.return=p,E;case rr:return x=ia(x,p.mode,E),x.return=p,x;case dn:var T=x._init;return d(p,T(x._payload),E)}if(Xr(x)||$r(x))return x=Gn(x,p.mode,E,null),x.return=p,x;Yi(p,x)}return null}function f(p,x,E,T){var S=x!==null?x.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return S!==null?null:a(p,x,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Mi:return E.key===S?l(p,x,E,T):null;case rr:return E.key===S?u(p,x,E,T):null;case dn:return S=E._init,f(p,x,S(E._payload),T)}if(Xr(E)||$r(E))return S!==null?null:c(p,x,E,T,null);Yi(p,E)}return null}function m(p,x,E,T,S){if(typeof T=="string"&&T!==""||typeof T=="number")return p=p.get(E)||null,a(x,p,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Mi:return p=p.get(T.key===null?E:T.key)||null,l(x,p,T,S);case rr:return p=p.get(T.key===null?E:T.key)||null,u(x,p,T,S);case dn:var A=T._init;return m(p,x,E,A(T._payload),S)}if(Xr(T)||$r(T))return p=p.get(E)||null,c(x,p,T,S,null);Yi(x,T)}return null}function h(p,x,E,T){for(var S=null,A=null,L=x,C=x=0,N=null;L!==null&&C<E.length;C++){L.index>C?(N=L,L=null):N=L.sibling;var w=f(p,L,E[C],T);if(w===null){L===null&&(L=N);break}n&&L&&w.alternate===null&&e(p,L),x=s(w,x,C),A===null?S=w:A.sibling=w,A=w,L=N}if(C===E.length)return t(p,L),ve&&bn(p,C),S;if(L===null){for(;C<E.length;C++)L=d(p,E[C],T),L!==null&&(x=s(L,x,C),A===null?S=L:A.sibling=L,A=L);return ve&&bn(p,C),S}for(L=r(p,L);C<E.length;C++)N=m(L,p,C,E[C],T),N!==null&&(n&&N.alternate!==null&&L.delete(N.key===null?C:N.key),x=s(N,x,C),A===null?S=N:A.sibling=N,A=N);return n&&L.forEach(function(F){return e(p,F)}),ve&&bn(p,C),S}function g(p,x,E,T){var S=$r(E);if(typeof S!="function")throw Error(M(150));if(E=S.call(E),E==null)throw Error(M(151));for(var A=S=null,L=x,C=x=0,N=null,w=E.next();L!==null&&!w.done;C++,w=E.next()){L.index>C?(N=L,L=null):N=L.sibling;var F=f(p,L,w.value,T);if(F===null){L===null&&(L=N);break}n&&L&&F.alternate===null&&e(p,L),x=s(F,x,C),A===null?S=F:A.sibling=F,A=F,L=N}if(w.done)return t(p,L),ve&&bn(p,C),S;if(L===null){for(;!w.done;C++,w=E.next())w=d(p,w.value,T),w!==null&&(x=s(w,x,C),A===null?S=w:A.sibling=w,A=w);return ve&&bn(p,C),S}for(L=r(p,L);!w.done;C++,w=E.next())w=m(L,p,C,w.value,T),w!==null&&(n&&w.alternate!==null&&L.delete(w.key===null?C:w.key),x=s(w,x,C),A===null?S=w:A.sibling=w,A=w);return n&&L.forEach(function(z){return e(p,z)}),ve&&bn(p,C),S}function y(p,x,E,T){if(typeof E=="object"&&E!==null&&E.type===ir&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case Mi:e:{for(var S=E.key,A=x;A!==null;){if(A.key===S){if(S=E.type,S===ir){if(A.tag===7){t(p,A.sibling),x=i(A,E.props.children),x.return=p,p=x;break e}}else if(A.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===dn&&Fc(S)===A.type){t(p,A.sibling),x=i(A,E.props),x.ref=jr(p,A,E),x.return=p,p=x;break e}t(p,A);break}else e(p,A);A=A.sibling}E.type===ir?(x=Gn(E.props.children,p.mode,T,E.key),x.return=p,p=x):(T=Ls(E.type,E.key,E.props,null,p.mode,T),T.ref=jr(p,x,E),T.return=p,p=T)}return o(p);case rr:e:{for(A=E.key;x!==null;){if(x.key===A)if(x.tag===4&&x.stateNode.containerInfo===E.containerInfo&&x.stateNode.implementation===E.implementation){t(p,x.sibling),x=i(x,E.children||[]),x.return=p,p=x;break e}else{t(p,x);break}else e(p,x);x=x.sibling}x=ia(E,p.mode,T),x.return=p,p=x}return o(p);case dn:return A=E._init,y(p,x,A(E._payload),T)}if(Xr(E))return h(p,x,E,T);if($r(E))return g(p,x,E,T);Yi(p,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,x!==null&&x.tag===6?(t(p,x.sibling),x=i(x,E),x.return=p,p=x):(t(p,x),x=ra(E,p.mode,T),x.return=p,p=x),o(p)):t(p,x)}return y}var Ir=Rh(!0),Ih=Rh(!1),js=kn(null),zs=null,fr=null,ou=null;function au(){ou=fr=zs=null}function lu(n){var e=js.current;ge(js),n._currentValue=e}function sl(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function Er(n,e){zs=n,ou=fr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(tt=!0),n.firstContext=null)}function xt(n){var e=n._currentValue;if(ou!==n)if(n={context:n,memoizedValue:e,next:null},fr===null){if(zs===null)throw Error(M(308));fr=n,zs.dependencies={lanes:0,firstContext:n}}else fr=fr.next=n;return e}var Mn=null;function uu(n){Mn===null?Mn=[n]:Mn.push(n)}function wh(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,uu(e)):(t.next=i.next,i.next=t),e.interleaved=t,sn(n,r)}function sn(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var fn=!1;function cu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ch(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function tn(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Tn(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,se&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,sn(n,t)}return i=r.interleaved,i===null?(e.next=e,uu(r)):(e.next=i.next,i.next=e),r.interleaved=e,sn(n,t)}function ys(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ql(n,t)}}function Oc(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?i=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?i=s=e:s=s.next=e}else i=s=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Ws(n,e,t,r){var i=n.updateQueue;fn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var d=i.baseState;o=0,c=u=l=null,a=s;do{var f=a.lane,m=a.eventTime;if((r&f)===f){c!==null&&(c=c.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var h=n,g=a;switch(f=e,m=t,g.tag){case 1:if(h=g.payload,typeof h=="function"){d=h.call(m,d,f);break e}d=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=g.payload,f=typeof h=="function"?h.call(m,d,f):h,f==null)break e;d=Te({},d,f);break e;case 2:fn=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=m,l=d):c=c.next=m,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(c===null&&(l=d),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Wn|=o,n.lanes=o,n.memoizedState=d}}function Nc(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(M(191,i));i.call(r)}}}var Fi={},Kt=kn(Fi),Ei=kn(Fi),Si=kn(Fi);function Un(n){if(n===Fi)throw Error(M(174));return n}function du(n,e){switch(he(Si,e),he(Ei,n),he(Kt,Fi),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ba(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ba(e,n)}ge(Kt),he(Kt,e)}function wr(){ge(Kt),ge(Ei),ge(Si)}function kh(n){Un(Si.current);var e=Un(Kt.current),t=Ba(e,n.type);e!==t&&(he(Ei,n),he(Kt,t))}function fu(n){Ei.current===n&&(ge(Kt),ge(Ei))}var Ee=kn(0);function Ys(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Qo=[];function hu(){for(var n=0;n<Qo.length;n++)Qo[n]._workInProgressVersionPrimary=null;Qo.length=0}var vs=an.ReactCurrentDispatcher,Jo=an.ReactCurrentBatchConfig,zn=0,Se=null,ke=null,Pe=null,qs=!1,ii=!1,Ti=0,$p=0;function Ve(){throw Error(M(321))}function mu(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!bt(n[t],e[t]))return!1;return!0}function gu(n,e,t,r,i,s){if(zn=s,Se=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,vs.current=n===null||n.memoizedState===null?Kp:jp,n=t(r,i),ii){s=0;do{if(ii=!1,Ti=0,25<=s)throw Error(M(301));s+=1,Pe=ke=null,e.updateQueue=null,vs.current=zp,n=t(r,i)}while(ii)}if(vs.current=Xs,e=ke!==null&&ke.next!==null,zn=0,Pe=ke=Se=null,qs=!1,e)throw Error(M(300));return n}function pu(){var n=Ti!==0;return Ti=0,n}function Mt(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pe===null?Se.memoizedState=Pe=n:Pe=Pe.next=n,Pe}function Et(){if(ke===null){var n=Se.alternate;n=n!==null?n.memoizedState:null}else n=ke.next;var e=Pe===null?Se.memoizedState:Pe.next;if(e!==null)Pe=e,ke=n;else{if(n===null)throw Error(M(310));ke=n,n={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},Pe===null?Se.memoizedState=Pe=n:Pe=Pe.next=n}return Pe}function Li(n,e){return typeof e=="function"?e(n):e}function Zo(n){var e=Et(),t=e.queue;if(t===null)throw Error(M(311));t.lastRenderedReducer=n;var r=ke,i=r.baseQueue,s=t.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,t.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((zn&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:n(r,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=d,o=r):l=l.next=d,Se.lanes|=c,Wn|=c}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,bt(r,e.memoizedState)||(tt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do s=i.lane,Se.lanes|=s,Wn|=s,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ea(n){var e=Et(),t=e.queue;if(t===null)throw Error(M(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,s=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do s=n(s,o.action),o=o.next;while(o!==i);bt(s,e.memoizedState)||(tt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,r]}function Dh(){}function _h(n,e){var t=Se,r=Et(),i=e(),s=!bt(r.memoizedState,i);if(s&&(r.memoizedState=i,tt=!0),r=r.queue,yu(Fh.bind(null,t,r,n),[n]),r.getSnapshot!==e||s||Pe!==null&&Pe.memoizedState.tag&1){if(t.flags|=2048,Ai(9,Ph.bind(null,t,r,i,e),void 0,null),Oe===null)throw Error(M(349));zn&30||bh(t,e,i)}return i}function bh(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Se.updateQueue,e===null?(e={lastEffect:null,stores:null},Se.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function Ph(n,e,t,r){e.value=t,e.getSnapshot=r,Oh(e)&&Nh(n)}function Fh(n,e,t){return t(function(){Oh(e)&&Nh(n)})}function Oh(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!bt(n,t)}catch{return!0}}function Nh(n){var e=sn(n,1);e!==null&&_t(e,n,1,-1)}function Mc(n){var e=Mt();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:n},e.queue=n,n=n.dispatch=Hp.bind(null,Se,n),[e.memoizedState,n]}function Ai(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Se.updateQueue,e===null?(e={lastEffect:null,stores:null},Se.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function Mh(){return Et().memoizedState}function xs(n,e,t,r){var i=Mt();Se.flags|=n,i.memoizedState=Ai(1|e,t,void 0,r===void 0?null:r)}function So(n,e,t,r){var i=Et();r=r===void 0?null:r;var s=void 0;if(ke!==null){var o=ke.memoizedState;if(s=o.destroy,r!==null&&mu(r,o.deps)){i.memoizedState=Ai(e,t,s,r);return}}Se.flags|=n,i.memoizedState=Ai(1|e,t,s,r)}function Uc(n,e){return xs(8390656,8,n,e)}function yu(n,e){return So(2048,8,n,e)}function Uh(n,e){return So(4,2,n,e)}function Bh(n,e){return So(4,4,n,e)}function $h(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function Gh(n,e,t){return t=t!=null?t.concat([n]):null,So(4,4,$h.bind(null,e,n),t)}function vu(){}function Vh(n,e){var t=Et();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&mu(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Hh(n,e){var t=Et();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&mu(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function Kh(n,e,t){return zn&21?(bt(t,e)||(t=qf(),Se.lanes|=t,Wn|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,tt=!0),n.memoizedState=t)}function Gp(n,e){var t=ue;ue=t!==0&&4>t?t:4,n(!0);var r=Jo.transition;Jo.transition={};try{n(!1),e()}finally{ue=t,Jo.transition=r}}function jh(){return Et().memoizedState}function Vp(n,e,t){var r=An(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},zh(n))Wh(e,t);else if(t=wh(n,e,t,r),t!==null){var i=qe();_t(t,n,r,i),Yh(t,e,r)}}function Hp(n,e,t){var r=An(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(zh(n))Wh(e,i);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(i.hasEagerState=!0,i.eagerState=a,bt(a,o)){var l=e.interleaved;l===null?(i.next=i,uu(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=wh(n,e,i,r),t!==null&&(i=qe(),_t(t,n,r,i),Yh(t,e,r))}}function zh(n){var e=n.alternate;return n===Se||e!==null&&e===Se}function Wh(n,e){ii=qs=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Yh(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,ql(n,t)}}var Xs={readContext:xt,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useInsertionEffect:Ve,useLayoutEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useMutableSource:Ve,useSyncExternalStore:Ve,useId:Ve,unstable_isNewReconciler:!1},Kp={readContext:xt,useCallback:function(n,e){return Mt().memoizedState=[n,e===void 0?null:e],n},useContext:xt,useEffect:Uc,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,xs(4194308,4,$h.bind(null,e,n),t)},useLayoutEffect:function(n,e){return xs(4194308,4,n,e)},useInsertionEffect:function(n,e){return xs(4,2,n,e)},useMemo:function(n,e){var t=Mt();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Mt();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=Vp.bind(null,Se,n),[r.memoizedState,n]},useRef:function(n){var e=Mt();return n={current:n},e.memoizedState=n},useState:Mc,useDebugValue:vu,useDeferredValue:function(n){return Mt().memoizedState=n},useTransition:function(){var n=Mc(!1),e=n[0];return n=Gp.bind(null,n[1]),Mt().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Se,i=Mt();if(ve){if(t===void 0)throw Error(M(407));t=t()}else{if(t=e(),Oe===null)throw Error(M(349));zn&30||bh(r,e,t)}i.memoizedState=t;var s={value:t,getSnapshot:e};return i.queue=s,Uc(Fh.bind(null,r,s,n),[n]),r.flags|=2048,Ai(9,Ph.bind(null,r,s,t,e),void 0,null),t},useId:function(){var n=Mt(),e=Oe.identifierPrefix;if(ve){var t=en,r=Zt;t=(r&~(1<<32-Dt(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Ti++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=$p++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},jp={readContext:xt,useCallback:Vh,useContext:xt,useEffect:yu,useImperativeHandle:Gh,useInsertionEffect:Uh,useLayoutEffect:Bh,useMemo:Hh,useReducer:Zo,useRef:Mh,useState:function(){return Zo(Li)},useDebugValue:vu,useDeferredValue:function(n){var e=Et();return Kh(e,ke.memoizedState,n)},useTransition:function(){var n=Zo(Li)[0],e=Et().memoizedState;return[n,e]},useMutableSource:Dh,useSyncExternalStore:_h,useId:jh,unstable_isNewReconciler:!1},zp={readContext:xt,useCallback:Vh,useContext:xt,useEffect:yu,useImperativeHandle:Gh,useInsertionEffect:Uh,useLayoutEffect:Bh,useMemo:Hh,useReducer:ea,useRef:Mh,useState:function(){return ea(Li)},useDebugValue:vu,useDeferredValue:function(n){var e=Et();return ke===null?e.memoizedState=n:Kh(e,ke.memoizedState,n)},useTransition:function(){var n=ea(Li)[0],e=Et().memoizedState;return[n,e]},useMutableSource:Dh,useSyncExternalStore:_h,useId:jh,unstable_isNewReconciler:!1};function It(n,e){if(n&&n.defaultProps){e=Te({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function ol(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Te({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var To={isMounted:function(n){return(n=n._reactInternals)?Qn(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=qe(),i=An(n),s=tn(r,i);s.payload=e,t!=null&&(s.callback=t),e=Tn(n,s,i),e!==null&&(_t(e,n,i,r),ys(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=qe(),i=An(n),s=tn(r,i);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=Tn(n,s,i),e!==null&&(_t(e,n,i,r),ys(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=qe(),r=An(n),i=tn(t,r);i.tag=2,e!=null&&(i.callback=e),e=Tn(n,i,r),e!==null&&(_t(e,n,r,t),ys(e,n,r))}};function Bc(n,e,t,r,i,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!pi(t,r)||!pi(i,s):!0}function qh(n,e,t){var r=!1,i=wn,s=e.contextType;return typeof s=="object"&&s!==null?s=xt(s):(i=rt(e)?Kn:ze.current,r=e.contextTypes,s=(r=r!=null)?Ar(n,i):wn),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=To,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=s),e}function $c(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&To.enqueueReplaceState(e,e.state,null)}function al(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},cu(n);var s=e.contextType;typeof s=="object"&&s!==null?i.context=xt(s):(s=rt(e)?Kn:ze.current,i.context=Ar(n,s)),i.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(ol(n,e,s,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&To.enqueueReplaceState(i,i.state,null),Ws(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Cr(n,e){try{var t="",r=e;do t+=Eg(r),r=r.return;while(r);var i=t}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:i,digest:null}}function ta(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function ll(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Wp=typeof WeakMap=="function"?WeakMap:Map;function Xh(n,e,t){t=tn(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Js||(Js=!0,vl=r),ll(n,e)},t}function Qh(n,e,t){t=tn(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){ll(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){ll(n,e),typeof r!="function"&&(Ln===null?Ln=new Set([this]):Ln.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function Gc(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new Wp;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=ay.bind(null,n,e,t),e.then(n,n))}function Vc(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function Hc(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=tn(-1,1),e.tag=2,Tn(t,e,1))),t.lanes|=1),n)}var Yp=an.ReactCurrentOwner,tt=!1;function Ye(n,e,t,r){e.child=n===null?Ih(e,null,t,r):Ir(e,n.child,t,r)}function Kc(n,e,t,r,i){t=t.render;var s=e.ref;return Er(e,i),r=gu(n,e,t,r,s,i),t=pu(),n!==null&&!tt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,on(n,e,i)):(ve&&t&&ru(e),e.flags|=1,Ye(n,e,r,i),e.child)}function jc(n,e,t,r,i){if(n===null){var s=t.type;return typeof s=="function"&&!Iu(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,Jh(n,e,s,r,i)):(n=Ls(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&i)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:pi,t(o,r)&&n.ref===e.ref)return on(n,e,i)}return e.flags|=1,n=Rn(s,r),n.ref=e.ref,n.return=e,e.child=n}function Jh(n,e,t,r,i){if(n!==null){var s=n.memoizedProps;if(pi(s,r)&&n.ref===e.ref)if(tt=!1,e.pendingProps=r=s,(n.lanes&i)!==0)n.flags&131072&&(tt=!0);else return e.lanes=n.lanes,on(n,e,i)}return ul(n,e,t,r,i)}function Zh(n,e,t){var r=e.pendingProps,i=r.children,s=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},he(mr,ot),ot|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,he(mr,ot),ot|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:t,he(mr,ot),ot|=r}else s!==null?(r=s.baseLanes|t,e.memoizedState=null):r=t,he(mr,ot),ot|=r;return Ye(n,e,i,t),e.child}function e0(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ul(n,e,t,r,i){var s=rt(t)?Kn:ze.current;return s=Ar(e,s),Er(e,i),t=gu(n,e,t,r,s,i),r=pu(),n!==null&&!tt?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,on(n,e,i)):(ve&&r&&ru(e),e.flags|=1,Ye(n,e,t,i),e.child)}function zc(n,e,t,r,i){if(rt(t)){var s=!0;Vs(e)}else s=!1;if(Er(e,i),e.stateNode===null)Es(n,e),qh(e,t,r),al(e,t,r,i),r=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=xt(u):(u=rt(t)?Kn:ze.current,u=Ar(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&$c(e,o,r,u),fn=!1;var f=e.memoizedState;o.state=f,Ws(e,r,o,i),l=e.memoizedState,a!==r||f!==l||nt.current||fn?(typeof c=="function"&&(ol(e,t,c,r),l=e.memoizedState),(a=fn||Bc(e,t,a,r,f,l,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Ch(n,e),a=e.memoizedProps,u=e.type===e.elementType?a:It(e.type,a),o.props=u,d=e.pendingProps,f=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=xt(l):(l=rt(t)?Kn:ze.current,l=Ar(e,l));var m=t.getDerivedStateFromProps;(c=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||f!==l)&&$c(e,o,r,l),fn=!1,f=e.memoizedState,o.state=f,Ws(e,r,o,i);var h=e.memoizedState;a!==d||f!==h||nt.current||fn?(typeof m=="function"&&(ol(e,t,m,r),h=e.memoizedState),(u=fn||Bc(e,t,u,r,f,h,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,h,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,h,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=h),o.props=r,o.state=h,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return cl(n,e,t,r,s,i)}function cl(n,e,t,r,i,s){e0(n,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&_c(e,t,!1),on(n,e,s);r=e.stateNode,Yp.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&o?(e.child=Ir(e,n.child,null,s),e.child=Ir(e,null,a,s)):Ye(n,e,a,s),e.memoizedState=r.state,i&&_c(e,t,!0),e.child}function t0(n){var e=n.stateNode;e.pendingContext?Dc(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Dc(n,e.context,!1),du(n,e.containerInfo)}function Wc(n,e,t,r,i){return Rr(),su(i),e.flags|=256,Ye(n,e,t,r),e.child}var dl={dehydrated:null,treeContext:null,retryLane:0};function fl(n){return{baseLanes:n,cachePool:null,transitions:null}}function n0(n,e,t){var r=e.pendingProps,i=Ee.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),he(Ee,i&1),n===null)return il(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,n=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Ro(o,r,0,null),n=Gn(n,r,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=fl(t),e.memoizedState=dl,n):xu(e,o));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return qp(n,e,o,r,a,i,t);if(s){s=r.fallback,o=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Rn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Rn(a,s):(s=Gn(s,o,t,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=n.child.memoizedState,o=o===null?fl(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=dl,r}return s=n.child,n=s.sibling,r=Rn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function xu(n,e){return e=Ro({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function qi(n,e,t,r){return r!==null&&su(r),Ir(e,n.child,null,t),n=xu(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function qp(n,e,t,r,i,s,o){if(t)return e.flags&256?(e.flags&=-257,r=ta(Error(M(422))),qi(n,e,o,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Ro({mode:"visible",children:r.children},i,0,null),s=Gn(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Ir(e,n.child,null,o),e.child.memoizedState=fl(o),e.memoizedState=dl,s);if(!(e.mode&1))return qi(n,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(M(419)),r=ta(s,r,void 0),qi(n,e,o,r)}if(a=(o&n.childLanes)!==0,tt||a){if(r=Oe,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,sn(n,i),_t(r,n,i,-1))}return Ru(),r=ta(Error(M(421))),qi(n,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=ly.bind(null,n),i._reactRetry=e,null):(n=s.treeContext,lt=Sn(i.nextSibling),ut=e,ve=!0,Ct=null,n!==null&&(gt[pt++]=Zt,gt[pt++]=en,gt[pt++]=jn,Zt=n.id,en=n.overflow,jn=e),e=xu(e,r.children),e.flags|=4096,e)}function Yc(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),sl(n.return,e,t)}function na(n,e,t,r,i){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=t,s.tailMode=i)}function r0(n,e,t){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ye(n,e,r.children,t),r=Ee.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Yc(n,t,e);else if(n.tag===19)Yc(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(he(Ee,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Ys(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),na(e,!1,i,t,s);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Ys(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}na(e,!0,t,null,s);break;case"together":na(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Es(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function on(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Wn|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(M(153));if(e.child!==null){for(n=e.child,t=Rn(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Rn(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Xp(n,e,t){switch(e.tag){case 3:t0(e),Rr();break;case 5:kh(e);break;case 1:rt(e.type)&&Vs(e);break;case 4:du(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;he(js,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(he(Ee,Ee.current&1),e.flags|=128,null):t&e.child.childLanes?n0(n,e,t):(he(Ee,Ee.current&1),n=on(n,e,t),n!==null?n.sibling:null);he(Ee,Ee.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return r0(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),he(Ee,Ee.current),r)break;return null;case 22:case 23:return e.lanes=0,Zh(n,e,t)}return on(n,e,t)}var i0,hl,s0,o0;i0=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};hl=function(){};s0=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Un(Kt.current);var s=null;switch(t){case"input":i=Oa(n,i),r=Oa(n,r),s=[];break;case"select":i=Te({},i,{value:void 0}),r=Te({},r,{value:void 0}),s=[];break;case"textarea":i=Ua(n,i),r=Ua(n,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=$s)}$a(t,r);var o;t=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ui.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i?.[u],r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ui.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&me("scroll",n),s||a===l||(s=[])):(s=s||[]).push(u,l))}t&&(s=s||[]).push("style",t);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};o0=function(n,e,t,r){t!==r&&(e.flags|=4)};function zr(n,e){if(!ve)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function He(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function Qp(n,e,t){var r=e.pendingProps;switch(iu(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return He(e),null;case 1:return rt(e.type)&&Gs(),He(e),null;case 3:return r=e.stateNode,wr(),ge(nt),ge(ze),hu(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Wi(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ct!==null&&(Sl(Ct),Ct=null))),hl(n,e),He(e),null;case 5:fu(e);var i=Un(Si.current);if(t=e.type,n!==null&&e.stateNode!=null)s0(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(M(166));return He(e),null}if(n=Un(Kt.current),Wi(e)){r=e.stateNode,t=e.type;var s=e.memoizedProps;switch(r[$t]=e,r[xi]=s,n=(e.mode&1)!==0,t){case"dialog":me("cancel",r),me("close",r);break;case"iframe":case"object":case"embed":me("load",r);break;case"video":case"audio":for(i=0;i<Jr.length;i++)me(Jr[i],r);break;case"source":me("error",r);break;case"img":case"image":case"link":me("error",r),me("load",r);break;case"details":me("toggle",r);break;case"input":rc(r,s),me("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},me("invalid",r);break;case"textarea":sc(r,s),me("invalid",r)}$a(t,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&zi(r.textContent,a,n),i=["children",""+a]):ui.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&me("scroll",r)}switch(t){case"input":Ui(r),ic(r,s,!0);break;case"textarea":Ui(r),oc(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=$s)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Ff(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=o.createElement(t,{is:r.is}):(n=o.createElement(t),t==="select"&&(o=n,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):n=o.createElementNS(n,t),n[$t]=e,n[xi]=r,i0(n,e,!1,!1),e.stateNode=n;e:{switch(o=Ga(t,r),t){case"dialog":me("cancel",n),me("close",n),i=r;break;case"iframe":case"object":case"embed":me("load",n),i=r;break;case"video":case"audio":for(i=0;i<Jr.length;i++)me(Jr[i],n);i=r;break;case"source":me("error",n),i=r;break;case"img":case"image":case"link":me("error",n),me("load",n),i=r;break;case"details":me("toggle",n),i=r;break;case"input":rc(n,r),i=Oa(n,r),me("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Te({},r,{value:void 0}),me("invalid",n);break;case"textarea":sc(n,r),i=Ua(n,r),me("invalid",n);break;default:i=r}$a(t,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?Mf(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Of(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&ci(n,l):typeof l=="number"&&ci(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ui.hasOwnProperty(s)?l!=null&&s==="onScroll"&&me("scroll",n):l!=null&&Hl(n,s,l,o))}switch(t){case"input":Ui(n),ic(n,r,!1);break;case"textarea":Ui(n),oc(n);break;case"option":r.value!=null&&n.setAttribute("value",""+In(r.value));break;case"select":n.multiple=!!r.multiple,s=r.value,s!=null?pr(n,!!r.multiple,s,!1):r.defaultValue!=null&&pr(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=$s)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return He(e),null;case 6:if(n&&e.stateNode!=null)o0(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(M(166));if(t=Un(Si.current),Un(Kt.current),Wi(e)){if(r=e.stateNode,t=e.memoizedProps,r[$t]=e,(s=r.nodeValue!==t)&&(n=ut,n!==null))switch(n.tag){case 3:zi(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&zi(r.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[$t]=e,e.stateNode=r}return He(e),null;case 13:if(ge(Ee),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(ve&&lt!==null&&e.mode&1&&!(e.flags&128))Ah(),Rr(),e.flags|=98560,s=!1;else if(s=Wi(e),r!==null&&r.dehydrated!==null){if(n===null){if(!s)throw Error(M(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(M(317));s[$t]=e}else Rr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;He(e),s=!1}else Ct!==null&&(Sl(Ct),Ct=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Ee.current&1?De===0&&(De=3):Ru())),e.updateQueue!==null&&(e.flags|=4),He(e),null);case 4:return wr(),hl(n,e),n===null&&yi(e.stateNode.containerInfo),He(e),null;case 10:return lu(e.type._context),He(e),null;case 17:return rt(e.type)&&Gs(),He(e),null;case 19:if(ge(Ee),s=e.memoizedState,s===null)return He(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)zr(s,!1);else{if(De!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=Ys(n),o!==null){for(e.flags|=128,zr(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)s=t,n=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return he(Ee,Ee.current&1|2),e.child}n=n.sibling}s.tail!==null&&Re()>kr&&(e.flags|=128,r=!0,zr(s,!1),e.lanes=4194304)}else{if(!r)if(n=Ys(o),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),zr(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!ve)return He(e),null}else 2*Re()-s.renderingStartTime>kr&&t!==1073741824&&(e.flags|=128,r=!0,zr(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Re(),e.sibling=null,t=Ee.current,he(Ee,r?t&1|2:t&1),e):(He(e),null);case 22:case 23:return Au(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ot&1073741824&&(He(e),e.subtreeFlags&6&&(e.flags|=8192)):He(e),null;case 24:return null;case 25:return null}throw Error(M(156,e.tag))}function Jp(n,e){switch(iu(e),e.tag){case 1:return rt(e.type)&&Gs(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return wr(),ge(nt),ge(ze),hu(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return fu(e),null;case 13:if(ge(Ee),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(M(340));Rr()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return ge(Ee),null;case 4:return wr(),null;case 10:return lu(e.type._context),null;case 22:case 23:return Au(),null;case 24:return null;default:return null}}var Xi=!1,je=!1,Zp=typeof WeakSet=="function"?WeakSet:Set,B=null;function hr(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Ae(n,e,r)}else t.current=null}function ml(n,e,t){try{t()}catch(r){Ae(n,e,r)}}var qc=!1;function ey(n,e){if(Qa=Ms,n=dh(),nu(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,u=0,c=0,d=n,f=null;t:for(;;){for(var m;d!==t||i!==0&&d.nodeType!==3||(a=o+i),d!==s||r!==0&&d.nodeType!==3||(l=o+r),d.nodeType===3&&(o+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===n)break t;if(f===t&&++u===i&&(a=o),f===s&&++c===r&&(l=o),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ja={focusedElem:n,selectionRange:t},Ms=!1,B=e;B!==null;)if(e=B,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,B=n;else for(;B!==null;){e=B;try{var h=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var g=h.memoizedProps,y=h.memoizedState,p=e.stateNode,x=p.getSnapshotBeforeUpdate(e.elementType===e.type?g:It(e.type,g),y);p.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(M(163))}}catch(T){Ae(e,e.return,T)}if(n=e.sibling,n!==null){n.return=e.return,B=n;break}B=e.return}return h=qc,qc=!1,h}function si(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var s=i.destroy;i.destroy=void 0,s!==void 0&&ml(e,t,s)}i=i.next}while(i!==r)}}function Lo(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function gl(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function a0(n){var e=n.alternate;e!==null&&(n.alternate=null,a0(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[$t],delete e[xi],delete e[tl],delete e[Np],delete e[Mp])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function l0(n){return n.tag===5||n.tag===3||n.tag===4}function Xc(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||l0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function pl(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=$s));else if(r!==4&&(n=n.child,n!==null))for(pl(n,e,t),n=n.sibling;n!==null;)pl(n,e,t),n=n.sibling}function yl(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(yl(n,e,t),n=n.sibling;n!==null;)yl(n,e,t),n=n.sibling}var Me=null,wt=!1;function un(n,e,t){for(t=t.child;t!==null;)u0(n,e,t),t=t.sibling}function u0(n,e,t){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(go,t)}catch{}switch(t.tag){case 5:je||hr(t,e);case 6:var r=Me,i=wt;Me=null,un(n,e,t),Me=r,wt=i,Me!==null&&(wt?(n=Me,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Me.removeChild(t.stateNode));break;case 18:Me!==null&&(wt?(n=Me,t=t.stateNode,n.nodeType===8?qo(n.parentNode,t):n.nodeType===1&&qo(n,t),mi(n)):qo(Me,t.stateNode));break;case 4:r=Me,i=wt,Me=t.stateNode.containerInfo,wt=!0,un(n,e,t),Me=r,wt=i;break;case 0:case 11:case 14:case 15:if(!je&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&ml(t,e,o),i=i.next}while(i!==r)}un(n,e,t);break;case 1:if(!je&&(hr(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Ae(t,e,a)}un(n,e,t);break;case 21:un(n,e,t);break;case 22:t.mode&1?(je=(r=je)||t.memoizedState!==null,un(n,e,t),je=r):un(n,e,t);break;default:un(n,e,t)}}function Qc(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Zp),e.forEach(function(r){var i=uy.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Lt(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Me=a.stateNode,wt=!1;break e;case 3:Me=a.stateNode.containerInfo,wt=!0;break e;case 4:Me=a.stateNode.containerInfo,wt=!0;break e}a=a.return}if(Me===null)throw Error(M(160));u0(s,o,i),Me=null,wt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){Ae(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)c0(e,n),e=e.sibling}function c0(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Lt(e,n),Ot(n),r&4){try{si(3,n,n.return),Lo(3,n)}catch(g){Ae(n,n.return,g)}try{si(5,n,n.return)}catch(g){Ae(n,n.return,g)}}break;case 1:Lt(e,n),Ot(n),r&512&&t!==null&&hr(t,t.return);break;case 5:if(Lt(e,n),Ot(n),r&512&&t!==null&&hr(t,t.return),n.flags&32){var i=n.stateNode;try{ci(i,"")}catch(g){Ae(n,n.return,g)}}if(r&4&&(i=n.stateNode,i!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&bf(i,s),Ga(a,o);var u=Ga(a,s);for(o=0;o<l.length;o+=2){var c=l[o],d=l[o+1];c==="style"?Mf(i,d):c==="dangerouslySetInnerHTML"?Of(i,d):c==="children"?ci(i,d):Hl(i,c,d,u)}switch(a){case"input":Na(i,s);break;case"textarea":Pf(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?pr(i,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?pr(i,!!s.multiple,s.defaultValue,!0):pr(i,!!s.multiple,s.multiple?[]:"",!1))}i[xi]=s}catch(g){Ae(n,n.return,g)}}break;case 6:if(Lt(e,n),Ot(n),r&4){if(n.stateNode===null)throw Error(M(162));i=n.stateNode,s=n.memoizedProps;try{i.nodeValue=s}catch(g){Ae(n,n.return,g)}}break;case 3:if(Lt(e,n),Ot(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{mi(e.containerInfo)}catch(g){Ae(n,n.return,g)}break;case 4:Lt(e,n),Ot(n);break;case 13:Lt(e,n),Ot(n),i=n.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Tu=Re())),r&4&&Qc(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(je=(u=je)||c,Lt(e,n),je=u):Lt(e,n),Ot(n),r&8192){if(u=n.memoizedState!==null,(n.stateNode.isHidden=u)&&!c&&n.mode&1)for(B=n,c=n.child;c!==null;){for(d=B=c;B!==null;){switch(f=B,m=f.child,f.tag){case 0:case 11:case 14:case 15:si(4,f,f.return);break;case 1:hr(f,f.return);var h=f.stateNode;if(typeof h.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(g){Ae(r,t,g)}}break;case 5:hr(f,f.return);break;case 22:if(f.memoizedState!==null){Zc(d);continue}}m!==null?(m.return=f,B=m):Zc(d)}c=c.sibling}e:for(c=null,d=n;;){if(d.tag===5){if(c===null){c=d;try{i=d.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Nf("display",o))}catch(g){Ae(n,n.return,g)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(g){Ae(n,n.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Lt(e,n),Ot(n),r&4&&Qc(n);break;case 21:break;default:Lt(e,n),Ot(n)}}function Ot(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(l0(t)){var r=t;break e}t=t.return}throw Error(M(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(ci(i,""),r.flags&=-33);var s=Xc(n);yl(n,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Xc(n);pl(n,a,o);break;default:throw Error(M(161))}}catch(l){Ae(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function ty(n,e,t){B=n,d0(n)}function d0(n,e,t){for(var r=(n.mode&1)!==0;B!==null;){var i=B,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Xi;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||je;a=Xi;var u=je;if(Xi=o,(je=l)&&!u)for(B=i;B!==null;)o=B,l=o.child,o.tag===22&&o.memoizedState!==null?ed(i):l!==null?(l.return=o,B=l):ed(i);for(;s!==null;)B=s,d0(s),s=s.sibling;B=i,Xi=a,je=u}Jc(n)}else i.subtreeFlags&8772&&s!==null?(s.return=i,B=s):Jc(n)}}function Jc(n){for(;B!==null;){var e=B;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:je||Lo(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!je)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:It(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Nc(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Nc(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&mi(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(M(163))}je||e.flags&512&&gl(e)}catch(f){Ae(e,e.return,f)}}if(e===n){B=null;break}if(t=e.sibling,t!==null){t.return=e.return,B=t;break}B=e.return}}function Zc(n){for(;B!==null;){var e=B;if(e===n){B=null;break}var t=e.sibling;if(t!==null){t.return=e.return,B=t;break}B=e.return}}function ed(n){for(;B!==null;){var e=B;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Lo(4,e)}catch(l){Ae(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Ae(e,i,l)}}var s=e.return;try{gl(e)}catch(l){Ae(e,s,l)}break;case 5:var o=e.return;try{gl(e)}catch(l){Ae(e,o,l)}}}catch(l){Ae(e,e.return,l)}if(e===n){B=null;break}var a=e.sibling;if(a!==null){a.return=e.return,B=a;break}B=e.return}}var ny=Math.ceil,Qs=an.ReactCurrentDispatcher,Eu=an.ReactCurrentOwner,vt=an.ReactCurrentBatchConfig,se=0,Oe=null,Ie=null,Be=0,ot=0,mr=kn(0),De=0,Ri=null,Wn=0,Ao=0,Su=0,oi=null,Ze=null,Tu=0,kr=1/0,qt=null,Js=!1,vl=null,Ln=null,Qi=!1,yn=null,Zs=0,ai=0,xl=null,Ss=-1,Ts=0;function qe(){return se&6?Re():Ss!==-1?Ss:Ss=Re()}function An(n){return n.mode&1?se&2&&Be!==0?Be&-Be:Bp.transition!==null?(Ts===0&&(Ts=qf()),Ts):(n=ue,n!==0||(n=window.event,n=n===void 0?16:nh(n.type)),n):1}function _t(n,e,t,r){if(50<ai)throw ai=0,xl=null,Error(M(185));_i(n,t,r),(!(se&2)||n!==Oe)&&(n===Oe&&(!(se&2)&&(Ao|=t),De===4&&gn(n,Be)),it(n,r),t===1&&se===0&&!(e.mode&1)&&(kr=Re()+500,Eo&&Dn()))}function it(n,e){var t=n.callbackNode;Bg(n,e);var r=Ns(n,n===Oe?Be:0);if(r===0)t!==null&&uc(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&uc(t),e===1)n.tag===0?Up(td.bind(null,n)):Sh(td.bind(null,n)),Fp(function(){!(se&6)&&Dn()}),t=null;else{switch(Xf(r)){case 1:t=Yl;break;case 4:t=Wf;break;case 16:t=Os;break;case 536870912:t=Yf;break;default:t=Os}t=x0(t,f0.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function f0(n,e){if(Ss=-1,Ts=0,se&6)throw Error(M(327));var t=n.callbackNode;if(Sr()&&n.callbackNode!==t)return null;var r=Ns(n,n===Oe?Be:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=eo(n,r);else{e=r;var i=se;se|=2;var s=m0();(Oe!==n||Be!==e)&&(qt=null,kr=Re()+500,$n(n,e));do try{sy();break}catch(a){h0(n,a)}while(!0);au(),Qs.current=s,se=i,Ie!==null?e=0:(Oe=null,Be=0,e=De)}if(e!==0){if(e===2&&(i=za(n),i!==0&&(r=i,e=El(n,i))),e===1)throw t=Ri,$n(n,0),gn(n,r),it(n,Re()),t;if(e===6)gn(n,r);else{if(i=n.current.alternate,!(r&30)&&!ry(i)&&(e=eo(n,r),e===2&&(s=za(n),s!==0&&(r=s,e=El(n,s))),e===1))throw t=Ri,$n(n,0),gn(n,r),it(n,Re()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(M(345));case 2:Pn(n,Ze,qt);break;case 3:if(gn(n,r),(r&130023424)===r&&(e=Tu+500-Re(),10<e)){if(Ns(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){qe(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=el(Pn.bind(null,n,Ze,qt),e);break}Pn(n,Ze,qt);break;case 4:if(gn(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var o=31-Dt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Re()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*ny(r/1960))-r,10<r){n.timeoutHandle=el(Pn.bind(null,n,Ze,qt),r);break}Pn(n,Ze,qt);break;case 5:Pn(n,Ze,qt);break;default:throw Error(M(329))}}}return it(n,Re()),n.callbackNode===t?f0.bind(null,n):null}function El(n,e){var t=oi;return n.current.memoizedState.isDehydrated&&($n(n,e).flags|=256),n=eo(n,e),n!==2&&(e=Ze,Ze=t,e!==null&&Sl(e)),n}function Sl(n){Ze===null?Ze=n:Ze.push.apply(Ze,n)}function ry(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],s=i.getSnapshot;i=i.value;try{if(!bt(s(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function gn(n,e){for(e&=~Su,e&=~Ao,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Dt(e),r=1<<t;n[t]=-1,e&=~r}}function td(n){if(se&6)throw Error(M(327));Sr();var e=Ns(n,0);if(!(e&1))return it(n,Re()),null;var t=eo(n,e);if(n.tag!==0&&t===2){var r=za(n);r!==0&&(e=r,t=El(n,r))}if(t===1)throw t=Ri,$n(n,0),gn(n,e),it(n,Re()),t;if(t===6)throw Error(M(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Pn(n,Ze,qt),it(n,Re()),null}function Lu(n,e){var t=se;se|=1;try{return n(e)}finally{se=t,se===0&&(kr=Re()+500,Eo&&Dn())}}function Yn(n){yn!==null&&yn.tag===0&&!(se&6)&&Sr();var e=se;se|=1;var t=vt.transition,r=ue;try{if(vt.transition=null,ue=1,n)return n()}finally{ue=r,vt.transition=t,se=e,!(se&6)&&Dn()}}function Au(){ot=mr.current,ge(mr)}function $n(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,Pp(t)),Ie!==null)for(t=Ie.return;t!==null;){var r=t;switch(iu(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Gs();break;case 3:wr(),ge(nt),ge(ze),hu();break;case 5:fu(r);break;case 4:wr();break;case 13:ge(Ee);break;case 19:ge(Ee);break;case 10:lu(r.type._context);break;case 22:case 23:Au()}t=t.return}if(Oe=n,Ie=n=Rn(n.current,null),Be=ot=e,De=0,Ri=null,Su=Ao=Wn=0,Ze=oi=null,Mn!==null){for(e=0;e<Mn.length;e++)if(t=Mn[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,s=t.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}t.pending=r}Mn=null}return n}function h0(n,e){do{var t=Ie;try{if(au(),vs.current=Xs,qs){for(var r=Se.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}qs=!1}if(zn=0,Pe=ke=Se=null,ii=!1,Ti=0,Eu.current=null,t===null||t.return===null){De=1,Ri=e,Ie=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=Be,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var m=Vc(o);if(m!==null){m.flags&=-257,Hc(m,o,a,s,e),m.mode&1&&Gc(s,u,e),e=m,l=u;var h=e.updateQueue;if(h===null){var g=new Set;g.add(l),e.updateQueue=g}else h.add(l);break e}else{if(!(e&1)){Gc(s,u,e),Ru();break e}l=Error(M(426))}}else if(ve&&a.mode&1){var y=Vc(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),Hc(y,o,a,s,e),su(Cr(l,a));break e}}s=l=Cr(l,a),De!==4&&(De=2),oi===null?oi=[s]:oi.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=Xh(s,l,e);Oc(s,p);break e;case 1:a=l;var x=s.type,E=s.stateNode;if(!(s.flags&128)&&(typeof x.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Ln===null||!Ln.has(E)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=Qh(s,a,e);Oc(s,T);break e}}s=s.return}while(s!==null)}p0(t)}catch(S){e=S,Ie===t&&t!==null&&(Ie=t=t.return);continue}break}while(!0)}function m0(){var n=Qs.current;return Qs.current=Xs,n===null?Xs:n}function Ru(){(De===0||De===3||De===2)&&(De=4),Oe===null||!(Wn&268435455)&&!(Ao&268435455)||gn(Oe,Be)}function eo(n,e){var t=se;se|=2;var r=m0();(Oe!==n||Be!==e)&&(qt=null,$n(n,e));do try{iy();break}catch(i){h0(n,i)}while(!0);if(au(),se=t,Qs.current=r,Ie!==null)throw Error(M(261));return Oe=null,Be=0,De}function iy(){for(;Ie!==null;)g0(Ie)}function sy(){for(;Ie!==null&&!Dg();)g0(Ie)}function g0(n){var e=v0(n.alternate,n,ot);n.memoizedProps=n.pendingProps,e===null?p0(n):Ie=e,Eu.current=null}function p0(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Jp(t,e),t!==null){t.flags&=32767,Ie=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{De=6,Ie=null;return}}else if(t=Qp(t,e,ot),t!==null){Ie=t;return}if(e=e.sibling,e!==null){Ie=e;return}Ie=e=n}while(e!==null);De===0&&(De=5)}function Pn(n,e,t){var r=ue,i=vt.transition;try{vt.transition=null,ue=1,oy(n,e,t,r)}finally{vt.transition=i,ue=r}return null}function oy(n,e,t,r){do Sr();while(yn!==null);if(se&6)throw Error(M(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(M(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if($g(n,s),n===Oe&&(Ie=Oe=null,Be=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Qi||(Qi=!0,x0(Os,function(){return Sr(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=vt.transition,vt.transition=null;var o=ue;ue=1;var a=se;se|=4,Eu.current=null,ey(n,t),c0(t,n),Ip(Ja),Ms=!!Qa,Ja=Qa=null,n.current=t,ty(t),_g(),se=a,ue=o,vt.transition=s}else n.current=t;if(Qi&&(Qi=!1,yn=n,Zs=i),s=n.pendingLanes,s===0&&(Ln=null),Fg(t.stateNode),it(n,Re()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Js)throw Js=!1,n=vl,vl=null,n;return Zs&1&&n.tag!==0&&Sr(),s=n.pendingLanes,s&1?n===xl?ai++:(ai=0,xl=n):ai=0,Dn(),null}function Sr(){if(yn!==null){var n=Xf(Zs),e=vt.transition,t=ue;try{if(vt.transition=null,ue=16>n?16:n,yn===null)var r=!1;else{if(n=yn,yn=null,Zs=0,se&6)throw Error(M(331));var i=se;for(se|=4,B=n.current;B!==null;){var s=B,o=s.child;if(B.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(B=u;B!==null;){var c=B;switch(c.tag){case 0:case 11:case 15:si(8,c,s)}var d=c.child;if(d!==null)d.return=c,B=d;else for(;B!==null;){c=B;var f=c.sibling,m=c.return;if(a0(c),c===u){B=null;break}if(f!==null){f.return=m,B=f;break}B=m}}}var h=s.alternate;if(h!==null){var g=h.child;if(g!==null){h.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(g!==null)}}B=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,B=o;else e:for(;B!==null;){if(s=B,s.flags&2048)switch(s.tag){case 0:case 11:case 15:si(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,B=p;break e}B=s.return}}var x=n.current;for(B=x;B!==null;){o=B;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,B=E;else e:for(o=x;B!==null;){if(a=B,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Lo(9,a)}}catch(S){Ae(a,a.return,S)}if(a===o){B=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,B=T;break e}B=a.return}}if(se=i,Dn(),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(go,n)}catch{}r=!0}return r}finally{ue=t,vt.transition=e}}return!1}function nd(n,e,t){e=Cr(t,e),e=Xh(n,e,1),n=Tn(n,e,1),e=qe(),n!==null&&(_i(n,1,e),it(n,e))}function Ae(n,e,t){if(n.tag===3)nd(n,n,t);else for(;e!==null;){if(e.tag===3){nd(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ln===null||!Ln.has(r))){n=Cr(t,n),n=Qh(e,n,1),e=Tn(e,n,1),n=qe(),e!==null&&(_i(e,1,n),it(e,n));break}}e=e.return}}function ay(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=qe(),n.pingedLanes|=n.suspendedLanes&t,Oe===n&&(Be&t)===t&&(De===4||De===3&&(Be&130023424)===Be&&500>Re()-Tu?$n(n,0):Su|=t),it(n,e)}function y0(n,e){e===0&&(n.mode&1?(e=Gi,Gi<<=1,!(Gi&130023424)&&(Gi=4194304)):e=1);var t=qe();n=sn(n,e),n!==null&&(_i(n,e,t),it(n,t))}function ly(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),y0(n,t)}function uy(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(M(314))}r!==null&&r.delete(e),y0(n,t)}var v0;v0=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||nt.current)tt=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return tt=!1,Xp(n,e,t);tt=!!(n.flags&131072)}else tt=!1,ve&&e.flags&1048576&&Th(e,Ks,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Es(n,e),n=e.pendingProps;var i=Ar(e,ze.current);Er(e,t),i=gu(null,e,r,n,i,t);var s=pu();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,rt(r)?(s=!0,Vs(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,cu(e),i.updater=To,e.stateNode=i,i._reactInternals=e,al(e,r,n,t),e=cl(null,e,r,!0,s,t)):(e.tag=0,ve&&s&&ru(e),Ye(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(Es(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=dy(r),n=It(r,n),i){case 0:e=ul(null,e,r,n,t);break e;case 1:e=zc(null,e,r,n,t);break e;case 11:e=Kc(null,e,r,n,t);break e;case 14:e=jc(null,e,r,It(r.type,n),t);break e}throw Error(M(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:It(r,i),ul(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:It(r,i),zc(n,e,r,i,t);case 3:e:{if(t0(e),n===null)throw Error(M(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Ch(n,e),Ws(e,r,null,t);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Cr(Error(M(423)),e),e=Wc(n,e,r,t,i);break e}else if(r!==i){i=Cr(Error(M(424)),e),e=Wc(n,e,r,t,i);break e}else for(lt=Sn(e.stateNode.containerInfo.firstChild),ut=e,ve=!0,Ct=null,t=Ih(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Rr(),r===i){e=on(n,e,t);break e}Ye(n,e,r,t)}e=e.child}return e;case 5:return kh(e),n===null&&il(e),r=e.type,i=e.pendingProps,s=n!==null?n.memoizedProps:null,o=i.children,Za(r,i)?o=null:s!==null&&Za(r,s)&&(e.flags|=32),e0(n,e),Ye(n,e,o,t),e.child;case 6:return n===null&&il(e),null;case 13:return n0(n,e,t);case 4:return du(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Ir(e,null,r,t):Ye(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:It(r,i),Kc(n,e,r,i,t);case 7:return Ye(n,e,e.pendingProps,t),e.child;case 8:return Ye(n,e,e.pendingProps.children,t),e.child;case 12:return Ye(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,he(js,r._currentValue),r._currentValue=o,s!==null)if(bt(s.value,o)){if(s.children===i.children&&!nt.current){e=on(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=tn(-1,t&-t),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),sl(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(M(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),sl(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ye(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Er(e,t),i=xt(i),r=r(i),e.flags|=1,Ye(n,e,r,t),e.child;case 14:return r=e.type,i=It(r,e.pendingProps),i=It(r.type,i),jc(n,e,r,i,t);case 15:return Jh(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:It(r,i),Es(n,e),e.tag=1,rt(r)?(n=!0,Vs(e)):n=!1,Er(e,t),qh(e,r,i),al(e,r,i,t),cl(null,e,r,!0,n,t);case 19:return r0(n,e,t);case 22:return Zh(n,e,t)}throw Error(M(156,e.tag))};function x0(n,e){return zf(n,e)}function cy(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yt(n,e,t,r){return new cy(n,e,t,r)}function Iu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function dy(n){if(typeof n=="function")return Iu(n)?1:0;if(n!=null){if(n=n.$$typeof,n===jl)return 11;if(n===zl)return 14}return 2}function Rn(n,e){var t=n.alternate;return t===null?(t=yt(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Ls(n,e,t,r,i,s){var o=2;if(r=n,typeof n=="function")Iu(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case ir:return Gn(t.children,i,s,e);case Kl:o=8,i|=8;break;case _a:return n=yt(12,t,e,i|2),n.elementType=_a,n.lanes=s,n;case ba:return n=yt(13,t,e,i),n.elementType=ba,n.lanes=s,n;case Pa:return n=yt(19,t,e,i),n.elementType=Pa,n.lanes=s,n;case kf:return Ro(t,i,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case wf:o=10;break e;case Cf:o=9;break e;case jl:o=11;break e;case zl:o=14;break e;case dn:o=16,r=null;break e}throw Error(M(130,n==null?n:typeof n,""))}return e=yt(o,t,e,i),e.elementType=n,e.type=r,e.lanes=s,e}function Gn(n,e,t,r){return n=yt(7,n,r,e),n.lanes=t,n}function Ro(n,e,t,r){return n=yt(22,n,r,e),n.elementType=kf,n.lanes=t,n.stateNode={isHidden:!1},n}function ra(n,e,t){return n=yt(6,n,null,e),n.lanes=t,n}function ia(n,e,t){return e=yt(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function fy(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Uo(0),this.expirationTimes=Uo(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Uo(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function wu(n,e,t,r,i,s,o,a,l){return n=new fy(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=yt(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},cu(s),n}function hy(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rr,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function E0(n){if(!n)return wn;n=n._reactInternals;e:{if(Qn(n)!==n||n.tag!==1)throw Error(M(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(rt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(M(171))}if(n.tag===1){var t=n.type;if(rt(t))return Eh(n,t,e)}return e}function S0(n,e,t,r,i,s,o,a,l){return n=wu(t,r,!0,n,i,s,o,a,l),n.context=E0(null),t=n.current,r=qe(),i=An(t),s=tn(r,i),s.callback=e??null,Tn(t,s,i),n.current.lanes=i,_i(n,i,r),it(n,r),n}function Io(n,e,t,r){var i=e.current,s=qe(),o=An(i);return t=E0(t),e.context===null?e.context=t:e.pendingContext=t,e=tn(s,o),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Tn(i,e,o),n!==null&&(_t(n,i,o,s),ys(n,i,o)),o}function to(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function rd(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Cu(n,e){rd(n,e),(n=n.alternate)&&rd(n,e)}function my(){return null}var T0=typeof reportError=="function"?reportError:function(n){console.error(n)};function ku(n){this._internalRoot=n}wo.prototype.render=ku.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(M(409));Io(n,e,null,null)};wo.prototype.unmount=ku.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Yn(function(){Io(null,n,null,null)}),e[rn]=null}};function wo(n){this._internalRoot=n}wo.prototype.unstable_scheduleHydration=function(n){if(n){var e=Zf();n={blockedOn:null,target:n,priority:e};for(var t=0;t<mn.length&&e!==0&&e<mn[t].priority;t++);mn.splice(t,0,n),t===0&&th(n)}};function Du(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Co(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function id(){}function gy(n,e,t,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=to(o);s.call(u)}}var o=S0(e,r,n,0,null,!1,!1,"",id);return n._reactRootContainer=o,n[rn]=o.current,yi(n.nodeType===8?n.parentNode:n),Yn(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=to(l);a.call(u)}}var l=wu(n,0,!1,null,null,!1,!1,"",id);return n._reactRootContainer=l,n[rn]=l.current,yi(n.nodeType===8?n.parentNode:n),Yn(function(){Io(e,l,t,r)}),l}function ko(n,e,t,r,i){var s=t._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=to(o);a.call(l)}}Io(e,o,n,i)}else o=gy(t,e,n,i,r);return to(o)}Qf=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Qr(e.pendingLanes);t!==0&&(ql(e,t|1),it(e,Re()),!(se&6)&&(kr=Re()+500,Dn()))}break;case 13:Yn(function(){var r=sn(n,1);if(r!==null){var i=qe();_t(r,n,1,i)}}),Cu(n,1)}};Xl=function(n){if(n.tag===13){var e=sn(n,134217728);if(e!==null){var t=qe();_t(e,n,134217728,t)}Cu(n,134217728)}};Jf=function(n){if(n.tag===13){var e=An(n),t=sn(n,e);if(t!==null){var r=qe();_t(t,n,e,r)}Cu(n,e)}};Zf=function(){return ue};eh=function(n,e){var t=ue;try{return ue=n,e()}finally{ue=t}};Ha=function(n,e,t){switch(e){case"input":if(Na(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=xo(r);if(!i)throw Error(M(90));_f(r),Na(r,i)}}}break;case"textarea":Pf(n,t);break;case"select":e=t.value,e!=null&&pr(n,!!t.multiple,e,!1)}};$f=Lu;Gf=Yn;var py={usingClientEntryPoint:!1,Events:[Pi,lr,xo,Uf,Bf,Lu]},Wr={findFiberByHostInstance:Nn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},yy={bundleType:Wr.bundleType,version:Wr.version,rendererPackageName:Wr.rendererPackageName,rendererConfig:Wr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:an.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Kf(n),n===null?null:n.stateNode},findFiberByHostInstance:Wr.findFiberByHostInstance||my,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ji=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ji.isDisabled&&Ji.supportsFiber)try{go=Ji.inject(yy),Ht=Ji}catch{}}dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=py;dt.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Du(e))throw Error(M(200));return hy(n,e,null,t)};dt.createRoot=function(n,e){if(!Du(n))throw Error(M(299));var t=!1,r="",i=T0;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=wu(n,1,!1,null,null,t,!1,r,i),n[rn]=e.current,yi(n.nodeType===8?n.parentNode:n),new ku(e)};dt.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(M(188)):(n=Object.keys(n).join(","),Error(M(268,n)));return n=Kf(e),n=n===null?null:n.stateNode,n};dt.flushSync=function(n){return Yn(n)};dt.hydrate=function(n,e,t){if(!Co(e))throw Error(M(200));return ko(null,n,e,!0,t)};dt.hydrateRoot=function(n,e,t){if(!Du(n))throw Error(M(405));var r=t!=null&&t.hydratedSources||null,i=!1,s="",o=T0;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=S0(e,null,n,1,t??null,i,!1,s,o),n[rn]=e.current,yi(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new wo(e)};dt.render=function(n,e,t){if(!Co(e))throw Error(M(200));return ko(null,n,e,!1,t)};dt.unmountComponentAtNode=function(n){if(!Co(n))throw Error(M(40));return n._reactRootContainer?(Yn(function(){ko(null,null,n,!1,function(){n._reactRootContainer=null,n[rn]=null})}),!0):!1};dt.unstable_batchedUpdates=Lu;dt.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Co(t))throw Error(M(200));if(n==null||n._reactInternals===void 0)throw Error(M(38));return ko(n,e,t,!1,r)};dt.version="18.3.1-next-f1338f8080-20240426";function L0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(L0)}catch(n){console.error(n)}}L0(),Lf.exports=dt;var vy=Lf.exports,A0,sd=vy;A0=sd.createRoot,sd.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var xy={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ey=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ge=(n,e)=>{const t=ne.forwardRef(({color:r="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:a="",children:l,...u},c)=>ne.createElement("svg",{ref:c,...xy,width:i,height:i,stroke:r,strokeWidth:o?Number(s)*24/Number(i):s,className:["lucide",`lucide-${Ey(n)}`,a].join(" "),...u},[...e.map(([d,f])=>ne.createElement(d,f)),...Array.isArray(l)?l:[l]]));return t.displayName=`${n}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=Ge("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sy=Ge("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sa=Ge("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ty=Ge("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ly=Ge("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ay=Ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ry=Ge("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iy=Ge("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wy=Ge("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cy=Ge("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ky=Ge("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dy=Ge("MonitorCheck",[["path",{d:"m9 10 2 2 4-4",key:"1gnqz4"}],["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _y=Ge("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const by=Ge("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Py=Ge("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fy=Ge("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I0=Ge("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),Oy={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnbHJreGJveHF6enR2dWZ4dnRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkwMDc2OTksImV4cCI6MjA1NDU4MzY5OX0.e5Nl_QB9jYRtk1AYP03Uycb6bQAaXfXjGg_AmWMO4D8",VITE_SUPABASE_URL:"https://wglrkxboxqzztvufxvtc.supabase.co"},od=n=>{let e;const t=new Set,r=(c,d)=>{const f=typeof c=="function"?c(e):c;if(!Object.is(f,e)){const m=e;e=d??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(h=>h(e,m))}},i=()=>e,l={setState:r,getState:i,getInitialState:()=>u,subscribe:c=>(t.add(c),()=>t.delete(c)),destroy:()=>{(Oy?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),t.clear()}},u=e=n(r,i,l);return l},Ny=n=>n?od(n):od;var w0={exports:{}},C0={},k0={exports:{}},D0={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dr=ne;function My(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Uy=typeof Object.is=="function"?Object.is:My,By=Dr.useState,$y=Dr.useEffect,Gy=Dr.useLayoutEffect,Vy=Dr.useDebugValue;function Hy(n,e){var t=e(),r=By({inst:{value:t,getSnapshot:e}}),i=r[0].inst,s=r[1];return Gy(function(){i.value=t,i.getSnapshot=e,oa(i)&&s({inst:i})},[n,t,e]),$y(function(){return oa(i)&&s({inst:i}),n(function(){oa(i)&&s({inst:i})})},[n]),Vy(t),t}function oa(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Uy(n,t)}catch{return!0}}function Ky(n,e){return e()}var jy=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Ky:Hy;D0.useSyncExternalStore=Dr.useSyncExternalStore!==void 0?Dr.useSyncExternalStore:jy;k0.exports=D0;var zy=k0.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Do=ne,Wy=zy;function Yy(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var qy=typeof Object.is=="function"?Object.is:Yy,Xy=Wy.useSyncExternalStore,Qy=Do.useRef,Jy=Do.useEffect,Zy=Do.useMemo,ev=Do.useDebugValue;C0.useSyncExternalStoreWithSelector=function(n,e,t,r,i){var s=Qy(null);if(s.current===null){var o={hasValue:!1,value:null};s.current=o}else o=s.current;s=Zy(function(){function l(m){if(!u){if(u=!0,c=m,m=r(m),i!==void 0&&o.hasValue){var h=o.value;if(i(h,m))return d=h}return d=m}if(h=d,qy(c,m))return h;var g=r(m);return i!==void 0&&i(h,g)?(c=m,h):(c=m,d=g)}var u=!1,c,d,f=t===void 0?null:t;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,t,r,i]);var a=Xy(n,s[0],s[1]);return Jy(function(){o.hasValue=!0,o.value=a},[a]),ev(a),a};w0.exports=C0;var tv=w0.exports;const nv=cf(tv),_0={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnbHJreGJveHF6enR2dWZ4dnRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzkwMDc2OTksImV4cCI6MjA1NDU4MzY5OX0.e5Nl_QB9jYRtk1AYP03Uycb6bQAaXfXjGg_AmWMO4D8",VITE_SUPABASE_URL:"https://wglrkxboxqzztvufxvtc.supabase.co"},{useDebugValue:rv}=ag,{useSyncExternalStoreWithSelector:iv}=nv;let ad=!1;const sv=n=>n;function ov(n,e=sv,t){(_0?"production":void 0)!=="production"&&t&&!ad&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),ad=!0);const r=iv(n.subscribe,n.getState,n.getServerState||n.getInitialState,e,t);return rv(r),r}const ld=n=>{(_0?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e=typeof n=="function"?Ny(n):n,t=(r,i)=>ov(e,r,i);return Object.assign(t,e),t},b0=n=>n?ld(n):ld,av=10,lv=b0(n=>({isActive:!1,streams:{},error:null,addStream:(e,t)=>n(r=>({streams:{...r.streams,[e]:t}})),removeStream:e=>n(t=>{const{[e]:r,...i}=t.streams;return{streams:i}})})),_u=b0(n=>({data:[],isRecording:!1,startTime:null,customers:[],addCustomer:async(e,t)=>{const r=new Date,i={id:crypto.randomUUID(),firstSeen:r,lastSeen:r,position:e,positionHistory:[{x:e[0],y:e[1],timestamp:r.getTime()}],isActive:!0,boundingBox:t};return n(s=>({customers:[...s.customers,i]})),i.id},updateCustomer:async(e,t,r)=>{const i=new Date;n(s=>({customers:s.customers.map(o=>o.id===e?{...o,lastSeen:i,position:t,boundingBox:r,positionHistory:[...o.positionHistory,{x:t[0],y:t[1],timestamp:i.getTime()}].slice(-av),isActive:!0}:o)}))},deactivateCustomer:async e=>{const t=new Date;n(r=>({customers:r.customers.map(i=>i.id===e?{...i,isActive:!1,lastSeen:t}:i)}))},updateCustomerSnapshot:(e,t)=>{n(r=>({customers:r.customers.map(i=>i.id===e?{...i,snapshot:t}:i)}))}})),uv=({onSourceSelected:n})=>{const[e,t]=ne.useState(""),[r,i]=ne.useState(!1),[s,o]=ne.useState(null),a=c=>{try{return new URL(c),!0}catch{return!1}},l=c=>{const d=c.target.files?.[0];if(d){const f=URL.createObjectURL(d);n({type:"file",url:f})}},u=c=>{if(c.preventDefault(),!e){o("Please enter a stream URL");return}let d=e;if(!d.startsWith("http://")&&!d.startsWith("https://")&&(d=`http://${d}`),!a(d)){o("Please enter a valid URL (e.g., http://example.com/stream)");return}d.includes("pendelcam.kip.uni-heidelberg.de")&&!d.includes("/mjpg/video.mjpg")&&(d="http://pendelcam.kip.uni-heidelberg.de/mjpg/video.mjpg"),d.startsWith("http://")&&(d=`/proxy?url=${encodeURIComponent(d)}`),n({type:"ip",url:d}),t(""),i(!1),o(null)};return D.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[D.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[D.jsx(I0,{className:"w-6 h-6 text-blue-500"}),"Add Video Source"]}),D.jsxs("div",{className:"space-y-4",children:[D.jsx("div",{children:D.jsxs("label",{className:"block w-full cursor-pointer",children:[D.jsx("input",{type:"file",accept:"video/*",onChange:l,className:"hidden"}),D.jsxs("div",{className:"flex items-center justify-center gap-2 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 transition-colors",children:[D.jsx(Py,{className:"w-5 h-5 text-gray-500"}),D.jsx("span",{className:"text-gray-600",children:"Upload Video File"})]})]})}),D.jsx("div",{className:"grid grid-cols-1 gap-4",children:D.jsxs("button",{onClick:()=>{i(!0)},className:`flex items-center justify-center gap-2 p-4 border-2 border-dashed border-gray-300 rounded-lg hover:border-blue-500 hover:text-blue-500 transition-colors ${r?"border-blue-500 text-blue-500":""}`,children:[D.jsx(Iy,{className:"w-5 h-5"}),D.jsx("span",{children:"Add IP Camera"})]})}),r&&D.jsxs("form",{onSubmit:u,className:"space-y-2",children:[D.jsxs("div",{className:"space-y-1",children:[D.jsx("input",{type:"text",value:e,onChange:c=>t(c.target.value),placeholder:"Camera stream URL (e.g., 192.168.1.100/video.mjpg)",className:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"}),D.jsx("p",{className:"text-xs text-gray-500",children:"Example: pendelcam.kip.uni-heidelberg.de or http://camera-ip/video.mjpeg"})]}),D.jsxs("div",{className:"flex gap-2",children:[D.jsx("button",{type:"submit",className:"flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors",children:"Add Stream"}),D.jsx("button",{type:"button",onClick:()=>{i(!1),o(null)},className:"bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"})]})]}),s&&D.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-sm",children:[D.jsx(R0,{className:"w-4 h-4 flex-shrink-0"}),D.jsx("p",{children:s})]}),D.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[D.jsx("h4",{className:"font-semibold text-blue-700 mb-2",children:"Supported Stream Formats:"}),D.jsxs("ul",{className:"list-disc list-inside text-sm text-blue-600 space-y-1",children:[D.jsx("li",{children:"HLS streams (.m3u8)"}),D.jsx("li",{children:"MJPEG streams"}),D.jsx("li",{children:"Direct video streams (.mp4, .webm)"}),D.jsx("li",{children:"Local video files"})]}),D.jsx("p",{className:"mt-2 text-sm text-blue-700",children:"Note: RTSP streams are not supported in browsers. Use HLS or MJPEG instead."})]})]})]})};function cv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var P0={exports:{}};(function(n,e){(function(t){var r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=a.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=a.normalizePath(d.path),a.buildURLFromParts(d)}var f=a.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=a.normalizePath(f.path),a.buildURLFromParts(f)):u;var m=a.parseURL(l);if(!m)throw new Error("Error trying to parse base URL.");if(!m.netLoc&&m.path&&m.path[0]!=="/"){var h=i.exec(m.path);m.netLoc=h[1],m.path=h[2]}m.netLoc&&!m.path&&(m.path="/");var g={scheme:m.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(g.netLoc=m.netLoc,f.path[0]!=="/"))if(!f.path)g.path=m.path,f.params||(g.params=m.params,f.query||(g.query=m.query));else{var y=m.path,p=y.substring(0,y.lastIndexOf("/")+1)+f.path;g.path=a.normalizePath(p)}return g.path===null&&(g.path=c.alwaysNormalize?a.normalizePath(f.path):f.path),a.buildURLFromParts(g)},parseURL:function(l){var u=r.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(s,"");l.length!==(l=l.replace(o,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};n.exports=a})()})(P0);var bu=P0.exports;function ud(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function Ne(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ud(Object(t),!0).forEach(function(r){hv(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ud(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function dv(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function fv(n){var e=dv(n,"string");return typeof e=="symbol"?e:String(e)}function hv(n,e,t){return e=fv(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function we(){return we=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},we.apply(this,arguments)}const $=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},mv=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=gv},gv=Number.MAX_SAFE_INTEGER||9007199254740991;let v=function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n}({}),J=function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n}({}),k=function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.UNKNOWN="unknown",n}({});const Fn=function(){},Tl={trace:Fn,debug:Fn,log:Fn,warn:Fn,info:Fn,error:Fn};let li=Tl;function pv(n){const e=self.console[n];return e?e.bind(self.console,`[${n}] >`):Fn}function yv(n,...e){e.forEach(function(t){li[t]=n[t]?n[t].bind(n):pv(t)})}function vv(n,e){if(typeof console=="object"&&n===!0||typeof n=="object"){yv(n,"debug","log","info","warn","error");try{li.log(`Debug logs enabled for "${e}" in hls.js version 1.5.20`)}catch{li=Tl}}else li=Tl}const R=li,xv=/^(\d+)x(\d+)$/,cd=/(.+?)=(".*?"|.*?)(?:,|$)/g;class xe{constructor(e){typeof e=="string"&&(e=xe.parseAttrList(e)),we(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const r=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(i*2,i*2+2),16);return r}else return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xv.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e){let t;const r={},i='"';for(cd.lastIndex=0;(t=cd.exec(e))!==null;){let s=t[2];s.indexOf(i)===0&&s.lastIndexOf(i)===s.length-1&&(s=s.slice(1,-1));const o=t[1].trim();r[o]=s}return r}}function Ev(n){return n!=="ID"&&n!=="CLASS"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Sv(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"}class F0{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){const r=t.attr;for(const i in r)if(Object.prototype.hasOwnProperty.call(e,i)&&e[i]!==r[i]){R.warn(`DATERANGE tag attribute: "${i}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=i;break}e=we(new xe({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=new Date(this.attr["END-DATE"]);$(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if($(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&$(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class _o{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var le={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class O0{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[le.AUDIO]:null,[le.VIDEO]:null,[le.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){const r=e.split("@",2);let i;r.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(r[1]),this._byteRange=[i,parseInt(r[0])+i]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=bu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}}class aa extends O0{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new _o,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!$(this.programDateTime))return null;const e=$(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,i,s,o=!1){const{elementaryStreams:a}=this,l=a[e];if(!l){a[e]={startPTS:t,endPTS:r,startDTS:i,endDTS:s,partial:o};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,r),l.startDTS=Math.min(l.startDTS,i),l.endDTS=Math.max(l.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[le.AUDIO]=null,e[le.VIDEO]=null,e[le.AUDIOVIDEO]=null}}class Tv extends O0{constructor(e,t,r,i,s){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new _o,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}const Lv=10;class Av{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?$(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Lv}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function Pu(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Rv(n){const e=Ll(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function Iv(n){const e=function(r,i,s){const o=r[i];r[i]=r[s],r[s]=o};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function wv(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const r=e[1].split(";"),i=r[r.length-1].split(",");if(i.length===2){const s=i[0]==="base64",o=i[1];s?(r.splice(-1,1),t=Pu(o)):t=Rv(o)}}return t}function Ll(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}const _r=typeof self<"u"?self:void 0;var ae={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},et={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function la(n){switch(n){case et.FAIRPLAY:return ae.FAIRPLAY;case et.PLAYREADY:return ae.PLAYREADY;case et.WIDEVINE:return ae.WIDEVINE;case et.CLEARKEY:return ae.CLEARKEY}}var Zi={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",FAIRPLAY:"94ce86fb07ff4f43adb893d2fa968ca2",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function ua(n){if(n===Zi.WIDEVINE)return ae.WIDEVINE;if(n===Zi.PLAYREADY)return ae.PLAYREADY;if(n===Zi.CENC||n===Zi.CLEARKEY)return ae.CLEARKEY}function ca(n){switch(n){case ae.FAIRPLAY:return et.FAIRPLAY;case ae.PLAYREADY:return et.PLAYREADY;case ae.WIDEVINE:return et.WIDEVINE;case ae.CLEARKEY:return et.CLEARKEY}}function es(n){const{drmSystems:e,widevineLicenseUrl:t}=n,r=e?[ae.FAIRPLAY,ae.WIDEVINE,ae.PLAYREADY,ae.CLEARKEY].filter(i=>!!e[i]):[];return!r[ae.WIDEVINE]&&t&&r.push(ae.WIDEVINE),r}const N0=function(n){return _r!=null&&(n=_r.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function Cv(n,e,t,r){let i;switch(n){case ae.FAIRPLAY:i=["cenc","sinf"];break;case ae.WIDEVINE:case ae.PLAYREADY:i=["cenc"];break;case ae.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return kv(i,e,t,r)}function kv(n,e,t,r){return[{initDataTypes:n,persistentState:r.persistentState||"optional",distinctiveIdentifier:r.distinctiveIdentifier||"optional",sessionTypes:r.sessionTypes||[r.sessionType||"temporary"],audioCapabilities:e.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:r.audioRobustness||"",encryptionScheme:r.audioEncryptionScheme||null})),videoCapabilities:t.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:r.videoRobustness||"",encryptionScheme:r.videoEncryptionScheme||null}))}]}function M0(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),r=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("KID")[0];if(o){const a=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(a){const l=Pu(a).subarray(0,16);return Iv(l),l}}return null}function Vn(n,e,t){return Uint8Array.prototype.slice?n.slice(e,t):new Uint8Array(Array.prototype.slice.call(n,e,t))}const Fu=(n,e)=>e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,U0=(n,e)=>e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128,Ii=(n,e)=>{const t=e;let r=0;for(;Fu(n,e);){r+=10;const i=bo(n,e+6);r+=i,U0(n,e+10)&&(r+=10),e+=r}if(r>0)return n.subarray(t,t+r)},bo=(n,e)=>{let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t},Dv=(n,e)=>Fu(n,e)&&bo(n,e+6)+10<=n.length-e,Ou=n=>{const e=$0(n);for(let t=0;t<e.length;t++){const r=e[t];if(B0(r))return Nv(r)}},B0=n=>n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp",_v=n=>{const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=bo(n,4),r=10;return{type:e,size:t,data:n.subarray(r,r+t)}},$0=n=>{let e=0;const t=[];for(;Fu(n,e);){const r=bo(n,e+6);e+=10;const i=e+r;for(;e+8<i;){const s=_v(n.subarray(e)),o=bv(s);o&&t.push(o),e+=s.size+10}U0(n,e)&&(e+=10)}return t},bv=n=>n.type==="PRIV"?Pv(n):n.type[0]==="W"?Ov(n):Fv(n),Pv=n=>{if(n.size<2)return;const e=jt(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}},Fv=n=>{if(n.size<2)return;if(n.type==="TXXX"){let t=1;const r=jt(n.data.subarray(t),!0);t+=r.length+1;const i=jt(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=jt(n.data.subarray(1));return{key:n.type,data:e}},Ov=n=>{if(n.type==="WXXX"){if(n.size<2)return;let t=1;const r=jt(n.data.subarray(t),!0);t+=r.length+1;const i=jt(n.data.subarray(t));return{key:n.type,info:r,data:i}}const e=jt(n.data);return{key:n.type,data:e}},Nv=n=>{if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,t&&(r+=4772185884e-2),Math.round(r)}},jt=(n,e=!1)=>{const t=Mv();if(t){const u=t.decode(n);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const r=n.length;let i,s,o,a="",l=0;for(;l<r;){if(i=n[l++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=n[l++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=n[l++],o=n[l++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(o&63)<<0);break}}return a};let da;function Mv(){if(!navigator.userAgent.includes("PlayStation 4"))return!da&&typeof self.TextDecoder<"u"&&(da=new self.TextDecoder("utf-8")),da}const Ut={hexDump:function(n){let e="";for(let t=0;t<n.length;t++){let r=n[t].toString(16);r.length<2&&(r="0"+r),e+=r}return e}},no=Math.pow(2,32)-1,Uv=[].push,G0={video:1,audio:2,id3:3,text:4};function Ce(n){return String.fromCharCode.apply(null,n)}function V0(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function q(n,e){const t=H0(n,e);return t<0?4294967296+t:t}function dd(n,e){let t=q(n,e);return t*=Math.pow(2,32),t+=q(n,e+4),t}function H0(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function fa(n,e,t){n[e]=t>>24,n[e+1]=t>>16&255,n[e+2]=t>>8&255,n[e+3]=t&255}function Bv(n){const e=n.byteLength;for(let t=0;t<e;){const r=q(n,t);if(r>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=r>1?t+r:e}return!1}function Z(n,e){const t=[];if(!e.length)return t;const r=n.byteLength;for(let i=0;i<r;){const s=q(n,i),o=Ce(n.subarray(i+4,i+8)),a=s>1?i+s:r;if(o===e[0])if(e.length===1)t.push(n.subarray(i+8,a));else{const l=Z(n.subarray(i+8,a),e.slice(1));l.length&&Uv.apply(t,l)}i=a}return t}function $v(n){const e=[],t=n[0];let r=8;const i=q(n,r);r+=4;let s=0,o=0;t===0?(s=q(n,r),o=q(n,r+4),r+=8):(s=dd(n,r),o=dd(n,r+8),r+=16),r+=2;let a=n.length+o;const l=V0(n,r);r+=2;for(let u=0;u<l;u++){let c=r;const d=q(n,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return R.warn("SIDX has hierarchical references (not supported)"),null;const h=q(n,c);c+=4,e.push({referenceSize:f,subsegmentDuration:h,info:{duration:h/i,start:a,end:a+f-1}}),a+=f,c+=4,r=c}return{earliestPresentationTime:s,timescale:i,version:t,referencesCount:l,references:e}}function K0(n){const e=[],t=Z(n,["moov","trak"]);for(let i=0;i<t.length;i++){const s=t[i],o=Z(s,["tkhd"])[0];if(o){let a=o[0];const l=q(o,a===0?12:20),u=Z(s,["mdia","mdhd"])[0];if(u){a=u[0];const c=q(u,a===0?12:20),d=Z(s,["mdia","hdlr"])[0];if(d){const f=Ce(d.subarray(8,12)),m={soun:le.AUDIO,vide:le.VIDEO}[f];if(m){const h=Z(s,["mdia","minf","stbl","stsd"])[0],g=Gv(h);e[l]={timescale:c,type:m},e[m]=Ne({timescale:c,id:l},g)}}}}}return Z(n,["moov","mvex","trex"]).forEach(i=>{const s=q(i,4),o=e[s];o&&(o.default={duration:q(i,12),flags:q(i,20)})}),e}function Gv(n){const e=n.subarray(8),t=e.subarray(86),r=Ce(e.subarray(4,8));let i=r;const s=r==="enca"||r==="encv";if(s){const a=Z(e,[r])[0].subarray(r==="enca"?28:78);Z(a,["sinf"]).forEach(u=>{const c=Z(u,["schm"])[0];if(c){const d=Ce(c.subarray(4,8));if(d==="cbcs"||d==="cenc"){const f=Z(u,["frma"])[0];f&&(i=Ce(f))}}})}switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const o=Z(t,["avcC"])[0];i+="."+ts(o[1])+ts(o[2])+ts(o[3]);break}case"mp4a":{const o=Z(e,[r])[0],a=Z(o.subarray(28),["esds"])[0];if(a&&a.length>12){let l=4;if(a[l++]!==3)break;l=ha(a,l),l+=2;const u=a[l++];if(u&128&&(l+=2),u&64&&(l+=a[l++]),a[l++]!==4)break;l=ha(a,l);const c=a[l++];if(c===64)i+="."+ts(c);else break;if(l+=12,a[l++]!==5)break;l=ha(a,l);const d=a[l++];let f=(d&248)>>3;f===31&&(f+=1+((d&7)<<3)+((a[l]&224)>>5)),i+="."+f}break}case"hvc1":case"hev1":{const o=Z(t,["hvcC"])[0],a=o[1],l=["","A","B","C"][a>>6],u=a&31,c=q(o,2),d=(a&32)>>5?"H":"L",f=o[12],m=o.subarray(6,12);i+="."+l+u,i+="."+c.toString(16).toUpperCase(),i+="."+d+f;let h="";for(let g=m.length;g--;){const y=m[g];(y||h)&&(h="."+y.toString(16).toUpperCase()+h)}i+=h;break}case"dvh1":case"dvhe":{const o=Z(t,["dvcC"])[0],a=o[2]>>1&127,l=o[2]<<5&32|o[3]>>3&31;i+="."+Nt(a)+"."+Nt(l);break}case"vp09":{const o=Z(t,["vpcC"])[0],a=o[4],l=o[5],u=o[6]>>4&15;i+="."+Nt(a)+"."+Nt(l)+"."+Nt(u);break}case"av01":{const o=Z(t,["av1C"])[0],a=o[1]>>>5,l=o[1]&31,u=o[2]>>>7?"H":"M",c=(o[2]&64)>>6,d=(o[2]&32)>>5,f=a===2&&c?d?12:10:c?10:8,m=(o[2]&16)>>4,h=(o[2]&8)>>3,g=(o[2]&4)>>2,y=o[2]&3;i+="."+a+"."+Nt(l)+u+"."+Nt(f)+"."+m+"."+h+g+y+"."+Nt(1)+"."+Nt(1)+"."+Nt(1)+"."+0;break}}return{codec:i,encrypted:s}}function ha(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function ts(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function Nt(n){return(n<10?"0":"")+n}function Vv(n,e){if(!n||!e)return n;const t=e.keyId;return t&&e.isCommonEncryption&&Z(n,["moov","trak"]).forEach(i=>{const o=Z(i,["mdia","minf","stbl","stsd"])[0].subarray(8);let a=Z(o,["enca"]);const l=a.length>0;l||(a=Z(o,["encv"])),a.forEach(u=>{const c=l?u.subarray(28):u.subarray(78);Z(c,["sinf"]).forEach(f=>{const m=j0(f);if(m){const h=m.subarray(8,24);h.some(g=>g!==0)||(R.log(`[eme] Patching keyId in 'enc${l?"a":"v"}>sinf>>tenc' box: ${Ut.hexDump(h)} -> ${Ut.hexDump(t)}`),m.set(t,8))}})})}),n}function j0(n){const e=Z(n,["schm"])[0];if(e){const t=Ce(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Z(n,["schi","tenc"])[0]}return null}function Hv(n,e){return Z(e,["moof","traf"]).reduce((t,r)=>{const i=Z(r,["tfdt"])[0],s=i[0],o=Z(r,["tfhd"]).reduce((a,l)=>{const u=q(l,4),c=n[u];if(c){let d=q(i,4);if(s===1){if(d===no)return R.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),a;d*=no+1,d+=q(i,8)}const f=c.timescale||9e4,m=d/f;if($(m)&&(a===null||m<a))return m}return a},null);return o!==null&&$(o)&&(t===null||o<t)?o:t},null)}function Kv(n,e){let t=0,r=0,i=0;const s=Z(n,["moof","traf"]);for(let o=0;o<s.length;o++){const a=s[o],l=Z(a,["tfhd"])[0],u=q(l,4),c=e[u];if(!c)continue;const d=c.default,f=q(l,0)|d?.flags;let m=d?.duration;f&8&&(f&2?m=q(l,12):m=q(l,8));const h=c.timescale||9e4,g=Z(a,["trun"]);for(let y=0;y<g.length;y++){if(t=jv(g[y]),!t&&m){const p=q(g[y],4);t=m*p}c.type===le.VIDEO?r+=t/h:c.type===le.AUDIO&&(i+=t/h)}}if(r===0&&i===0){let o=1/0,a=0,l=0;const u=Z(n,["sidx"]);for(let c=0;c<u.length;c++){const d=$v(u[c]);if(d!=null&&d.references){o=Math.min(o,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((m,h)=>m+h.info.duration||0,0);a=Math.max(a,f+d.earliestPresentationTime/d.timescale),l=a-o}}if(l&&$(l))return l}return r||i}function jv(n){const e=q(n,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let r=0;const i=q(n,4);for(let s=0;s<i;s++){if(e&256){const o=q(n,t);r+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return r}function zv(n,e,t){Z(e,["moof","traf"]).forEach(r=>{Z(r,["tfhd"]).forEach(i=>{const s=q(i,4),o=n[s];if(!o)return;const a=o.timescale||9e4;Z(r,["tfdt"]).forEach(l=>{const u=l[0],c=t*a;if(c){let d=q(l,4);if(u===0)d-=c,d=Math.max(d,0),fa(l,4,d);else{d*=Math.pow(2,32),d+=q(l,8),d-=c,d=Math.max(d,0);const f=Math.floor(d/(no+1)),m=Math.floor(d%(no+1));fa(l,4,f),fa(l,8,m)}}})})})}function Wv(n){const e={valid:null,remainder:null},t=Z(n,["moof"]);if(t.length<2)return e.remainder=n,e;const r=t[t.length-1];return e.valid=Vn(n,0,r.byteOffset-8),e.remainder=Vn(n,r.byteOffset-8),e}function St(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function fd(n,e){const t=[],r=e.samples,i=e.timescale,s=e.id;let o=!1;return Z(r,["moof"]).map(l=>{const u=l.byteOffset-8;Z(l,["traf"]).map(d=>{const f=Z(d,["tfdt"]).map(m=>{const h=m[0];let g=q(m,4);return h===1&&(g*=Math.pow(2,32),g+=q(m,8)),g/i})[0];return f!==void 0&&(n=f),Z(d,["tfhd"]).map(m=>{const h=q(m,4),g=q(m,0)&16777215,y=(g&1)!==0,p=(g&2)!==0,x=(g&8)!==0;let E=0;const T=(g&16)!==0;let S=0;const A=(g&32)!==0;let L=8;h===s&&(y&&(L+=8),p&&(L+=4),x&&(E=q(m,L),L+=4),T&&(S=q(m,L),L+=4),A&&(L+=4),e.type==="video"&&(o=Yv(e.codec)),Z(d,["trun"]).map(C=>{const N=C[0],w=q(C,0)&16777215,F=(w&1)!==0;let z=0;const U=(w&4)!==0,V=(w&256)!==0;let Y=0;const K=(w&512)!==0;let Q=0;const O=(w&1024)!==0,P=(w&2048)!==0;let _=0;const W=q(C,4);let j=8;F&&(z=q(C,j),j+=4),U&&(j+=4);let te=z+u;for(let oe=0;oe<W;oe++){if(V?(Y=q(C,j),j+=4):Y=E,K?(Q=q(C,j),j+=4):Q=S,O&&(j+=4),P&&(N===0?_=q(C,j):_=H0(C,j),j+=4),e.type===le.VIDEO){let pe=0;for(;pe<Q;){const ce=q(r,te);if(te+=4,qv(o,r[te])){const de=r.subarray(te,te+ce);z0(de,o?2:1,n+_/i,t)}te+=ce,pe+=ce+4}}n+=Y/i}}))})})}),t}function Yv(n){if(!n)return!1;const e=n.indexOf("."),t=e<0?n:n.substring(0,e);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function qv(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function z0(n,e,t,r){const i=W0(n);let s=0;s+=e;let o=0,a=0,l=0;for(;s<i.length;){o=0;do{if(s>=i.length)break;l=i[s++],o+=l}while(l===255);a=0;do{if(s>=i.length)break;l=i[s++],a+=l}while(l===255);const u=i.length-s;let c=s;if(a<u)s+=a;else if(a>u){R.error(`Malformed SEI payload. ${a} is too small, only ${u} bytes left to parse.`);break}if(o===4){if(i[c++]===181){const f=V0(i,c);if(c+=2,f===49){const m=q(i,c);if(c+=4,m===1195456820){const h=i[c++];if(h===3){const g=i[c++],y=31&g,p=64&g,x=p?2+y*3:0,E=new Uint8Array(x);if(p){E[0]=g;for(let T=1;T<x;T++)E[T]=i[c++]}r.push({type:h,payloadType:o,pts:t,bytes:E})}}}}}else if(o===5&&a>16){const d=[];for(let h=0;h<16;h++){const g=i[c++].toString(16);d.push(g.length==1?"0"+g:g),(h===3||h===5||h===7||h===9)&&d.push("-")}const f=a-16,m=new Uint8Array(f);for(let h=0;h<f;h++)m[h]=i[c++];r.push({payloadType:o,pts:t,uuid:d.join(""),userData:jt(m),userDataBytes:m})}}}function W0(n){const e=n.byteLength,t=[];let r=1;for(;r<e-2;)n[r]===0&&n[r+1]===0&&n[r+2]===3?(t.push(r+2),r+=2):r++;if(t.length===0)return n;const i=e-t.length,s=new Uint8Array(i);let o=0;for(r=0;r<i;o++,r++)o===t[0]&&(o++,t.shift()),s[r]=n[o];return s}function Xv(n){const e=n[0];let t="",r="",i=0,s=0,o=0,a=0,l=0,u=0;if(e===0){for(;Ce(n.subarray(u,u+1))!=="\0";)t+=Ce(n.subarray(u,u+1)),u+=1;for(t+=Ce(n.subarray(u,u+1)),u+=1;Ce(n.subarray(u,u+1))!=="\0";)r+=Ce(n.subarray(u,u+1)),u+=1;r+=Ce(n.subarray(u,u+1)),u+=1,i=q(n,12),s=q(n,16),a=q(n,20),l=q(n,24),u=28}else if(e===1){u+=4,i=q(n,u),u+=4;const d=q(n,u);u+=4;const f=q(n,u);for(u+=4,o=2**32*d+f,mv(o)||(o=Number.MAX_SAFE_INTEGER,R.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),a=q(n,u),u+=4,l=q(n,u),u+=4;Ce(n.subarray(u,u+1))!=="\0";)t+=Ce(n.subarray(u,u+1)),u+=1;for(t+=Ce(n.subarray(u,u+1)),u+=1;Ce(n.subarray(u,u+1))!=="\0";)r+=Ce(n.subarray(u,u+1)),u+=1;r+=Ce(n.subarray(u,u+1)),u+=1}const c=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:r,timeScale:i,presentationTime:o,presentationTimeDelta:s,eventDuration:a,id:l,payload:c}}function Qv(n,...e){const t=e.length;let r=8,i=t;for(;i--;)r+=e[i].byteLength;const s=new Uint8Array(r);for(s[0]=r>>24&255,s[1]=r>>16&255,s[2]=r>>8&255,s[3]=r&255,s.set(n,4),i=0,r=8;i<t;i++)s.set(e[i],r),r+=e[i].byteLength;return s}function Jv(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let r,i;r=0,i=new Uint8Array;let s;r>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),Qv([112,115,115,104],new Uint8Array([r,0,0,0]),n,s,i,o,t||new Uint8Array)}function Zv(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let r=0;for(;r+32<t;){const i=new DataView(n,r),s=ex(i);e.push(s),r+=s.size}}return e}function ex(n){const e=n.getUint32(0),t=n.byteOffset,r=n.byteLength;if(r<e)return{offset:t,size:r};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const s=n.getUint32(8)>>>24;if(s!==0&&s!==1)return{offset:t,size:e};const o=n.buffer,a=Ut.hexDump(new Uint8Array(o,t+12,16)),l=n.getUint32(28);let u=null,c=null;if(s===0){if(e-32<l||l<22)return{offset:t,size:e};c=new Uint8Array(o,t+32,l)}else if(s===1){if(!l||r<t+32+l*16+16)return{offset:t,size:e};u=[];for(let d=0;d<l;d++)u.push(new Uint8Array(o,t+32+d*16,16))}return{version:s,systemId:a,kids:u,data:c,offset:t,size:e}}let ns={};class wi{static clearKeyUriToKeyIdMap(){ns={}}constructor(e,t,r,i=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=s,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&e!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case et.FAIRPLAY:case et.WIDEVINE:case et.PLAYREADY:case et.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method==="AES-128"&&!this.iv&&R.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const r=tx(e);return new wi(this.method,this.uri,"identity",this.keyFormatVersions,r)}const t=wv(this.uri);if(t)switch(this.keyFormat){case et.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case et.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Jv(r,null,t),this.keyId=M0(t);break}default:{let r=t.subarray(0,16);if(r.length!==16){const i=new Uint8Array(16);i.set(r,16-r.length),r=i}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r=ns[this.uri];if(!r){const i=Object.keys(ns).length%Number.MAX_SAFE_INTEGER;r=new Uint8Array(16),new DataView(r.buffer,12,4).setUint32(0,i),ns[this.uri]=r}this.keyId=r}return this}}function tx(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Y0=/\{\$([a-zA-Z0-9-_]+)\}/g;function hd(n){return Y0.test(n)}function Je(n,e,t){if(n.variableList!==null||n.hasVariableRefs)for(let r=t.length;r--;){const i=t[r],s=e[i];s&&(e[i]=Al(n,s))}}function Al(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(Y0,r=>{const i=r.substring(2,r.length-1),s=t?.[i];return s===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),r):s})}return e}function md(n,e,t){let r=n.variableList;r||(n.variableList=r={});let i,s;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(i))s=o.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(o){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else i=e.NAME,s=e.VALUE;i in r?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):r[i]=s||""}function nx(n,e,t){const r=e.IMPORT;if(t&&r in t){let i=n.variableList;i||(n.variableList=i={}),i[r]=t[r]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${r}"`))}function qn(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function rx(n){return typeof self<"u"&&n===self.ManagedMediaSource}const ro={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function ix(n,e){const t=ro[e];return!!t&&!!t[n.slice(0,4)]}function ma(n,e,t=!0){return!n.split(",").some(r=>!q0(r,e,t))}function q0(n,e,t=!0){var r;const i=qn(t);return(r=i?.isTypeSupported(Ci(n,e)))!=null?r:!1}function Ci(n,e){return`${e}/mp4;codecs="${n}"`}function gd(n){if(n){const e=n.substring(0,4);return ro.video[e]}return 2}function io(n){return n.split(",").reduce((e,t)=>{const r=ro.video[t];return r?(r*2+e)/(e?3:2):(ro.audio[t]+e)/(e?2:1)},0)}const ga={};function sx(n,e=!0){if(ga[n])return ga[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[n];for(let r=0;r<t.length;r++)if(q0(t[r],"audio",e))return ga[n]=t[r],t[r];return n}const ox=/flac|opus/i;function so(n,e=!0){return n.replace(ox,t=>sx(t.toLowerCase(),e))}function pd(n,e){return n&&n!=="mp4a"?n:e&&e.split(",")[0]}function ax(n){const e=n.split(",");for(let t=0;t<e.length;t++){const r=e[t].split(".");if(r.length>2){let i=r.shift()+".";i+=parseInt(r.shift()).toString(16),i+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e[t]=i}}return e.join(",")}const yd=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vd=/#EXT-X-MEDIA:(.*)/g,lx=/^#EXT(?:INF|-X-TARGETDURATION):/m,xd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),ux=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Gt{static findGroup(e,t){for(let r=0;r<e.length;r++){const i=e[r];if(i.id===t)return i}}static resolve(e,t){return bu.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return lx.test(e)}static parseMasterPlaylist(e,t){const r=hd(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];yd.lastIndex=0;let o;for(;(o=yd.exec(e))!=null;)if(o[1]){var a;const u=new xe(o[1]);Je(i,u,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const c=Al(i,o[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Gt.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),cx(u.CODECS,d),(a=d.unknownCodecs)!=null&&a.length||s.push(d),i.levels.push(d)}else if(o[3]){const u=o[3],c=o[4];switch(u){case"SESSION-DATA":{const d=new xe(c);Je(i,d,["DATA-ID","LANGUAGE","VALUE","URI"]);const f=d["DATA-ID"];f&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[f]=d);break}case"SESSION-KEY":{const d=Ed(c,t,i);d.encrypted&&d.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(d)):R.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new xe(c);Je(i,d,["NAME","VALUE","QUERYPARAM"]),md(i,d,t)}break}case"CONTENT-STEERING":{const d=new xe(c);Je(i,d,["SERVER-URI","PATHWAY-ID"]),i.contentSteering={uri:Gt.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Sd(c);break}}}const l=s.length>0&&s.length<i.levels.length;return i.levels=l?s:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,r){let i;const s={},o=r.levels,a={AUDIO:o.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:o.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(vd.lastIndex=0;(i=vd.exec(e))!==null;){const u=new xe(i[1]),c=u.TYPE;if(c){const d=a[c],f=s[c]||[];s[c]=f,Je(r,u,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const m=u.LANGUAGE,h=u["ASSOC-LANGUAGE"],g=u.CHANNELS,y=u.CHARACTERISTICS,p=u["INSTREAM-ID"],x={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||m||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:m,url:u.URI?Gt.resolve(u.URI,t):""};if(h&&(x.assocLang=h),g&&(x.channels=g),y&&(x.characteristics=y),p&&(x.instreamId=p),d!=null&&d.length){const E=Gt.findGroup(d,x.groupId)||d[0];Td(x,E,"audioCodec"),Td(x,E,"textCodec")}f.push(x)}}return s}static parseLevelPlaylist(e,t,r,i,s,o){const a=new Av(t),l=a.fragments;let u=null,c=0,d=0,f=0,m=0,h=null,g=new aa(i,t),y,p,x,E=-1,T=!1,S=null;for(xd.lastIndex=0,a.m3u8=e,a.hasVariableRefs=hd(e);(y=xd.exec(e))!==null;){T&&(T=!1,g=new aa(i,t),g.start=f,g.sn=c,g.cc=m,g.level=r,u&&(g.initSegment=u,g.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null,S&&(g.setByteRange(S),S=null)));const N=y[1];if(N){g.duration=parseFloat(N);const w=(" "+y[2]).slice(1);g.title=w||null,g.tagList.push(w?["INF",N,w]:["INF",N])}else if(y[3]){if($(g.duration)){g.start=f,x&&Rd(g,x,a),g.sn=c,g.level=r,g.cc=m,l.push(g);const w=(" "+y[3]).slice(1);g.relurl=Al(a,w),Ld(g,h),h=g,f+=g.duration,c++,d=0,T=!0}}else if(y[4]){const w=(" "+y[4]).slice(1);h?g.setByteRange(w,h):g.setByteRange(w)}else if(y[5])g.rawProgramDateTime=(" "+y[5]).slice(1),g.tagList.push(["PROGRAM-DATE-TIME",g.rawProgramDateTime]),E===-1&&(E=l.length);else{if(y=y[0].match(ux),!y){R.warn("No matches on slow regex match for level playlist!");continue}for(p=1;p<y.length&&!(typeof y[p]<"u");p++);const w=(" "+y[p]).slice(1),F=(" "+y[p+1]).slice(1),z=y[p+2]?(" "+y[p+2]).slice(1):"";switch(w){case"PLAYLIST-TYPE":a.type=F.toUpperCase();break;case"MEDIA-SEQUENCE":c=a.startSN=parseInt(F);break;case"SKIP":{const U=new xe(F);Je(a,U,["RECENTLY-REMOVED-DATERANGES"]);const V=U.decimalInteger("SKIPPED-SEGMENTS");if($(V)){a.skippedSegments=V;for(let K=V;K--;)l.unshift(null);c+=V}const Y=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(a.recentlyRemovedDateranges=Y.split("	"));break}case"TARGETDURATION":a.targetduration=Math.max(parseInt(F),1);break;case"VERSION":a.version=parseInt(F);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":a.live=!1;break;case"#":(F||z)&&g.tagList.push(z?[F,z]:[F]);break;case"DISCONTINUITY":m++,g.tagList.push(["DIS"]);break;case"GAP":g.gap=!0,g.tagList.push([w]);break;case"BITRATE":g.tagList.push([w,F]);break;case"DATERANGE":{const U=new xe(F);Je(a,U,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),Je(a,U,U.clientAttrs);const V=new F0(U,a.dateRanges[U.ID]);V.isValid||a.skippedSegments?a.dateRanges[V.id]=V:R.warn(`Ignoring invalid DATERANGE tag: "${F}"`),g.tagList.push(["EXT-X-DATERANGE",F]);break}case"DEFINE":{{const U=new xe(F);Je(a,U,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in U?nx(a,U,o):md(a,U,t)}break}case"DISCONTINUITY-SEQUENCE":m=parseInt(F);break;case"KEY":{const U=Ed(F,t,a);if(U.isSupported()){if(U.method==="NONE"){x=void 0;break}x||(x={}),x[U.keyFormat]&&(x=we({},x)),x[U.keyFormat]=U}else R.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${F}"`);break}case"START":a.startTimeOffset=Sd(F);break;case"MAP":{const U=new xe(F);if(Je(a,U,["BYTERANGE","URI"]),g.duration){const V=new aa(i,t);Ad(V,U,r,x),u=V,g.initSegment=u,u.rawProgramDateTime&&!g.rawProgramDateTime&&(g.rawProgramDateTime=u.rawProgramDateTime)}else{const V=g.byteRangeEndOffset;if(V){const Y=g.byteRangeStartOffset;S=`${V-Y}@${Y}`}else S=null;Ad(g,U,r,x),u=g,T=!0}break}case"SERVER-CONTROL":{const U=new xe(F);a.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),a.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),a.canSkipDateRanges=a.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),a.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),a.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const U=new xe(F);a.partTarget=U.decimalFloatingPoint("PART-TARGET");break}case"PART":{let U=a.partList;U||(U=a.partList=[]);const V=d>0?U[U.length-1]:void 0,Y=d++,K=new xe(F);Je(a,K,["BYTERANGE","URI"]);const Q=new Tv(K,g,t,Y,V);U.push(Q),g.duration+=Q.duration;break}case"PRELOAD-HINT":{const U=new xe(F);Je(a,U,["URI"]),a.preloadHint=U;break}case"RENDITION-REPORT":{const U=new xe(F);Je(a,U,["URI"]),a.renditionReports=a.renditionReports||[],a.renditionReports.push(U);break}default:R.warn(`line parsed but not handled: ${y}`);break}}}h&&!h.relurl?(l.pop(),f-=h.duration,a.partList&&(a.fragmentHint=h)):a.partList&&(Ld(g,h),g.cc=m,a.fragmentHint=g,x&&Rd(g,x,a));const A=l.length,L=l[0],C=l[A-1];if(f+=a.skippedSegments*a.targetduration,f>0&&A&&C){a.averagetargetduration=f/A;const N=C.sn;a.endSN=N!=="initSegment"?N:0,a.live||(C.endList=!0),L&&(a.startCC=L.cc)}else a.endSN=0,a.startCC=0;return a.fragmentHint&&(f+=a.fragmentHint.duration),a.totalduration=f,a.endCC=m,E>0&&dx(l,E),a}}function Ed(n,e,t){var r,i;const s=new xe(n);Je(t,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const o=(r=s.METHOD)!=null?r:"",a=s.URI,l=s.hexadecimalInteger("IV"),u=s.KEYFORMATVERSIONS,c=(i=s.KEYFORMAT)!=null?i:"identity";a&&s.IV&&!l&&R.error(`Invalid IV: ${s.IV}`);const d=a?Gt.resolve(a,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new wi(o,d,c,f,l)}function Sd(n){const t=new xe(n).decimalFloatingPoint("TIME-OFFSET");return $(t)?t:null}function cx(n,e){let t=(n||"").split(/[ ,]+/).filter(r=>r);["video","audio","text"].forEach(r=>{const i=t.filter(s=>ix(s,r));i.length&&(e[`${r}Codec`]=i.join(","),t=t.filter(s=>i.indexOf(s)===-1))}),e.unknownCodecs=t}function Td(n,e,t){const r=e[t];r&&(n[t]=r)}function dx(n,e){let t=n[e];for(let r=e;r--;){const i=n[r];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function Ld(n,e){n.rawProgramDateTime?n.programDateTime=Date.parse(n.rawProgramDateTime):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime),$(n.programDateTime)||(n.programDateTime=null,n.rawProgramDateTime=null)}function Ad(n,e,t,r){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",r&&(n.levelkeys=r),n.initSegment=null}function Rd(n,e,t){n.levelkeys=e;const{encryptedFragments:r}=t;(!r.length||r[r.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&r.push(n)}var ie={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},X={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function Id(n){const{type:e}=n;switch(e){case ie.AUDIO_TRACK:return X.AUDIO;case ie.SUBTITLE_TRACK:return X.SUBTITLE;default:return X.MAIN}}function pa(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class fx{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(v.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,i=t.loader,s=r||i,o=new s(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ie.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){const{id:r,level:i,pathwayId:s,url:o,deliveryDirectives:a}=t;this.load({id:r,level:i,pathwayId:s,responseType:"text",type:ie.LEVEL,url:o,deliveryDirectives:a})}onAudioTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:ie.AUDIO_TRACK,url:s,deliveryDirectives:o})}onSubtitleTrackLoading(e,t){const{id:r,groupId:i,url:s,deliveryDirectives:o}=t;this.load({id:r,groupId:i,level:null,responseType:"text",type:ie.SUBTITLE_TRACK,url:s,deliveryDirectives:o})}load(e){var t;const r=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=i.context;if(u&&u.url===e.url&&u.level===e.level){R.trace("[playlist-loader]: playlist request ongoing");return}R.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let s;if(e.type===ie.MANIFEST?s=r.manifestLoadPolicy.default:s=we({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),$((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ie.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ie.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ie.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;s=we({},s,{maxTimeToFirstByteMs:Math.min(f,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,s.maxTimeToFirstByteMs)})}}}const o=s.errorRetry||s.timeoutRetry||{},a={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const m=this.getInternalLoader(d);this.resetInternalLoader(d.type);const h=u.data;if(h.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,d,new Error("no EXTM3U delimiter"),f||null,c);return}c.parsing.start=performance.now(),Gt.isMediaPlaylist(h)?this.handleTrackOrLevelPlaylist(u,c,d,f||null,m):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};i.load(e,a,l)}handleMasterPlaylist(e,t,r,i){const s=this.hls,o=e.data,a=pa(e,r),l=Gt.parseMasterPlaylist(o,a);if(l.playlistParsingError){this.handleManifestParsingError(e,r,l.playlistParsingError,i,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:h}=l;this.variableList=h;const{AUDIO:g=[],SUBTITLES:y,"CLOSED-CAPTIONS":p}=Gt.parseMasterPlaylistMedia(o,a,l);g.length&&!g.some(E=>!E.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(R.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new xe({}),bitrate:0,url:""})),s.trigger(v.MANIFEST_LOADED,{levels:c,audioTracks:g,subtitles:y,captions:p,contentSteering:u,url:a,stats:t,networkDetails:i,sessionData:d,sessionKeys:f,startTimeOffset:m,variableList:h})}handleTrackOrLevelPlaylist(e,t,r,i,s){const o=this.hls,{id:a,level:l,type:u}=r,c=pa(e,r),d=0,f=$(l)?l:$(a)?a:0,m=Id(r),h=Gt.parseLevelPlaylist(e.data,c,f,m,d,this.variableList);if(u===ie.MANIFEST){const g={attrs:new xe({}),bitrate:0,details:h,name:"",url:c};o.trigger(v.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=h,this.handlePlaylistLoaded(h,e,t,r,i,s)}handleManifestParsingError(e,t,r,i,s){this.hls.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:k.MANIFEST_PARSING_ERROR,fatal:t.type===ie.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:s})}handleNetworkError(e,t,r=!1,i,s){let o=`A network ${r?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===ie.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===ie.AUDIO_TRACK||e.type===ie.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const a=new Error(o);R.warn(`[playlist-loader]: ${o}`);let l=k.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ie.MANIFEST:l=r?k.MANIFEST_LOAD_TIMEOUT:k.MANIFEST_LOAD_ERROR,u=!0;break;case ie.LEVEL:l=r?k.LEVEL_LOAD_TIMEOUT:k.LEVEL_LOAD_ERROR,u=!1;break;case ie.AUDIO_TRACK:l=r?k.AUDIO_TRACK_LOAD_TIMEOUT:k.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ie.SUBTITLE_TRACK:l=r?k.SUBTITLE_TRACK_LOAD_TIMEOUT:k.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:J.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:a,networkDetails:t,stats:s};if(i){const f=t?.url||e.url;d.response=Ne({url:f,data:void 0},i)}this.hls.trigger(v.ERROR,d)}handlePlaylistLoaded(e,t,r,i,s,o){const a=this.hls,{type:l,level:u,id:c,groupId:d,deliveryDirectives:f}=i,m=pa(t,i),h=Id(i),g=typeof i.level=="number"&&h===X.MAIN?u:void 0;if(!e.fragments.length){const p=new Error("No Segments found in Playlist");a.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:k.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:p,reason:p.message,response:t,context:i,level:g,parent:h,networkDetails:s,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const y=e.playlistParsingError;if(y){a.trigger(v.ERROR,{type:J.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:y,reason:y.message,response:t,context:i,level:g,parent:h,networkDetails:s,stats:r});return}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ie.MANIFEST:case ie.LEVEL:a.trigger(v.LEVEL_LOADED,{details:e,level:g||0,id:c||0,stats:r,networkDetails:s,deliveryDirectives:f});break;case ie.AUDIO_TRACK:a.trigger(v.AUDIO_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break;case ie.SUBTITLE_TRACK:a.trigger(v.SUBTITLE_TRACK_LOADED,{details:e,id:c||0,groupId:d||"",stats:r,networkDetails:s,deliveryDirectives:f});break}}}function X0(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function Q0(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(r){R.debug(`[texttrack-utils]: ${r}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){R.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function gr(n){const e=n.mode;if(e==="disabled"&&(n.mode="hidden"),n.cues)for(let t=n.cues.length;t--;)n.removeCue(n.cues[t]);e==="disabled"&&(n.mode=e)}function Rl(n,e,t,r){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const s=mx(n.cues,e,t);for(let o=0;o<s.length;o++)(!r||r(s[o]))&&n.removeCue(s[o])}i==="disabled"&&(n.mode=i)}function hx(n,e){if(e<n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let r=0,i=t;for(;r<=i;){const s=Math.floor((i+r)/2);if(e<n[s].startTime)i=s-1;else if(e>n[s].startTime&&r<t)r=s+1;else return s}return n[r].startTime-e<e-n[i].startTime?r:i}function mx(n,e,t){const r=[],i=hx(n,e);if(i>-1)for(let s=i,o=n.length;s<o;s++){const a=n[s];if(a.startTime>=e&&a.endTime<=t)r.push(a);else if(a.startTime>t)return r}return r}function As(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t];(r.kind==="subtitles"||r.kind==="captions")&&r.label&&e.push(n[t])}return e}var kt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const gx=.25;function Il(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function wd(n,e,t,r,i){let s=new n(e,t,"");try{s.value=r,i&&(s.type=i)}catch{s=new n(e,t,JSON.stringify(i?Ne({type:i},r):r))}return s}const rs=(()=>{const n=Il();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function ya(n,e){return n.getTime()/1e3-e}function px(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class yx{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(gr(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if(r.kind==="metadata"&&r.label==="id3")return X0(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:i}}}=this;if(!r&&!i)return;const{samples:s}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Il();if(o)for(let a=0;a<s.length;a++){const l=s[a].type;if(l===kt.emsg&&!r||!i)continue;const u=$0(s[a].data);if(u){const c=s[a].pts;let d=c+s[a].duration;d>rs&&(d=rs),d-c<=0&&(d=c+gx);for(let m=0;m<u.length;m++){const h=u[m];if(!B0(h)){this.updateId3CueEnds(c,l);const g=wd(o,c,d,h,l);g&&this.id3Track.addCue(g)}}}}}updateId3CueEnds(e,t){var r;const i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(let s=i.length;s--;){const o=i[s];o.type===t&&o.startTime<e&&o.endTime===rs&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:i}){const{id3Track:s,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:a,enableID3MetadataCues:l}}=o;if(s&&(a||l)){let u;i==="audio"?u=c=>c.type===kt.audioId3&&l:i==="video"?u=c=>c.type===kt.emsg&&a:u=c=>c.type===kt.audioId3&&l||c.type===kt.emsg&&a,Rl(s,t,r,u)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:r,id3Track:i}=this,{dateRanges:s}=t,o=Object.keys(s);if(i){const c=Object.keys(r).filter(d=>!o.includes(d));for(let d=c.length;d--;){const f=c[d];Object.keys(r[f].cues).forEach(m=>{i.removeCue(r[f].cues[m])}),delete r[f]}}const a=t.fragments[t.fragments.length-1];if(o.length===0||!$(a?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=a.programDateTime/1e3-a.start,u=Il();for(let c=0;c<o.length;c++){const d=o[c],f=s[d],m=ya(f.startDate,l),h=r[d],g=h?.cues||{};let y=h?.durationKnown||!1,p=rs;const x=f.endDate;if(x)p=ya(x,l),y=!0;else if(f.endOnNext&&!y){const T=o.reduce((S,A)=>{if(A!==f.id){const L=s[A];if(L.class===f.class&&L.startDate>f.startDate&&(!S||f.startDate<S.startDate))return L}return S},null);T&&(p=ya(T.startDate,l),y=!0)}const E=Object.keys(f.attr);for(let T=0;T<E.length;T++){const S=E[T];if(!Ev(S))continue;const A=g[S];if(A)y&&!h.durationKnown&&(A.endTime=p);else if(u){let L=f.attr[S];Sv(S)&&(L=px(L));const C=wd(u,m,p,{key:S,data:L},kt.dateRange);C&&(C.id=d,this.id3Track.addCue(C),g[S]=C)}}r[d]={cues:g,dateRange:f,durationKnown:y}}}}class vx{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const{levelDetails:e}=this;if(e===null)return null;const{holdBack:t,partHoldBack:r,targetduration:i}=e,{liveSyncDuration:s,liveSyncDurationCount:o,lowLatencyMode:a}=this.config,l=this.hls.userConfig;let u=a&&r||t;(l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=s!==void 0?s:o*i);const c=i;return u+Math.min(this.stallCount*1,c)}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;const i=r.edge,s=e-t-this.edgeStalled,o=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,s),a)}get drift(){const{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){const{levelDetails:e}=this;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e,levelDetails:t}=this;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(v.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===k.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&R.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:s}=this.config;if(!i||s===1||!t.live)return;const o=this.targetLatency;if(o===null)return;const a=r-o,l=Math.min(this.maxLatency,o+t.targetduration);if(a<l&&a>.05&&this.forwardBufferLength>1){const c=Math.min(2,Math.max(1,s)),d=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,d))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){const{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}const wl=["NONE","TYPE-0","TYPE-1",null];function xx(n){return wl.indexOf(n)>-1}const oo=["SDR","PQ","HLG"];function Ex(n){return!!n&&oo.indexOf(n)>-1}var Rs={No:"",Yes:"YES",v2:"v2"};function Cd(n){const{canSkipUntil:e,canSkipDateRanges:t,age:r}=n,i=r<e/2;return e&&i?t?Rs.v2:Rs.Yes:Rs.No}class kd{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class br{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Dd(this._audioGroups,e)}hasSubtitleGroup(e){return Dd(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Dd(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function va(n,e){const t=e.startPTS;if($(t)){let r=0,i;e.sn>n.sn?(r=t-n.start,i=n):(r=n.start-t,i=e),i.duration!==r&&(i.duration=r)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.start=n.start+(n.minEndPTS-n.start):e.start=n.start+n.duration:e.start=Math.max(n.start-e.duration,0)}function J0(n,e,t,r,i,s){r-t<=0&&(R.warn("Fragment should have a positive duration",e),r=t+e.duration,s=i+e.duration);let a=t,l=r;const u=e.startPTS,c=e.endPTS;if($(u)){const y=Math.abs(u-t);$(e.deltaPTS)?e.deltaPTS=Math.max(y,e.deltaPTS):e.deltaPTS=y,a=Math.max(t,u),t=Math.min(t,u),i=Math.min(i,e.startDTS),l=Math.min(r,c),r=Math.max(r,c),s=Math.max(s,e.endDTS)}const d=t-e.start;e.start!==0&&(e.start=t),e.duration=r-e.start,e.startPTS=t,e.maxStartPTS=a,e.startDTS=i,e.endPTS=r,e.minEndPTS=l,e.endDTS=s;const f=e.sn;if(!n||f<n.startSN||f>n.endSN)return 0;let m;const h=f-n.startSN,g=n.fragments;for(g[h]=e,m=h;m>0;m--)va(g[m],g[m-1]);for(m=h;m<g.length-1;m++)va(g[m],g[m+1]);return n.fragmentHint&&va(g[g.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,d}function Sx(n,e){let t=null;const r=n.fragments;for(let a=r.length-1;a>=0;a--){const l=r[a].initSegment;if(l){t=l;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let i;Ax(n,e,(a,l,u,c)=>{if(e.skippedSegments&&l.cc!==a.cc){const d=a.cc-l.cc;for(let f=u;f<c.length;f++)c[f].cc+=d}$(a.startPTS)&&$(a.endPTS)&&(l.start=l.startPTS=a.startPTS,l.startDTS=a.startDTS,l.maxStartPTS=a.maxStartPTS,l.endPTS=a.endPTS,l.endDTS=a.endDTS,l.minEndPTS=a.minEndPTS,l.duration=a.endPTS-a.startPTS,l.duration&&(i=l),e.PTSKnown=e.alignedSliding=!0),l.elementaryStreams=a.elementaryStreams,l.loader=a.loader,l.stats=a.stats,a.initSegment&&(l.initSegment=a.initSegment,t=a.initSegment)});const s=e.fragments;if(t&&(e.fragmentHint?s.concat(e.fragmentHint):s).forEach(l=>{var u;l&&(!l.initSegment||l.initSegment.relurl===((u=t)==null?void 0:u.relurl))&&(l.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=s.some(a=>!a),e.deltaUpdateFailed){R.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let a=e.skippedSegments;a--;)s.shift();e.startSN=s[0].sn}else e.canSkipDateRanges&&(e.dateRanges=Tx(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));e.startCC=e.fragments[0].cc,e.endCC=s[s.length-1].cc}Lx(n.partList,e.partList,(a,l)=>{l.elementaryStreams=a.elementaryStreams,l.stats=a.stats}),i?J0(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):Z0(n,e),s.length&&(e.totalduration=e.edge-s[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const o=e.advancedDateTime;if(e.advanced&&o){const a=e.edge;e.driftStart||(e.driftStartTime=o,e.driftStart=a),e.driftEndTime=o,e.driftEnd=a}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}function Tx(n,e,t){const r=we({},n);return t&&t.forEach(i=>{delete r[i]}),Object.keys(e).forEach(i=>{const s=new F0(e[i].attr,r[i]);s.isValid?r[i]=s:R.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(e[i].attr)}"`)}),r}function Lx(n,e,t){if(n&&e){let r=0;for(let i=0,s=n.length;i<=s;i++){const o=n[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?t(o,a):r--}}}function Ax(n,e,t){const r=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,s=(n.fragmentHint?1:0)+(r?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,o=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=s;u++){const c=l[o+u];let d=a[u];r&&!d&&u<r&&(d=e.fragments[u]=c),c&&d&&t(c,d,u,a)}}function Z0(n,e){const t=e.startSN+e.skippedSegments-n.startSN,r=n.fragments;t<0||t>=r.length||Cl(e,r[t].start)}function Cl(n,e){if(e){const t=n.fragments;for(let r=n.skippedSegments;r<t.length;r++)t[r].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function Rx(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const r=n.fragments;if(r.length&&t*4>e){const s=r[r.length-1].duration*1e3;s<t&&(t=s)}}else t/=2;return Math.round(t)}function Ix(n,e,t){if(!(n!=null&&n.details))return null;const r=n.details;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}function _d(n,e,t){var r;return n!=null&&n.details?em((r=n.details)==null?void 0:r.partList,e,t):null}function em(n,e,t){if(n)for(let r=n.length;r--;){const i=n[r];if(i.index===t&&i.fragment.sn===e)return i}return null}function tm(n){n.forEach((e,t)=>{const{details:r}=e;r!=null&&r.fragments&&r.fragments.forEach(i=>{i.level=t})})}function ao(n){switch(n.details){case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_TIMEOUT:case k.LEVEL_LOAD_TIMEOUT:case k.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function bd(n,e){const t=ao(e);return n.default[`${t?"timeout":"error"}Retry`]}function Nu(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function Pd(n){return Ne(Ne({},n),{errorRetry:null,timeoutRetry:null})}function lo(n,e,t,r){if(!n)return!1;const i=r?.code,s=e<n.maxNumRetry&&(wx(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,r,s):s}function wx(n){return n===0&&navigator.onLine===!1||!!n&&(n<400||n>499)}const nm={search:function(n,e){let t=0,r=n.length-1,i=null,s=null;for(;t<=r;){i=(t+r)/2|0,s=n[i];const o=e(s);if(o>0)t=i+1;else if(o<0)r=i-1;else return s}return null}};function Cx(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!$(e))return null;const r=n[0].programDateTime;if(e<(r||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;t=t||0;for(let s=0;s<n.length;++s){const o=n[s];if(Dx(e,t,o))return o}return null}function uo(n,e,t=0,r=0,i=.005){let s=null;if(n){s=e[n.sn-e[0].sn+1]||null;const a=n.endDTS-t;a>0&&a<15e-7&&(t+=15e-7)}else t===0&&e[0].start===0&&(s=e[0]);if(s&&((!n||n.level===s.level)&&kl(t,r,s)===0||kx(s,n,Math.min(i,r))))return s;const o=nm.search(e,kl.bind(null,t,r));return o&&(o!==n||!s)?o:s}function kx(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const r=e.tagList.reduce((i,s)=>(s[0]==="INF"&&(i+=parseFloat(s[1])),i),t);return n.start<=r}return!1}function kl(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0}function Dx(n,e,t){const r=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-r>n}function _x(n,e){return nm.search(n,t=>t.cc<e?1:t.cc>e?-1:0)}var Ue={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},At={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class bx{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=R.log.bind(R,"[info]:"),this.warn=R.warn.bind(R,"[warning]:"),this.error=R.error.bind(R,"[error]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.ERROR,this.onError,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.ERROR,this.onError,this),e.off(v.ERROR,this.onErrorOut,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===X.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,i;if(t.fatal)return;const s=this.hls,o=t.context;switch(t.details){case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case k.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:Ue.DoNothing,flags:At.None};return}case k.FRAG_GAP:case k.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Ue.SendAlternateToPenaltyBox;return}case k.LEVEL_EMPTY_ERROR:case k.LEVEL_PARSING_ERROR:{var a,l;const u=t.parent===X.MAIN?t.level:s.loadLevel;t.details===k.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(l=a.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,u):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,u))}return;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:typeof o?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level));return;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.SUBTITLE_LOAD_ERROR:case k.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){const u=s.levels[s.loadLevel];if(u&&(o.type===ie.AUDIO_TRACK&&u.hasAudioGroup(o.groupId)||o.type===ie.SUBTITLE_TRACK&&u.hasSubtitleGroup(o.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=Ue.SendAlternateToPenaltyBox,t.errorAction.flags=At.MoveAllAlternatesMatchingHost;return}}return;case k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const u=s.levels[s.loadLevel],c=u?.attrs["HDCP-LEVEL"];c?t.errorAction={action:Ue.SendAlternateToPenaltyBox,flags:At.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}:this.keySystemError(t)}return;case k.BUFFER_ADD_CODEC_ERROR:case k.REMUX_ALLOC_ERROR:case k.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(i=t.level)!=null?i:s.loadLevel);return;case k.INTERNAL_EXCEPTION:case k.BUFFER_APPENDING_ERROR:case k.BUFFER_FULL_ERROR:case k.LEVEL_SWITCH_ERROR:case k.BUFFER_STALLED_ERROR:case k.BUFFER_SEEK_OVER_HOLE:case k.BUFFER_NUDGE_ON_STALL:t.errorAction={action:Ue.DoNothing,flags:At.None};return}t.type===J.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const r=this.hls,i=bd(r.config.playlistLoadPolicy,e),s=this.playlistError++;if(lo(i,s,ao(e),e.response))return{action:Ue.RetryRequest,flags:At.None,retryConfig:i,retryCount:s};const a=this.getLevelSwitchAction(e,t);return i&&(a.retryConfig=i,a.retryCount=s),a}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],{fragLoadPolicy:s,keyLoadPolicy:o}=t.config,a=bd(e.details.startsWith("key")?o:s,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(i&&(e.details!==k.FRAG_GAP&&i.fragmentError++,lo(a,l,ao(e),e.response)))return{action:Ue.RetryRequest,flags:At.None,retryConfig:a,retryCount:l};const u=this.getLevelSwitchAction(e,r);return a&&(u.retryConfig=a,u.retryCount=l),u}getLevelSwitchAction(e,t){const r=this.hls;t==null&&(t=r.loadLevel);const i=this.hls.levels[t];if(i){var s,o;const u=e.details;i.loadError++,u===k.BUFFER_APPEND_ERROR&&i.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:m,maxAutoLevel:h}=r;r.autoLevelEnabled||(r.loadLevel=-1);const g=(s=e.frag)==null?void 0:s.type,p=(g===X.AUDIO&&u===k.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===k.BUFFER_ADD_CODEC_ERROR||u===k.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:A})=>i.audioCodec!==A),E=e.sourceBufferName==="video"&&(u===k.BUFFER_ADD_CODEC_ERROR||u===k.BUFFER_APPEND_ERROR)&&d.some(({codecSet:A,audioCodec:L})=>i.codecSet!==A&&i.audioCodec===L),{type:T,groupId:S}=(o=e.context)!=null?o:{};for(let A=d.length;A--;){const L=(A+f)%d.length;if(L!==f&&L>=m&&L<=h&&d[L].loadError===0){var a,l;const C=d[L];if(u===k.FRAG_GAP&&g===X.MAIN&&e.frag){const N=d[L].details;if(N){const w=uo(e.frag,N.fragments,e.frag.start);if(w!=null&&w.gap)continue}}else{if(T===ie.AUDIO_TRACK&&C.hasAudioGroup(S)||T===ie.SUBTITLE_TRACK&&C.hasSubtitleGroup(S))continue;if(g===X.AUDIO&&(a=i.audioGroups)!=null&&a.some(N=>C.hasAudioGroup(N))||g===X.SUBTITLE&&(l=i.subtitleGroups)!=null&&l.some(N=>C.hasSubtitleGroup(N))||p&&i.audioCodec===C.audioCodec||!p&&i.audioCodec!==C.audioCodec||E&&i.codecSet===C.codecSet)continue}c=L;break}}if(c>-1&&r.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Ue.SendAlternateToPenaltyBox,flags:At.None,nextAutoLevel:c}}return{action:Ue.SendAlternateToPenaltyBox,flags:At.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Ue.DoNothing:break;case Ue.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==k.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:i,hdcpLevel:s,nextAutoLevel:o}=r;switch(i){case At.None:this.switchLevel(e,o);break;case At.MoveAllAlternatesMatchingHDCP:s&&(t.maxHdcpLevel=wl[wl.indexOf(s)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,o)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class Mu{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=R.log.bind(R,`${t}:`),this.warn=R.warn.bind(R,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const i=t?.renditionReports;if(i){let s=-1;for(let o=0;o<i.length;o++){const a=i[o];let l;try{l=new self.URL(a.URI,t.url).href}catch(u){R.warn(`Could not construct new URL for Rendition Report: ${u}`),l=a.URI||""}if(l===e){s=o;break}else l===e.substring(0,l.length)&&(s=o)}if(s!==-1){const o=i[s],a=parseInt(o["LAST-MSN"])||t?.lastPartSn;let l=parseInt(o["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=r&&Cd(r);return new kd(a,l>=0?l:void 0,u)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){const{details:i,stats:s}=t,o=self.performance.now(),a=s.loading.first?Math.max(0,o-s.loading.first):0;if(i.advancedDateTime=Date.now()-a,i.live||r!=null&&r.live){if(i.reloaded(r),r&&this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),r&&i.fragments.length>0&&Sx(r,i),!this.canLoad||!i.live)return;let l,u,c;if(i.canBlockReload&&i.endSN&&i.advanced){const y=this.hls.config.lowLatencyMode,p=i.lastPartSn,x=i.endSN,E=i.lastPartIndex,T=E!==-1,S=p===x,A=y?0:E;T?(u=S?x+1:p,c=S?A:E+1):u=x+1;const L=i.age,C=L+i.ageHeader;let N=Math.min(C-i.partTarget,i.targetduration*1.5);if(N>0){if(r&&N>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${N} with playlist age: ${i.age}`),N=0;else{const w=Math.floor(N/i.targetduration);if(u+=w,c!==void 0){const F=Math.round(N%i.targetduration/i.partTarget);c+=F}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${L.toFixed(2)}s goal: ${N} skip sn ${w} to part ${c}`)}i.tuneInGoal=N}if(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c),y||!S){this.loadPlaylist(l);return}}else(i.canBlockReload||i.canSkipUntil)&&(l=this.getDeliveryDirectives(i,t.deliveryDirectives,u,c));const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,m=(i.edge-f)*1e3,h=Rx(i,m);i.updated&&o>this.requestScheduled+h&&(this.requestScheduled=s.loading.start),u!==void 0&&i.canBlockReload?this.requestScheduled=s.loading.first+h-(i.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+h<o?this.requestScheduled=o:this.requestScheduled-o<=0&&(this.requestScheduled+=h);let g=this.requestScheduled-o;g=Math.max(0,g),this.log(`reload live playlist ${e} in ${Math.round(g)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(l),g)}else this.clearTimer()}getDeliveryDirectives(e,t,r,i){let s=Cd(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,s=Rs.No),new kd(r,i,s)}checkRetry(e){const t=e.details,r=ao(e),i=e.errorAction,{action:s,retryCount:o=0,retryConfig:a}=i||{},l=!!i&&!!a&&(s===Ue.RetryRequest||!i.resolved&&s===Ue.SendAlternateToPenaltyBox);if(l){var u;if(this.requestScheduled=-1,o>=a.maxNumRetry)return!1;if(r&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Nu(a,o);this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${o+1}/${a.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,i.resolved=!0}return l}}class Zn{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Px{constructor(e,t,r,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Zn(e),this.fast_=new Zn(t),this.defaultTTFB_=i,this.ttfb_=new Zn(e)}update(e,t){const{slow_:r,fast_:i,ttfb_:s}=this;r.halfLife!==e&&(this.slow_=new Zn(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Zn(t,i.getEstimate(),i.getTotalWeight())),s.halfLife!==e&&(this.ttfb_=new Zn(e,s.getEstimate(),s.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const r=8*t,i=e/1e3,s=r/i;this.fast_.sample(i,s),this.slow_.sample(i,s)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const rm={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Fd={};function Fx(n,e,t,r,i,s){const o=n.audioCodec?n.audioGroups:null,a=s?.audioCodec,l=s?.channels,u=l?parseInt(l):a?1/0:2;let c=null;if(o!=null&&o.length)try{o.length===1&&o[0]?c=e.groups[o[0]].channels:c=o.reduce((d,f)=>{if(f){const m=e.groups[f];if(!m)throw new Error(`Audio track group ${f} not found`);Object.keys(m.channels).forEach(h=>{d[h]=(d[h]||0)+m.channels[h]})}return d},{2:0})}catch{return!0}return n.videoCodec!==void 0&&(n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(r,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!c&&$(u)&&Object.keys(c).some(d=>parseInt(d)>u)}function Ox(n,e,t){const r=n.videoCodec,i=n.audioCodec;if(!r||!i||!t)return Promise.resolve(rm);const s={width:n.width,height:n.height,bitrate:Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)),framerate:n.frameRate||30},o=n.videoRange;o!=="SDR"&&(s.transferFunction=o.toLowerCase());const a=r.split(",").map(l=>({type:"media-source",video:Ne(Ne({},s),{},{contentType:Ci(l,"video")})}));return i&&n.audioGroups&&n.audioGroups.forEach(l=>{var u;l&&((u=e.groups[l])==null||u.tracks.forEach(c=>{if(c.groupId===l){const d=c.channels||"",f=parseFloat(d);$(f)&&f>2&&a.push.apply(a,i.split(",").map(m=>({type:"media-source",audio:{contentType:Ci(m,"audio"),channels:""+f}})))}}))}),Promise.all(a.map(l=>{const u=Nx(l);return Fd[u]||(Fd[u]=t.decodingInfo(l))})).then(l=>({supported:!l.some(u=>!u.supported),configurations:a,decodingInfoResults:l})).catch(l=>({supported:!1,configurations:a,decodingInfoResults:[],error:l}))}function Nx(n){const{audio:e,video:t}=n,r=t||e;if(r){const i=r.contentType.split('"')[1];if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${i}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${i}`}return""}function Mx(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function Ux(n,e){let t=!1,r=[];return n&&(t=n!=="SDR",r=[n]),e&&(r=e.allowedVideoRanges||oo.slice(0),t=e.preferHDR!==void 0?e.preferHDR:Mx(),t?r=r.filter(i=>i!=="SDR"):r=["SDR"]),{preferHDR:t,allowedVideoRanges:r}}function Bx(n,e,t,r,i){const s=Object.keys(n),o=r?.channels,a=r?.audioCodec,l=o&&parseInt(o)===2;let u=!0,c=!1,d=1/0,f=1/0,m=1/0,h=0,g=[];const{preferHDR:y,allowedVideoRanges:p}=Ux(e,i);for(let S=s.length;S--;){const A=n[s[S]];u=A.channels[2]>0,d=Math.min(d,A.minHeight),f=Math.min(f,A.minFramerate),m=Math.min(m,A.minBitrate);const L=p.filter(C=>A.videoRanges[C]>0);L.length>0&&(c=!0,g=L)}d=$(d)?d:0,f=$(f)?f:0;const x=Math.max(1080,d),E=Math.max(30,f);return m=$(m)?m:t,t=Math.max(m,t),c||(e=void 0,g=[]),{codecSet:s.reduce((S,A)=>{const L=n[A];if(A===S)return S;if(L.minBitrate>t)return Wt(A,`min bitrate of ${L.minBitrate} > current estimate of ${t}`),S;if(!L.hasDefaultAudio)return Wt(A,"no renditions with default or auto-select sound found"),S;if(a&&A.indexOf(a.substring(0,4))%5!==0)return Wt(A,`audio codec preference "${a}" not found`),S;if(o&&!l){if(!L.channels[o])return Wt(A,`no renditions with ${o} channel sound found (channels options: ${Object.keys(L.channels)})`),S}else if((!a||l)&&u&&L.channels[2]===0)return Wt(A,"no renditions with stereo sound found"),S;return L.minHeight>x?(Wt(A,`min resolution of ${L.minHeight} > maximum of ${x}`),S):L.minFramerate>E?(Wt(A,`min framerate of ${L.minFramerate} > maximum of ${E}`),S):g.some(C=>L.videoRanges[C]>0)?L.maxScore<h?(Wt(A,`max score of ${L.maxScore} < selected max of ${h}`),S):S&&(io(A)>=io(S)||L.fragmentError>n[S].fragmentError)?S:(h=L.maxScore,A):(Wt(A,`no variants with VIDEO-RANGE of ${JSON.stringify(g)} found`),S)},void 0),videoRanges:g,preferHDR:y,minFramerate:f,minBitrate:m}}function Wt(n,e){R.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function $x(n){return n.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const i=t.channels||"2";return r.channels[i]=(r.channels[i]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Gx(n,e,t,r){return n.slice(t,r+1).reduce((i,s)=>{if(!s.codecSet)return i;const o=s.audioGroups;let a=i[s.codecSet];a||(i[s.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,s.bitrate);const l=Math.min(s.height,s.width);return a.minHeight=Math.min(a.minHeight,l),a.minFramerate=Math.min(a.minFramerate,s.frameRate),a.maxScore=Math.max(a.maxScore,s.score),a.fragmentError+=s.fragmentError,a.videoRanges[s.videoRange]=(a.videoRanges[s.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const c=e.groups[u];c&&(a.hasDefaultAudio=a.hasDefaultAudio||e.hasDefaultAudio?c.hasDefault:c.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(c.channels).forEach(d=>{a.channels[d]=(a.channels[d]||0)+c.channels[d]}))}),i},{})}function Vt(n,e,t){if("attrs"in n){const r=e.indexOf(n);if(r!==-1)return r}for(let r=0;r<e.length;r++){const i=e[r];if(Hn(n,i,t))return r}return-1}function Hn(n,e,t){const{groupId:r,name:i,lang:s,assocLang:o,default:a}=n,l=n.forced;return(r===void 0||e.groupId===r)&&(i===void 0||e.name===i)&&(s===void 0||e.lang===s)&&(s===void 0||e.assocLang===o)&&(a===void 0||e.default===a)&&(l===void 0||e.forced===l)&&(!("characteristics"in n)||Vx(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function Vx(n,e=""){const t=n.split(","),r=e.split(",");return t.length===r.length&&!t.some(i=>r.indexOf(i)===-1)}function On(n,e){const{audioCodec:t,channels:r}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(r===void 0||r===(e.channels||"2"))}function Hx(n,e,t,r,i){const s=e[r],a=e.reduce((f,m,h)=>{const g=m.uri;return(f[g]||(f[g]=[])).push(h),f},{})[s.uri];a.length>1&&(r=Math.max.apply(Math,a));const l=s.videoRange,u=s.frameRate,c=s.codecSet.substring(0,4),d=Od(e,r,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const m=f.audioGroups,h=t.filter(g=>!m||m.indexOf(g.groupId)!==-1);return Vt(n,h,i)>-1});return d>-1?d:Od(e,r,f=>{const m=f.audioGroups,h=t.filter(g=>!m||m.indexOf(g.groupId)!==-1);return Vt(n,h,i)>-1})}function Od(n,e,t){for(let r=e;r>-1;r--)if(t(n[r]))return r;for(let r=e+1;r<n.length;r++)if(t(n[r]))return r;return-1}class Kx{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:t,partCurrent:r,hls:i}=this,{autoLevelEnabled:s,media:o}=i;if(!t||!o)return;const a=performance.now(),l=r?r.stats:t.stats,u=r?r.duration:t.duration,c=a-l.loading.start,d=i.minAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||t.level<=d){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||o.paused||!o.playbackRate||!o.readyState)return;const f=i.mainForwardBufferInfo;if(f===null)return;const m=this.bwEstimator.getEstimateTTFB(),h=Math.abs(o.playbackRate);if(c<=Math.max(m,1e3*(u/(h*2))))return;const g=f.len/h,y=l.loading.first?l.loading.first-l.loading.start:-1,p=l.loaded&&y>-1,x=this.getBwEstimate(),E=i.levels,T=E[t.level],S=l.total||Math.max(l.loaded,Math.round(u*T.averageBitrate/8));let A=p?c-y:c;A<1&&p&&(A=Math.min(c,l.loaded*8/x));const L=p?l.loaded*1e3/A:0,C=L?(S-l.loaded)/L:S*8/x+m/1e3;if(C<=g)return;const N=L?L*8:x;let w=Number.POSITIVE_INFINITY,F;for(F=t.level-1;F>d;F--){const U=E[F].maxBitrate;if(w=this.getTimeToLoadFrag(m/1e3,N,u*U,!E[F].details),w<g)break}if(w>=C||w>u*10)return;i.nextLoadLevel=i.nextAutoLevel=F,p?this.bwEstimator.sample(c-Math.min(m,y),l.loaded):this.bwEstimator.sampleTTFB(c);const z=E[F].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>z&&this.resetEstimator(z),this.clearTimer(),R.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${g.toFixed(3)} s
      Estimated load time for current fragment: ${C.toFixed(3)} s
      Estimated load time for down switch fragment: ${w.toFixed(3)} s
      TTFB estimate: ${y|0} ms
      Current BW estimate: ${$(x)?x|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${F} @ ${z|0} bps`),i.trigger(v.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(R.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Px(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(v.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var i;this.fragCurrent=r,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case k.BUFFER_ADD_CODEC_ERROR:case k.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case k.FRAG_LOAD_TIMEOUT:{const r=t.frag,{fragCurrent:i,partCurrent:s}=this;if(r&&i&&r.sn===i.sn&&r.level===i.level){const o=performance.now(),a=s?s.stats:r.stats,l=o-a.loading.start,u=a.loading.first?a.loading.first-a.loading.start:-1;if(a.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),a.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,r,i){const s=e+r/t,o=i?this.lastLevelLoadSec:0;return s+o}onLevelLoaded(e,t){const r=this.hls.config,{loading:i}=t.stats,s=i.end-i.start;$(s)&&(this.lastLevelLoadSec=s/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){const i=r?r.stats:t.stats;if(t.type===X.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=r?r.duration:t.duration,o=this.hls.levels[t.level],a=(o.loaded?o.loaded.bytes:0)+i.loaded,l=(o.loaded?o.loaded.duration:0)+s;o.loaded={bytes:a,duration:l},o.realBitrate=Math.round(8*a/l)}if(t.bitrateTest){const s={stats:i,frag:t,part:r,id:t.type};this.onFragBuffered(v.FRAG_BUFFERED,s),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:i}=t,s=i!=null&&i.stats.loaded?i.stats:r.stats;if(s.aborted||this.ignoreFragment(r))return;const o=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,s.loaded),s.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==X.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,s=this.findBestLevel(r,t,e,0,i,1,1);if(s>-1)return s;const o=this.hls.firstLevel,a=Math.min(Math.max(o,t),e);return R.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${a}`),a}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,r=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!r||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const s=r&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,s)&&o[e].loadError<=o[s].loadError)return e}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:i,config:s,minAutoLevel:o}=r,a=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=s.abrBandWidthFactor,d=s.abrBandWidthUpFactor;if(u){const y=this.findBestLevel(l,o,i,u,0,c,d);if(y>=0)return y}let f=a?Math.min(a,s.maxStarvationDelay):s.maxStarvationDelay;if(!u){const y=this.bitrateTestDelay;y&&(f=(a?Math.min(a,s.maxLoadingDelay):s.maxLoadingDelay)-y,R.info(`[abr] bitrate test took ${Math.round(1e3*y)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const m=this.findBestLevel(l,o,i,u,f,c,d);if(R.info(`[abr] ${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${m}`),m>-1)return m;const h=r.levels[o],g=r.levels[r.loadLevel];return h?.bitrate<g?.bitrate?o:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,i,s,o,a){var l;const u=i+s,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:m}=this,{levels:h,allAudioTracks:g,loadLevel:y,config:p}=this.hls;if(h.length===1)return 0;const x=h[d],E=!!(x!=null&&(l=x.details)!=null&&l.live),T=y===-1||c===-1;let S,A="SDR",L=x?.frameRate||0;const{audioPreference:C,videoPreference:N}=p,w=this.audioTracksByGroup||(this.audioTracksByGroup=$x(g));if(T){if(this.firstSelection!==-1)return this.firstSelection;const Y=this.codecTiers||(this.codecTiers=Gx(h,w,t,r)),K=Bx(Y,A,e,C,N),{codecSet:Q,videoRanges:O,minFramerate:P,minBitrate:_,preferHDR:W}=K;S=Q,A=W?O[O.length-1]:O[0],L=P,e=Math.max(e,_),R.log(`[abr] picked start tier ${JSON.stringify(K)}`)}else S=x?.codecSet,A=x?.videoRange;const F=m?m.duration:f?f.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,U=[];for(let Y=r;Y>=t;Y--){var V;const K=h[Y],Q=Y>d;if(!K)continue;if(p.useMediaCapabilities&&!K.supportedResult&&!K.supportedPromise){const oe=navigator.mediaCapabilities;typeof oe?.decodingInfo=="function"&&Fx(K,w,A,L,e,C)?(K.supportedPromise=Ox(K,w,oe),K.supportedPromise.then(pe=>{if(!this.hls)return;K.supportedResult=pe;const ce=this.hls.levels,de=ce.indexOf(K);pe.error?R.warn(`[abr] MediaCapabilities decodingInfo error: "${pe.error}" for level ${de} ${JSON.stringify(pe)}`):pe.supported||(R.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${de} ${JSON.stringify(pe)}`),de>-1&&ce.length>1&&(R.log(`[abr] Removing unsupported level ${de}`),this.hls.removeLevel(de)))})):K.supportedResult=rm}if(S&&K.codecSet!==S||A&&K.videoRange!==A||Q&&L>K.frameRate||!Q&&L>0&&L<K.frameRate||K.supportedResult&&!((V=K.supportedResult.decodingInfoResults)!=null&&V[0].smooth)){U.push(Y);continue}const O=K.details,P=(m?O?.partTarget:O?.averagetargetduration)||F;let _;Q?_=a*e:_=o*e;const W=F&&i>=F*2&&s===0?h[Y].averageBitrate:h[Y].maxBitrate,j=this.getTimeToLoadFrag(z,_,W*P,O===void 0);if(_>=W&&(Y===c||K.loadError===0&&K.fragmentError===0)&&(j<=z||!$(j)||E&&!this.bitrateTestDelay||j<u)){const oe=this.forcedAutoLevel;return Y!==y&&(oe===-1||oe!==y)&&(U.length&&R.trace(`[abr] Skipped level(s) ${U.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${h[U[0]].codecs}" ${h[U[0]].videoRange}; not compatible with "${x.codecs}" ${A}`),R.info(`[abr] switch candidate:${d}->${Y} adjustedbw(${Math.round(_)})-bitrate=${Math.round(_-W)} ttfb:${z.toFixed(1)} avgDuration:${P.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${j.toFixed(1)} firstSelection:${T} codecSet:${S} videoRange:${A} hls.loadLevel:${y}`)),T&&(this.firstSelection=Y),Y}}return-1}set nextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls,i=Math.min(Math.max(e,r),t);this._nextAutoLevel!==i&&(this.nextAutoLevelKey="",this._nextAutoLevel=i)}}class jx{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var Fe={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class zx{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.BUFFER_APPENDED,this.onBufferAppended,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.BUFFER_APPENDED,this.onBufferAppended,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let i=r.length;i--;){const s=r[i];if(!s)break;const o=s.end;if(s.start<=e&&o!==null&&e<=o)return s}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){const{fragments:r}=this,i=Object.keys(r);for(let s=i.length;s--;){const o=r[i[s]];if(o?.body.type===t&&o.buffered){const a=o.body;if(a.start<=e&&e<=a.end)return a}}return null}detectEvictedFragments(e,t,r,i){this.timeRanges&&(this.timeRanges[e]=t);const s=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a||s>=a.body.sn)return;if(!a.buffered&&!a.loaded){a.body.type===r&&this.removeFragment(a.body);return}const l=a.range[e];l&&l.time.some(u=>{const c=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return c&&this.removeFragment(a.body),c})})}detectPartialFragments(e){const t=this.timeRanges,{frag:r,part:i}=e;if(!t||r.sn==="initSegment")return;const s=er(r),o=this.fragments[s];if(!o||o.buffered&&r.gap)return;const a=!r.relurl;Object.keys(t).forEach(l=>{const u=r.elementaryStreams[l];if(!u)return;const c=t[l],d=a||u.partial===!0;o.range[l]=this.getBufferedTimes(r,i,d,c)}),o.loaded=null,Object.keys(o.range).length?(o.buffered=!0,(o.body.endList=r.endList||o.body.endList)&&(this.endListFragments[o.body.type]=o),is(o)||this.removeParts(r.sn-1,r.type)):this.removeFragment(o.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(i=>i.fragment.sn>=e))}fragBuffered(e,t){const r=er(e);let i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)}getBufferedTimes(e,t,r,i){const s={time:[],partial:r},o=e.start,a=e.end,l=e.minEndPTS||a,u=e.maxStartPTS||o;for(let c=0;c<i.length;c++){const d=i.start(c)-this.bufferPadding,f=i.end(c)+this.bufferPadding;if(u>=d&&l<=f){s.time.push({startPTS:Math.max(o,i.start(c)),endPTS:Math.min(a,i.end(c))});break}else if(o<f&&a>d){const m=Math.max(o,i.start(c)),h=Math.min(a,i.end(c));h>m&&(s.partial=!0,s.time.push({startPTS:m,endPTS:h}))}else if(a<=d)break}return s}getPartialFragment(e){let t=null,r,i,s,o=0;const{bufferPadding:a,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&is(c)&&(i=c.body.start-a,s=c.body.end+a,e>=i&&e<=s&&(r=Math.min(e-i,s-e),o<=r&&(t=c.body,o=r)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||is(t))}getState(e){const t=er(e),r=this.fragments[t];return r?r.buffered?is(r)?Fe.PARTIAL:Fe.OK:Fe.APPENDING:Fe.NOT_LOADED}isTimeBuffered(e,t,r){let i,s;for(let o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,s=r.end(o)+this.bufferPadding,e>=i&&t<=s)return!0;if(t<=i)return!1}return!1}onFragLoaded(e,t){const{frag:r,part:i}=t;if(r.sn==="initSegment"||r.bitrateTest)return;const s=i?null:t,o=er(r);this.fragments[o]={body:r,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:i,timeRanges:s}=t;if(r.sn==="initSegment")return;const o=r.type;if(i){let a=this.activePartLists[o];a||(this.activePartLists[o]=a=[]),a.push(i)}this.timeRanges=s,Object.keys(s).forEach(a=>{const l=s[a];this.detectEvictedFragments(a,l,o,i)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=er(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,i,s){i&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const a=this.fragments[o];if(!a)return;const l=a.body;l.type!==r||i&&!l.gap||l.start<t&&l.end>e&&(a.buffered||s)&&this.removeFragment(l)})}removeFragment(e){const t=er(e);e.stats.loaded=0,e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const i=e.sn;this.activePartLists[e.type]=r.filter(s=>s.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function is(n){var e,t,r;return n.buffered&&(n.body.gap||((e=n.range.video)==null?void 0:e.partial)||((t=n.range.audio)==null?void 0:t.partial)||((r=n.range.audiovideo)==null?void 0:r.partial))}function er(n){return`${n.type}_${n.level}_${n.sn}`}const Wx={length:0,start:()=>0,end:()=>0};class fe{static isBuffered(e,t){try{if(e){const r=fe.getBuffered(e);for(let i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0}}catch{}return!1}static bufferInfo(e,t,r){try{if(e){const i=fe.getBuffered(e),s=[];let o;for(o=0;o<i.length;o++)s.push({start:i.start(o),end:i.end(o)});return this.bufferedInfo(s,t,r)}}catch{}return{len:0,start:t,end:t,nextStart:void 0}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.sort(function(u,c){const d=u.start-c.start;return d||c.end-u.end});let i=[];if(r)for(let u=0;u<e.length;u++){const c=i.length;if(c){const d=i[c-1].end;e[u].start-d<r?e[u].end>d&&(i[c-1].end=e[u].end):i.push(e[u])}else i.push(e[u])}else i=e;let s=0,o,a=t,l=t;for(let u=0;u<i.length;u++){const c=i[u].start,d=i[u].end;if(t+r>=c&&t<d)a=c,l=d,s=l-t;else if(t+r<c){o=c;break}}return{len:s,start:a||0,end:l||0,nextStart:o}}static getBuffered(e){try{return e.buffered}catch(t){return R.log("failed to get media.buffered",t),Wx}}}class Uu{constructor(e,t,r,i=0,s=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ss(),this.buffering={audio:ss(),video:ss(),audiovideo:ss()},this.level=e,this.sn=t,this.id=r,this.size=i,this.part=s,this.partial=o}}function ss(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Is(n,e){for(let r=0,i=n.length;r<i;r++){var t;if(((t=n[r])==null?void 0:t.cc)===e)return n[r]}return null}function Yx(n,e,t){return!!(e&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function qx(n,e){const t=n.fragments,r=e.fragments;if(!r.length||!t.length){R.log("No fragments to align");return}const i=Is(t,r[0].cc);if(!i||i&&!i.startPTS){R.log("No frag in previous level to align on");return}return i}function Nd(n,e){if(n){const t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function im(n,e){const t=e.fragments;for(let r=0,i=t.length;r<i;r++)Nd(t[r],n);e.fragmentHint&&Nd(e.fragmentHint,n),e.alignedSliding=!0}function Xx(n,e,t){e&&(Qx(n,t,e),!t.alignedSliding&&e&&co(t,e),!t.alignedSliding&&e&&!t.skippedSegments&&Z0(e,t))}function Qx(n,e,t){if(Yx(n,t,e)){const r=qx(t,e);r&&$(r.start)&&(R.log(`Adjusting PTS using last level due to CC increase within current level ${e.url}`),im(r.start,e))}}function co(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,r=e.fragments;if(!t.length||!r.length)return;let i,s;const o=Math.min(e.endCC,n.endCC);e.startCC<o&&n.startCC<o&&(i=Is(r,o),s=Is(t,o)),(!i||!s)&&(i=r[Math.floor(r.length/2)],s=Is(t,i.cc)||t[Math.floor(t.length/2)]);const a=i.programDateTime,l=s.programDateTime;if(!a||!l)return;const u=(l-a)/1e3-(s.start-i.start);im(u,n)}const Md=Math.pow(2,17);class Jx{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new Xt({type:J.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){l(Bd(e));return}else e.gap=!1;const u=this.loader=e.loader=s?new s(i):new o(i),c=Ud(e),d=Pd(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Md};e.stats=u.stats,u.load(c,f,{onSuccess:(m,h,g,y)=>{this.resetLoader(e,u);let p=m.data;g.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(p.slice(0,16)),p=p.slice(16)),a({frag:e,part:null,payload:p,networkDetails:y})},onError:(m,h,g,y)=>{this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Ne({url:r,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:y}))},onAbort:(m,h,g)=>{this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,h,g)=>{this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))},onProgress:(m,h,g,y)=>{t&&t({frag:e,part:null,payload:g,networkDetails:y})}})})}loadPart(e,t,r){this.abort();const i=this.config,s=i.fLoader,o=i.loader;return new Promise((a,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(Bd(e,t));return}const u=this.loader=e.loader=s?new s(i):new o(i),c=Ud(e,t),d=Pd(i.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Md};t.stats=u.stats,u.load(c,f,{onSuccess:(m,h,g,y)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const p={frag:e,part:t,payload:m.data,networkDetails:y};r(p),a(p)},onError:(m,h,g,y)=>{this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Ne({url:c.url,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:g,stats:y}))},onAbort:(m,h,g)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:g,stats:m}))},onTimeout:(m,h,g)=>{this.resetLoader(e,u),l(new Xt({type:J.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:g,stats:m}))}})})}updateStatsFromPart(e,t){const r=e.stats,i=t.stats,s=i.total;if(r.loaded+=i.loaded,s){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(r.loaded/s),l),d=(l-u)*Math.round(r.loaded/u);r.total=r.loaded+d}else r.total=Math.max(r.loaded,r.total);const o=r.loading,a=i.loading;o.start?o.first+=a.first-a.start:(o.start=a.start,o.first=a.first),o.end=a.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function Ud(n,e=null){const t=e||n,r={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,s=t.byteRangeEndOffset;if($(i)&&$(s)){var o;let a=i,l=s;if(n.sn==="initSegment"&&((o=n.decryptdata)==null?void 0:o.method)==="AES-128"){const u=s-i;u%16&&(l=s+(16-u%16)),i!==0&&(r.resetIV=!0,a=i-16)}r.rangeStart=a,r.rangeEnd=l}return r}function Bd(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),r={type:J.MEDIA_ERROR,details:k.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(r.part=e),(e||n).stats.aborted=!0,new Xt(r)}class Xt extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Zx{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}}class eE{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function tE(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?Vn(n,0,e-t):n}class nE{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let i=0;i<4;i++)r[i]=t.getUint32(i*4);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],s=r[1],o=r[2],a=r[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],m=new Uint32Array(256);let h=0,g=0,y=0;for(y=0;y<256;y++)y<128?m[y]=y<<1:m[y]=y<<1^283;for(y=0;y<256;y++){let p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^p&255^99,e[h]=p,t[p]=h;const x=m[h],E=m[x],T=m[E];let S=m[p]*257^p*16843008;i[h]=S<<24|S>>>8,s[h]=S<<16|S>>>16,o[h]=S<<8|S>>>24,a[h]=S,S=T*16843009^E*65537^x*257^h*16843008,u[p]=S<<24|S>>>8,c[p]=S<<16|S>>>16,d[p]=S<<8|S>>>24,f[p]=S,h?(h=x^m[m[m[T^x]]],g^=m[m[g]]):h=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,i=0;for(;i<t.length&&r;)r=t[i]===this.key[i],i++;if(r)return;this.key=t;const s=this.keySize=t.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const o=this.ksRows=(s+6+1)*4;let a,l;const u=this.keySchedule=new Uint32Array(o),c=this.invKeySchedule=new Uint32Array(o),d=this.sBox,f=this.rcon,m=this.invSubMix,h=m[0],g=m[1],y=m[2],p=m[3];let x,E;for(a=0;a<o;a++){if(a<s){x=u[a]=t[a];continue}E=x,a%s===0?(E=E<<8|E>>>24,E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255],E^=f[a/s|0]<<24):s>6&&a%s===4&&(E=d[E>>>24]<<24|d[E>>>16&255]<<16|d[E>>>8&255]<<8|d[E&255]),u[a]=x=(u[a-s]^E)>>>0}for(l=0;l<o;l++)a=o-l,l&3?E=u[a]:E=u[a-4],l<4||a<=4?c[l]=E:c[l]=h[d[E>>>24]]^g[d[E>>>16&255]]^y[d[E>>>8&255]]^p[d[E&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){const i=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,a=this.invSubMix,l=a[0],u=a[1],c=a[2],d=a[3],f=this.uint8ArrayToUint32Array_(r);let m=f[0],h=f[1],g=f[2],y=f[3];const p=new Int32Array(e),x=new Int32Array(p.length);let E,T,S,A,L,C,N,w,F,z,U,V,Y,K;const Q=this.networkToHostOrderSwap;for(;t<p.length;){for(F=Q(p[t]),z=Q(p[t+1]),U=Q(p[t+2]),V=Q(p[t+3]),L=F^s[0],C=V^s[1],N=U^s[2],w=z^s[3],Y=4,K=1;K<i;K++)E=l[L>>>24]^u[C>>16&255]^c[N>>8&255]^d[w&255]^s[Y],T=l[C>>>24]^u[N>>16&255]^c[w>>8&255]^d[L&255]^s[Y+1],S=l[N>>>24]^u[w>>16&255]^c[L>>8&255]^d[C&255]^s[Y+2],A=l[w>>>24]^u[L>>16&255]^c[C>>8&255]^d[N&255]^s[Y+3],L=E,C=T,N=S,w=A,Y=Y+4;E=o[L>>>24]<<24^o[C>>16&255]<<16^o[N>>8&255]<<8^o[w&255]^s[Y],T=o[C>>>24]<<24^o[N>>16&255]<<16^o[w>>8&255]<<8^o[L&255]^s[Y+1],S=o[N>>>24]<<24^o[w>>16&255]<<16^o[L>>8&255]<<8^o[C&255]^s[Y+2],A=o[w>>>24]<<24^o[L>>16&255]<<16^o[C>>8&255]<<8^o[N&255]^s[Y+3],x[t]=Q(E^m),x[t+1]=Q(A^h),x[t+2]=Q(S^g),x[t+3]=Q(T^y),m=F,h=z,g=U,y=V,t=t+4}return x.buffer}}const rE=16;class Bu{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?tE(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((i,s)=>{this.softwareDecrypt(new Uint8Array(e),t,r);const o=this.flush();o?i(o.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){const{currentIV:i,currentResult:s,remainderData:o}=this;this.logOnce("JS AES decrypt"),o&&(e=St(o,e),this.remainderData=null);const a=this.getValidChunk(e);if(!a.length)return null;i&&(r=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new nE),l.expandKey(t);const u=s;return this.currentResult=l.decrypt(a.buffer,0,r),this.currentIV=Vn(a,-16).buffer,u||null}webCryptoDecrypt(e,t,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r));this.key=t,this.fastAesKey=new eE(this.subtle,t)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Zx(this.subtle,new Uint8Array(r)).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(R.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);const i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%rE;return r!==e.length&&(t=Vn(e,0,r),this.remainderData=Vn(e,r)),t}logOnce(e){this.logEnabled&&(R.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const iE={toString:function(n){let e="";const t=n.length;for(let r=0;r<t;r++)e+=`[${n.start(r).toFixed(3)}-${n.end(r).toFixed(3)}]`;return e}},b={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class $u extends jx{constructor(e,t,r,i,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=b.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=i,this.log=R.log.bind(R,`${i}:`),this.warn=R.warn.bind(R,`${i}:`),this.hls=e,this.fragmentLoader=new Jx(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Bu(e.config),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=b.STOPPED}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;const r=t.partList;if(r!=null&&r.length){const s=r[r.length-1];return fe.isBuffered(this.media,s.start+s.duration/2)}const i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);const i=this.config;this.levels&&i.autoStartLoad&&this.state===b.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(){const e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:e,fragCurrent:t,media:r,mediaBuffer:i,state:s}=this,o=r?r.currentTime:0,a=fe.bufferInfo(i||r,o,e.maxBufferHole);if(this.log(`media seeking to ${$(o)?o.toFixed(3):o}, state: ${s}`),this.state===b.ENDED)this.resetLoadingState();else if(t){const l=e.maxFragLookUpTolerance,u=t.start-l,c=t.start+t.duration+l;if(!a.len||c<a.start||u>a.end){const d=o>c;(o<u||d)&&(d&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(o,1/0,this.playlistType,!0),this.lastCurrentTime=o),!this.loadedmetadata&&!a.len&&(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=b.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){const i=s=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${s.part?" p: "+s.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(e,t,r,i).then(s=>{if(!s)return;const o=this.state;if(this.fragContextChanged(e)){(o===b.FRAG_LOADING||!this.fragCurrent&&o===b.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=b.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(v.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===b.STOPPED||this.state===b.ERROR||(this.warn(`Frag error: ${s?.message||s}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Fe.APPENDING){const s=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,s),a=Math.max(e.duration,o?o.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(a,e.duration))&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===Fe.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:r};this.hls.trigger(v.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{const{hls:i}=this,{payload:s}=r,o=e.decryptdata;if(s&&s.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),o.key.buffer,o.iv.buffer).catch(l=>{throw i.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:e}),l}).then(l=>{const u=self.performance.now();return i.trigger(v.FRAG_DECRYPTED,{frag:e,payload:l,stats:{tstart:a,tdecrypt:u}}),r.payload=l,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===b.STOPPED||this.state===b.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state=b.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,i,s,o;const a=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===X.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((i=e.endPTS)!=null?i:NaN).toFixed(3)}] > buffer:${a?iE.toString(fe.getBuffered(a)):"(detached)"})`),e.sn!=="initSegment"){var l;if(e.type!==X.SUBTITLE){const c=e.elementaryStreams;if(!Object.keys(c).some(d=>!!c[d])){this.state=b.IDLE;return}}const u=(l=this.levels)==null?void 0:l[e.level];u!=null&&u.fragmentError&&(this.log(`Resetting level fragment error count of ${u.fragmentError} on frag buffered`),u.fragmentError=0)}this.state=b.IDLE,a&&(!this.loadedmetadata&&e.type==X.MAIN&&a.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((o=this.fragPrevious)==null?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:i,partsLoaded:s}=e,o=!s||s.length===0||s.some(l=>!l),a=new Uu(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!o);t.flush(a)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,i){var s;const o=t?.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let a=null;if(e.encrypted&&!((s=e.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=b.KEY_LOADING,this.fragCurrent=e,a=this.keyLoader.load(e).then(c=>{if(!this.fragContextChanged(c.frag))return this.hls.trigger(v.KEY_LOADED,c),this.state===b.KEY_LOADING&&(this.state=b.IDLE),c}),this.hls.trigger(v.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(a=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){const c=o.partList;if(c&&i){r>e.end&&o.fragmentHint&&(e=o.fragmentHint);const d=this.getNextPart(c,e,r);if(d>-1){const f=c[d];this.log(`Loading part sn: ${e.sn} p: ${f.index} cc: ${e.cc} of playlist [${o.startSN}-${o.endSN}] parts [0-${d}-${c.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=f.start+f.duration,this.state=b.FRAG_LOADING;let m;return a?m=a.then(h=>!h||this.fragContextChanged(h.frag)?null:this.doFragPartsLoad(e,f,t,i)).catch(h=>this.handleFragLoadError(h)):m=this.doFragPartsLoad(e,f,t,i).catch(h=>this.handleFragLoadError(h)),this.hls.trigger(v.FRAG_LOADING,{frag:e,part:f,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(c,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${o?"of ["+o.startSN+"-"+o.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),$(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=b.FRAG_LOADING;const l=this.config.progressive;let u;return l&&a?u=a.then(c=>!c||this.fragContextChanged(c?.frag)?null:this.fragmentLoader.load(e,i)).catch(c=>this.handleFragLoadError(c)):u=Promise.all([this.fragmentLoader.load(e,l?i:void 0),a]).then(([c])=>(!l&&c&&i&&i(c),c)).catch(c=>this.handleFragLoadError(c)),this.hls.trigger(v.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):u}doFragPartsLoad(e,t,r,i){return new Promise((s,o)=>{var a;const l=[],u=(a=r.details)==null?void 0:a.partList,c=d=>{this.fragmentLoader.loadPart(e,d,i).then(f=>{l[d.index]=f;const m=f.part;this.hls.trigger(v.FRAG_LOADED,f);const h=_d(r,e.sn,d.index+1)||em(u,e.sn,d.index+1);if(h)c(h);else return s({frag:e,part:m,partsLoaded:l})}).catch(o)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===k.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(v.ERROR,t)}else this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==b.PARSING){!this.fragCurrent&&this.state!==b.STOPPED&&this.state!==b.ERROR&&(this.state=b.IDLE);return}const{frag:r,part:i,level:s}=t,o=self.performance.now();r.stats.parsing.end=o,i&&(i.stats.parsing.end=o),this.updateLevelTiming(r,i,s,e.partial)}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:i,sn:s,part:o}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${i}. The current chunk will not be buffered.`),null;const a=t[i],l=o>-1?_d(a,s,o):null,u=l?l.fragment:Ix(a,s,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:a}):null}bufferFragmentData(e,t,r,i,s){var o;if(!e||this.state!==b.PARSING)return;const{data1:a,data2:l}=e;let u=a;if(a&&l&&(u=St(a,l)),!((o=u)!=null&&o.length))return;const c={type:e.type,frag:t,part:r,chunkMeta:i,parent:t.type,data:u};if(this.hls.trigger(v.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(s)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!fe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const r=t.currentTime,i=fe.bufferInfo(t,r,0),s=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),a=Math.max(Math.min(e.start-o,i.end-o),r+o);e.start-a>o&&this.flushMainBuffer(a,e.start)}getFwdBufferInfo(e,t){const r=this.getLoadPosition();return $(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){const{config:{maxBufferHole:i}}=this,s=fe.bufferInfo(e,t,i);if(s.len===0&&s.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,r);if(o&&s.nextStart<o.end)return fe.bufferInfo(e,t,Math.max(s.nextStart,i))}return s}getMaxBufferLength(e){const{config:t}=this;let r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,i=Math.max(Math.min(e-t,r.maxBufferLength),t),s=Math.max(e-t*3,r.maxMaxBufferLength/2,i);return s>=i?(r.maxMaxBufferLength=s,this.warn(`Reduce max buffer length to ${s}s`),!0):!1}getAppendedFrag(e,t=X.MAIN){const r=this.fragmentTracker.getAppendedFrag(e,X.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,i=r.length;if(!i)return null;const{config:s}=this,o=r[0].start;let a;if(t.live){const l=s.initialLiveManifestSize;if(i<l)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${l})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o)&&(a=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=a?this.hls.liveSyncPosition||a.start:e)}else e<=o&&(a=r[0]);if(!a){const l=s.lowLatencyMode?t.partEnd:t.fragmentEnd;a=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(a)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===Fe.OK||r===Fe.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,i,s){const o=e.gap,a=this.getNextFragment(this.nextLoadPosition,t);if(a===null)return a;if(e=a,o&&e&&!e.gap&&r.nextStart){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,i);if(l!==null&&r.len+l.len>=s)return this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let i=-1,s=!1,o=!0;for(let a=0,l=e.length;a<l;a++){const u=e[a];if(o=o&&!u.independent,i>-1&&r<u.start)break;const c=u.loaded;c?i=-1:(s||u.independent||o)&&u.fragment===t&&(i=a),s=c}return i}loadedEndOfParts(e,t){const r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){const r=this.fragPrevious;let i=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),i=Cx(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const s=r.sn+1;if(s>=e.startSN&&s<=e.endSN){const o=t[s-e.startSN];r.cc===o.cc&&(i=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=_x(t,r.cc),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(i=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,r){const{config:i}=this;let{fragPrevious:s}=this,{fragments:o,endSN:a}=r;const{fragmentHint:l}=r,{maxFragLookUpTolerance:u}=i,c=r.partList,d=!!(i.lowLatencyMode&&c!=null&&c.length&&l);d&&l&&!this.bitrateTest&&(o=o.concat(l),a=l.sn);let f;if(e<t){const m=e>t-u?0:u;f=uo(s,o,e,m)}else f=o[o.length-1];if(f){const m=f.sn-r.startSN,h=this.fragmentTracker.getState(f);if((h===Fe.OK||h===Fe.PARTIAL&&f.gap)&&(s=f),s&&f.sn===s.sn&&(!d||c[0].fragment.sn>f.sn)&&s&&f.level===s.level){const y=o[m+1];f.sn<a&&this.fragmentTracker.getState(y)!==Fe.OK?f=y:f=null}}return f}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const i=this.hls.liveSyncPosition,s=r.currentTime,o=e.fragments[0].start,a=e.edge,l=s>=o-t.maxFragLookUpTolerance&&s<=a;if(i!==null&&r.duration>i&&(s<i||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!l&&r.readyState<4||s<a-u)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${a}, reset currentTime to : ${i.toFixed(3)}`),r.currentTime=i))}}alignPlaylists(e,t,r){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const s=e.fragments[0].start,o=!t,a=e.alignedSliding&&$(s);if(o||!a&&!s){const{fragPrevious:l}=this;Xx(l,r,e);const u=e.fragments[0].start;return this.log(`Live playlist sliding: ${u.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${l?l.sn:"na"} fragments: ${i}`),u}return s}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){const i=this.startTimeOffset!==null,s=i?this.startTimeOffset:e.startTimeOffset;s!==null&&$(s)?(r=t+s,s<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${s} found in ${i?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){const{media:e}=this;let t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==b.FRAG_LOADING_WAITING_RETRY)&&(this.state=b.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const c=this.getCurrentContext(t.chunkMeta);c&&(t.frag=c.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var i;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const s=t.details===k.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction,{action:a,retryCount:l=0,retryConfig:u}=o||{};if(o&&a===Ue.RetryRequest&&u){this.resetStartWhenNotLoaded(this.levelLastLoaded);const c=Nu(u,l);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${l+1}/${u.maxNumRetry} in ${c}ms`),o.resolved=!0,this.retryDate=self.performance.now()+c,this.state=b.FRAG_LOADING_WAITING_RETRY}else if(u&&o)if(this.resetFragmentErrors(e),l<u.maxNumRetry)!s&&a!==Ue.RemoveAlternatePermanently&&(o.resolved=!0);else{R.warn(`${t.details} reached or exceeded max retry (${l})`);return}else o?.action===Ue.SendAlternateToPenaltyBox?this.state=b.WAITING_LEVEL:this.state=b.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===b.PARSING||this.state===b.PARSED){const t=e.frag,r=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),s=i&&i.len>.5;s&&this.reduceMaxBufferLength(i.len,t?.duration||10);const o=!s;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===X.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==b.STOPPED&&(this.state=b.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;const i=fe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,r),this.state===b.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=b.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,i){var s;const o=r.details;if(!o){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=i?0:J0(o,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(v.LEVEL_PTS_UPDATED,{details:o,level:r,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const l=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=b.PARSED,this.hls.trigger(v.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}class sm{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;if(e.length)e.length===1?r=e[0]:r=sE(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}}function sE(n,e){const t=new Uint8Array(e);let r=0;for(let i=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}function oE(){return typeof __HLS_WORKER_BUNDLE__=="function"}function aE(){const n=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(n);return{worker:new self.Worker(e),objectURL:e}}function lE(n){const e=new self.URL(n,self.location.href).href;return{worker:new self.Worker(e),scriptURL:e}}function Bt(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Gu{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=St(this.cachedData,e),this.cachedData=null);let r=Ii(e,0),i=r?r.length:0,s;const o=this._audioTrack,a=this._id3Track,l=r?Ou(r):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&$(l))&&(this.basePTS=uE(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:kt.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const c=this.appendFrame(o,e,i);c?(this.frameIndex++,this.lastPTS=c.sample.pts,i+=c.length,s=i):i=u}else Dv(e,i)?(r=Ii(e,i),a.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:kt.audioId3,duration:Number.POSITIVE_INFINITY}),i+=r.length,s=i):i++;if(i===u&&s!==u){const c=Vn(e,s);this.cachedData?this.cachedData=St(this.cachedData,c):this.cachedData=c}}return{audioTrack:o,videoTrack:Bt(),id3Track:a,textTrack:Bt()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Bt(),id3Track:this._id3Track,textTrack:Bt()}}destroy(){}}const uE=(n,e,t)=>{if($(n))return n*90;const r=t?t.baseTime*9e4/t.timescale:0;return e*9e4+r};function cE(n,e,t,r){let i,s,o,a;const l=navigator.userAgent.toLowerCase(),u=r,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((e[t+2]&192)>>>6)+1;const d=(e[t+2]&60)>>>2;if(d>c.length-1){const f=new Error(`invalid ADTS sampling index:${d}`);n.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!0,error:f,reason:f.message});return}return o=(e[t+2]&1)<<2,o|=(e[t+3]&192)>>>6,R.log(`manifest codec:${r}, ADTS type:${i}, samplingIndex:${d}`),/firefox/i.test(l)?d>=6?(i=5,a=new Array(4),s=d-3):(i=2,a=new Array(2),s=d):l.indexOf("android")!==-1?(i=2,a=new Array(2),s=d):(i=5,a=new Array(4),r&&(r.indexOf("mp4a.40.29")!==-1||r.indexOf("mp4a.40.5")!==-1)||!r&&d>=6?s=d-3:((r&&r.indexOf("mp4a.40.2")!==-1&&(d>=6&&o===1||/vivaldi/i.test(l))||!r&&o===1)&&(i=2,a=new Array(2)),s=d)),a[0]=i<<3,a[0]|=(d&14)>>1,a[1]|=(d&1)<<7,a[1]|=o<<3,i===5&&(a[1]|=(s&14)>>1,a[2]=(s&1)<<7,a[2]|=8,a[3]=0),{config:a,samplerate:c[d],channelCount:o,codec:"mp4a.40."+i,manifestCodec:u}}function om(n,e){return n[e]===255&&(n[e+1]&246)===240}function am(n,e){return n[e+1]&1?7:9}function Vu(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function dE(n,e){return e+5<n.length}function fo(n,e){return e+1<n.length&&om(n,e)}function fE(n,e){return dE(n,e)&&om(n,e)&&Vu(n,e)<=n.length-e}function hE(n,e){if(fo(n,e)){const t=am(n,e);if(e+t>=n.length)return!1;const r=Vu(n,e);if(r<=t)return!1;const i=e+r;return i===n.length||fo(n,i)}return!1}function lm(n,e,t,r,i){if(!n.samplerate){const s=cE(e,t,r,i);if(!s)return;n.config=s.config,n.samplerate=s.samplerate,n.channelCount=s.channelCount,n.codec=s.codec,n.manifestCodec=s.manifestCodec,R.log(`parsed codec:${n.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function um(n){return 1024*9e4/n}function mE(n,e){const t=am(n,e);if(e+t<=n.length){const r=Vu(n,e)-t;if(r>0)return{headerLength:t,frameLength:r}}}function cm(n,e,t,r,i){const s=um(n.samplerate),o=r+i*s,a=mE(e,t);let l;if(a){const{frameLength:d,headerLength:f}=a,m=f+d,h=Math.max(0,t+m-e.length);h?(l=new Uint8Array(m-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+m);const g={unit:l,pts:o};return h||n.samples.push(g),{sample:g,length:m,missing:h}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:o},length:u,missing:-1}}let os=null;const gE=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],pE=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],yE=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],vE=[0,1,1,4];function dm(n,e,t,r,i){if(t+24>e.length)return;const s=fm(e,t);if(s&&t+s.frameLength<=e.length){const o=s.samplesPerFrame*9e4/s.sampleRate,a=r+i*o,l={unit:e.subarray(t,t+s.frameLength),pts:a,dts:a};return n.config=[],n.channelCount=s.channelCount,n.samplerate=s.sampleRate,n.samples.push(l),{sample:l,length:s.frameLength,missing:0}}}function fm(n,e){const t=n[e+1]>>3&3,r=n[e+1]>>1&3,i=n[e+2]>>4&15,s=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&s!==3){const o=n[e+2]>>1&1,a=n[e+3]>>6,l=t===3?3-r:r===3?3:4,u=gE[l*14+i-1]*1e3,d=pE[(t===3?0:t===2?1:2)*3+s],f=a===3?1:2,m=yE[t][r],h=vE[r],g=m*8*h,y=Math.floor(m*u/d+o)*h;if(os===null){const E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);os=E?parseInt(E[1]):0}return!!os&&os<=87&&r===2&&u>=224e3&&a===0&&(n[e+3]=n[e+3]|128),{sampleRate:d,channelCount:f,frameLength:y,samplesPerFrame:g}}}function Hu(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function hm(n,e){return e+1<n.length&&Hu(n,e)}function xE(n,e){return Hu(n,e)&&4<=n.length-e}function mm(n,e){if(e+1<n.length&&Hu(n,e)){const r=fm(n,e);let i=4;r!=null&&r.frameLength&&(i=r.frameLength);const s=e+i;return s===n.length||hm(n,s)}return!1}class EE extends Gu{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ii(e,0);let r=t?.length||0;if(mm(e,r))return!1;for(let i=e.length;r<i;r++)if(hE(e,r))return R.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return fE(e,t)}appendFrame(e,t,r){lm(e,this.observer,t,r,e.manifestCodec);const i=cm(e,t,r,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const SE=/\/emsg[-/]ID3/i;class TE{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,i){const s=this.videoTrack=Bt("video",1),o=this.audioTrack=Bt("audio",1),a=this.txtTrack=Bt("text",1);if(this.id3Track=Bt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=K0(e);if(l.video){const{id:u,timescale:c,codec:d}=l.video;s.id=u,s.timescale=a.timescale=c,s.codec=d}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;o.id=u,o.timescale=c,o.codec=d}a.id=G0.text,s.sampleDuration=0,s.duration=o.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return Bv(e)}demux(e,t){this.timeOffset=t;let r=e;const i=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=St(this.remainderData,e));const a=Wv(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;const o=this.extractID3Track(i,t);return s.samples=fd(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return r.samples=fd(e,t),{videoTrack:t,audioTrack:Bt(),id3Track:i,textTrack:Bt()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const i=Z(e.samples,["emsg"]);i&&i.forEach(s=>{const o=Xv(s);if(SE.test(o.schemeIdUri)){const a=$(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale;let l=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=o.payload;r.samples.push({data:u,len:u.byteLength,dts:a,pts:a,type:kt.emsg,duration:l})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const gm=(n,e)=>{let t=0,r=5;e+=r;const i=new Uint32Array(1),s=new Uint32Array(1),o=new Uint8Array(1);for(;r>0;){o[0]=n[e];const a=Math.min(r,8),l=8-a;s[0]=4278190080>>>24+l<<l,i[0]=(o[0]&s[0])>>l,t=t?t<<a|i[0]:i[0],e+=1,r-=a}return t};class LE extends Gu{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const i=pm(e,t,r,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Ii(e,0);if(!t)return!1;const r=t.length;return e[r]===11&&e[r+1]===119&&Ou(t)!==void 0&&gm(e,r)<16}}function pm(n,e,t,r,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const s=e[t+4]>>6;if(s>=3)return-1;const a=[48e3,44100,32e3][s],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+s]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const m=(e[t+6]<<8|e[t+7])>>12-f&1,g=[2,1,2,3,3,4,4,5][d]+m,y=e[t+5]>>3,p=e[t+5]&7,x=new Uint8Array([s<<6|y<<1|p>>2,(p&3)<<6|d<<3|m<<2|l>>4,l<<4&224]),E=1536/a*9e4,T=r+i*E,S=e.subarray(t,t+c);return n.config=x,n.channelCount=g,n.samplerate=a,n.samples.push({unit:S,pts:T}),c}class AE{constructor(){this.VideoSample=null}createVideoSample(e,t,r,i){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:i,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,i;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){const s=r.units;i=s[s.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const r=t.samples,i=r.length;if(i){const s=r[i-1];e.pts=s.pts,e.dts=s.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&R.log(e.pts+"/"+e.dts+":"+e.debug)}}class $d{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),s=Math.min(4,t);if(s===0)throw new Error("no bytes available");i.set(e.subarray(r,r+s)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&R.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,i;for(let s=0;s<e;s++)r!==0&&(i=this.readEG(),r=(t+i+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,i=0,s,o,a;const l=this.readUByte.bind(this),u=this.readBits.bind(this),c=this.readUEG.bind(this),d=this.readBoolean.bind(this),f=this.skipBits.bind(this),m=this.skipEG.bind(this),h=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);l();const y=l();if(u(5),f(3),l(),h(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const A=c();if(A===3&&f(1),h(),h(),f(1),d())for(o=A!==3?8:12,a=0;a<o;a++)d()&&(a<6?g(16):g(64))}h();const p=c();if(p===0)c();else if(p===1)for(f(1),m(),m(),s=c(),a=0;a<s;a++)m();h(),f(1);const x=c(),E=c(),T=u(1);T===0&&f(1),f(1),d()&&(e=c(),t=c(),r=c(),i=c());let S=[1,1];if(d()&&d())switch(l()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:{S=[l()<<8|l(),l()<<8|l()];break}}return{width:Math.ceil((x+1)*16-e*2-t*2),height:(2-T)*(E+1)*16-(T?2:4)*(r+i),pixelRatio:S}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class RE extends AE{parseAVCPES(e,t,r,i,s){const o=this.parseAVCNALu(e,r.data);let a=this.VideoSample,l,u=!1;r.data=null,a&&o.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),o.forEach(c=>{var d;switch(c.type){case 1:{let g=!1;l=!0;const y=c.data;if(u&&y.length>4){const p=new $d(y).readSliceType();(p===2||p===4||p===7||p===9)&&(g=!0)}if(g){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.frame=!0,a.key=g;break}case 5:l=!0,(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),a.key=!0,a.frame=!0;break;case 6:{l=!0,z0(c.data,1,r.pts,t.samples);break}case 7:{var m,h;l=!0,u=!0;const g=c.data,p=new $d(g).readSPS();if(!e.sps||e.width!==p.width||e.height!==p.height||((m=e.pixelRatio)==null?void 0:m[0])!==p.pixelRatio[0]||((h=e.pixelRatio)==null?void 0:h[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[g],e.duration=s;const x=g.subarray(1,4);let E="avc1.";for(let T=0;T<3;T++){let S=x[T].toString(16);S.length<2&&(S="0"+S),E+=S}e.codec=E}break}case 8:l=!0,e.pps=[c.data];break;case 9:l=!0,e.audFound=!0,a&&this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:l=!0;break;default:l=!1,a&&(a.debug+="unknown NAL "+c.type+" ");break}a&&l&&a.units.push(c)}),i&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}parseAVCNALu(e,t){const r=t.byteLength;let i=e.naluState||0;const s=i,o=[];let a=0,l,u,c,d=-1,f=0;for(i===-1&&(d=0,f=t[0]&31,i=0,a=1);a<r;){if(l=t[a++],!i){i=l?0:1;continue}if(i===1){i=l?0:2;continue}if(!l)i=3;else if(l===1){if(u=a-i-1,d>=0){const m={data:t.subarray(d,u),type:f};o.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(s&&a<=4-s&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-s)),u>0&&(m.data=St(m.data,t.subarray(0,u)),m.state=0))}a<r?(c=t[a]&31,d=a,f=c,i=0):i=-1}else i=0}if(d>=0&&i>=0){const m={data:t.subarray(d,r),type:f,state:i};o.push(m)}if(o.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=St(m.data,t))}return e.naluState=i,o}}class IE{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new Bu(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){const i=e[t].unit;if(i.length<=16)return;const s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(o).then(a=>{const l=new Uint8Array(a);i.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)r.set(e.subarray(s,s+16),i);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let i=0;for(let s=32;s<e.length-16;s+=160,i+=16)e.set(r.subarray(i,i+16),s);return e}decryptAvcSample(e,t,r,i,s){const o=W0(s.data),a=this.getAvcEncryptedData(o);this.decryptBuffer(a.buffer).then(l=>{s.data=this.getAvcDecryptedUnit(o,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,i)})}decryptAvcSamples(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){i();return}const s=e[t].units;for(;!(r>=s.length);r++){const o=s[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,r,i,o),!this.decrypter.isSync()))return}}}}const be=188;class hn{constructor(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.videoParser=new RE}static probe(e){const t=hn.syncOffset(e);return t>0&&R.warn(`MPEG2-TS detected but first sync word found @ offset ${t}`),t!==-1}static syncOffset(e){const t=e.length;let r=Math.min(be*5,t-be)+1,i=0;for(;i<r;){let s=!1,o=-1,a=0;for(let l=i;l<t;l+=be)if(e[l]===71&&(t-l===be||e[l+be]===71)){if(a++,o===-1&&(o=l,o!==0&&(r=Math.min(o+be*99,e.length-be)+1)),s||(s=Dl(e,l)===0),s&&a>1&&(o===0&&a>2||l+be>r))return o}else{if(a)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:G0[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=hn.createTrack("video"),this._audioTrack=hn.createTrack("audio",i),this._id3Track=hn.createTrack("id3"),this._txtTrack=hn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,i=!1){r||(this.sampleAes=null);let s;const o=this._videoTrack,a=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=o.pid,d=o.pesData,f=a.pid,m=l.pid,h=a.pesData,g=l.pesData,y=null,p=this.pmtParsed,x=this._pmtId,E=e.length;if(this.remainderData&&(e=St(this.remainderData,e),E=e.length,this.remainderData=null),E<be&&!i)return this.remainderData=e,{audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};const T=Math.max(0,hn.syncOffset(e));E-=(E-T)%be,E<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,E,e.buffer.byteLength-E));let S=0;for(let L=T;L<E;L+=be)if(e[L]===71){const C=!!(e[L+1]&64),N=Dl(e,L),w=(e[L+3]&48)>>4;let F;if(w>1){if(F=L+5+e[L+4],F===L+be)continue}else F=L+4;switch(N){case c:C&&(d&&(s=tr(d))&&this.videoParser.parseAVCPES(o,u,s,!1,this._duration),d={data:[],size:0}),d&&(d.data.push(e.subarray(F,L+be)),d.size+=L+be-F);break;case f:if(C){if(h&&(s=tr(h)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,s);break;case"mp3":this.parseMPEGPES(a,s);break;case"ac3":this.parseAC3PES(a,s);break}h={data:[],size:0}}h&&(h.data.push(e.subarray(F,L+be)),h.size+=L+be-F);break;case m:C&&(g&&(s=tr(g))&&this.parseID3PES(l,s),g={data:[],size:0}),g&&(g.data.push(e.subarray(F,L+be)),g.size+=L+be-F);break;case 0:C&&(F+=e[F]+1),x=this._pmtId=wE(e,F);break;case x:{C&&(F+=e[F]+1);const z=CE(e,F,this.typeSupported,r,this.observer);c=z.videoPid,c>0&&(o.pid=c,o.segmentCodec=z.segmentVideoCodec),f=z.audioPid,f>0&&(a.pid=f,a.segmentCodec=z.segmentAudioCodec),m=z.id3Pid,m>0&&(l.pid=m),y!==null&&!p&&(R.warn(`MPEG-TS PMT found at ${L} after unknown PID '${y}'. Backtracking to sync byte @${T} to parse all TS packets.`),y=null,L=T-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:y=N;break}}else S++;S>0&&ho(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`)),o.pesData=d,a.pesData=h,l.pesData=g;const A={audioTrack:a,videoTrack:o,id3Track:l,textTrack:u};return i&&this.extractRemainingSamples(A),A}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:i,textTrack:s}=e,o=r.pesData,a=t.pesData,l=i.pesData;let u;if(o&&(u=tr(o))?(this.videoParser.parseAVCPES(r,s,u,!0,this._duration),r.pesData=null):r.pesData=o,a&&(u=tr(a))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else a!=null&&a.size&&R.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=a;l&&(u=tr(l))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=l}demuxSampleAes(e,t,r){const i=this.demux(e,r,!0,!this.config.progressive),s=this.sampleAes=new IE(this.observer,this.config,t);return this.decrypt(i,s)}decrypt(e,t){return new Promise(r=>{const{audioTrack:i,videoTrack:s}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{s.samples?t.decryptAvcSamples(s.samples,0,0,()=>{r(e)}):r(e)}):s.samples&&t.decryptAvcSamples(s.samples,0,0,()=>{r(e)})})}destroy(){this._duration=0}parseAACPES(e,t){let r=0;const i=this.aacOverFlow;let s=t.data;if(i){this.aacOverFlow=null;const d=i.missing,f=i.sample.unit.byteLength;if(d===-1)s=St(i.sample.unit,s);else{const m=f-d;i.sample.unit.set(s.subarray(0,d),m),e.samples.push(i.sample),r=i.missing}}let o,a;for(o=r,a=s.length;o<a-1&&!fo(s,o);o++);if(o!==r){let d;const f=o<a-1;if(f?d=`AAC PES did not start with ADTS header,offset:${o}`:d="No ADTS header found in AAC PES",ho(this.observer,new Error(d),f),!f)return}lm(e,this.observer,s,o,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(i){const d=um(e.samplerate);l=i.sample.pts+d}else{R.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;o<a;)if(c=cm(e,s,o,l,u),o+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;o<a-1&&!fo(s,o);o++);}parseMPEGPES(e,t){const r=t.data,i=r.length;let s=0,o=0;const a=t.pts;if(a===void 0){R.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<i;)if(hm(r,o)){const l=dm(e,r,o,a,s);if(l)o+=l.length,s++;else break}else o++}parseAC3PES(e,t){{const r=t.data,i=t.pts;if(i===void 0){R.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=r.length;let o=0,a=0,l;for(;a<s&&(l=pm(e,r,a,i,o++))>0;)a+=l}}parseID3PES(e,t){if(t.pts===void 0){R.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const r=we({},t,{type:this._videoTrack?kt.emsg:kt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function Dl(n,e){return((n[e+1]&31)<<8)+n[e+2]}function wE(n,e){return(n[e+10]&31)<<8|n[e+11]}function CE(n,e,t,r,i){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(n[e+1]&15)<<8|n[e+2],a=e+3+o-4,l=(n[e+10]&15)<<8|n[e+11];for(e+=12+l;e<a;){const u=Dl(n,e),c=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!r){xa("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=u);break;case 21:s.id3Pid===-1&&(s.id3Pid=u);break;case 219:if(!r){xa("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=u,s.segmentVideoCodec="avc");break;case 3:case 4:!t.mpeg&&!t.mp3?R.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=u,s.segmentAudioCodec="mp3");break;case 193:if(!r){xa("AC-3");break}case 129:t.ac3?s.audioPid===-1&&(s.audioPid=u,s.segmentAudioCodec="ac3"):R.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&c>0){let d=e+5,f=c;for(;f>2;){switch(n[d]){case 106:t.ac3!==!0?R.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=u,s.segmentAudioCodec="ac3");break}const h=n[d+1]+2;d+=h,f-=h}}break;case 194:case 135:return ho(i,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return ho(i,new Error("Unsupported HEVC in M2TS found")),s}e+=c+5}return s}function ho(n,e,t){R.warn(`parsing error: ${e.message}`),n.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function xa(n){R.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function tr(n){let e=0,t,r,i,s,o;const a=n.data;if(!n||n.size===0)return null;for(;a[0].length<19&&a.length>1;)a[0]=St(a[0],a[1]),a.splice(1,1);if(t=a[0],(t[0]<<16)+(t[1]<<8)+t[2]===1){if(r=(t[4]<<8)+t[5],r&&r>n.size-6)return null;const u=t[7];u&192&&(s=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,u&64?(o=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,s-o>60*9e4&&(R.warn(`${Math.round((s-o)/9e4)}s delta between PTS and DTS, align them`),s=o)):o=s),i=t[8];let c=i+9;if(n.size<=c)return null;n.size-=c;const d=new Uint8Array(n.size);for(let f=0,m=a.length;f<m;f++){t=a[f];let h=t.byteLength;if(c)if(c>h){c-=h;continue}else t=t.subarray(c),h-=c,c=0;d.set(t,e),e+=h}return r&&(r-=i+3),{data:d,pts:s,dts:o,len:r}}return null}class kE extends Gu{resetInitSegment(e,t,r,i){super.resetInitSegment(e,t,r,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ii(e,0);let r=t?.length||0;if(t&&e[r]===11&&e[r+1]===119&&Ou(t)!==void 0&&gm(e,r)<=16)return!1;for(let i=e.length;r<i;r++)if(mm(e,r))return R.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return xE(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return dm(e,t,r,this.basePTS,this.frameIndex)}}class Gd{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const cn=Math.pow(2,32)-1;class I{static init(){I.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in I.types)I.types.hasOwnProperty(e)&&(I.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);I.HDLR_TYPES={video:t,audio:r};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);I.STTS=I.STSC=I.STCO=s,I.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),I.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),I.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),I.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);I.FTYP=I.box(I.types.ftyp,o,l,o,a),I.DINF=I.box(I.types.dinf,I.box(I.types.dref,i))}static box(e,...t){let r=8,i=t.length;const s=i;for(;i--;)r+=t[i].byteLength;const o=new Uint8Array(r);for(o[0]=r>>24&255,o[1]=r>>16&255,o[2]=r>>8&255,o[3]=r&255,o.set(e,4),i=0,r=8;i<s;i++)o.set(t[i],r),r+=t[i].byteLength;return o}static hdlr(e){return I.box(I.types.hdlr,I.HDLR_TYPES[e])}static mdat(e){return I.box(I.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(cn+1)),i=Math.floor(t%(cn+1));return I.box(I.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return I.box(I.types.mdia,I.mdhd(e.timescale,e.duration),I.hdlr(e.type),I.minf(e))}static mfhd(e){return I.box(I.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?I.box(I.types.minf,I.box(I.types.smhd,I.SMHD),I.DINF,I.stbl(e)):I.box(I.types.minf,I.box(I.types.vmhd,I.VMHD),I.DINF,I.stbl(e))}static moof(e,t,r){return I.box(I.types.moof,I.mfhd(e),I.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=I.trak(e[t]);return I.box.apply(null,[I.types.moov,I.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(I.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=I.trex(e[t]);return I.box.apply(null,[I.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(cn+1)),i=Math.floor(t%(cn+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,r>>24,r>>16&255,r>>8&255,r&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return I.box(I.types.mvhd,s)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let i,s;for(i=0;i<t.length;i++)s=t[i].flags,r[i+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return I.box(I.types.sdtp,r)}static stbl(e){return I.box(I.types.stbl,I.stsd(e),I.box(I.types.stts,I.STTS),I.box(I.types.stsc,I.STSC),I.box(I.types.stsz,I.STSZ),I.box(I.types.stco,I.STCO))}static avc1(e){let t=[],r=[],i,s,o;for(i=0;i<e.sps.length;i++)s=e.sps[i],o=s.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(s));for(i=0;i<e.pps.length;i++)s=e.pps[i],o=s.byteLength,r.push(o>>>8&255),r.push(o&255),r=r.concat(Array.prototype.slice.call(s));const a=I.box(I.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(r))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return I.box(I.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,I.box(I.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),I.box(I.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))}static audioStsd(e){const t=e.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return I.box(I.types.mp4a,I.audioStsd(e),I.box(I.types.esds,I.esds(e)))}static mp3(e){return I.box(I.types[".mp3"],I.audioStsd(e))}static ac3(e){return I.box(I.types["ac-3"],I.audioStsd(e),I.box(I.types.dac3,e.config))}static stsd(e){return e.type==="audio"?e.segmentCodec==="mp3"&&e.codec==="mp3"?I.box(I.types.stsd,I.STSD,I.mp3(e)):e.segmentCodec==="ac3"?I.box(I.types.stsd,I.STSD,I.ac3(e)):I.box(I.types.stsd,I.STSD,I.mp4a(e)):I.box(I.types.stsd,I.STSD,I.avc1(e))}static tkhd(e){const t=e.id,r=e.duration*e.timescale,i=e.width,s=e.height,o=Math.floor(r/(cn+1)),a=Math.floor(r%(cn+1));return I.box(I.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,a>>24,a>>16&255,a>>8&255,a&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,s>>8&255,s&255,0,0]))}static traf(e,t){const r=I.sdtp(e),i=e.id,s=Math.floor(t/(cn+1)),o=Math.floor(t%(cn+1));return I.box(I.types.traf,I.box(I.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),I.box(I.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,o>>24,o>>16&255,o>>8&255,o&255])),I.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,I.box(I.types.trak,I.tkhd(e),I.mdia(e))}static trex(e){const t=e.id;return I.box(I.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],i=r.length,s=12+16*i,o=new Uint8Array(s);let a,l,u,c,d,f;for(t+=8+s,o.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),a=0;a<i;a++)l=r[a],u=l.duration,c=l.size,d=l.flags,f=l.cts,o.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*a);return I.box(I.types.trun,o)}static initSegment(e){I.types||I.init();const t=I.moov(e);return St(I.FTYP,t)}}I.types=void 0;I.HDLR_TYPES=void 0;I.STTS=void 0;I.STSC=void 0;I.STCO=void 0;I.STSZ=void 0;I.VMHD=void 0;I.SMHD=void 0;I.STSD=void 0;I.FTYP=void 0;I.DINF=void 0;const ym=9e4;function Ku(n,e,t=1,r=!1){const i=n*e*t;return r?Math.round(i):i}function DE(n,e,t=1,r=!1){return Ku(n,e,1/t,r)}function Yr(n,e=!1){return Ku(n,1e3,1/ym,e)}function _E(n,e=1){return Ku(n,ym,1/e)}const bE=10*1e3,Vd=1024,PE=1152,FE=1536;let nr=null,Ea=null;class ws{constructor(e,t,r,i=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,nr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);nr=o?parseInt(o[1]):0}if(Ea===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);Ea=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){R.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){R.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){R.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,i=e.reduce((s,o)=>{let a=o.pts,l=a-s;return l<-4294967296&&(t=!0,a=mt(a,r),l=a-s),l>0?s:a},r);return t&&R.debug("PTS rollover detected"),i}remux(e,t,r,i,s,o,a,l){let u,c,d,f,m,h,g=s,y=s;const p=e.pid>-1,x=t.pid>-1,E=t.samples.length,T=e.samples.length>0,S=a&&E>0||E>1;if((!p||T)&&(!x||S)||this.ISGenerated||a){if(this.ISGenerated){var L,C,N,w;const V=this.videoTrackConfig;V&&(t.width!==V.width||t.height!==V.height||((L=t.pixelRatio)==null?void 0:L[0])!==((C=V.pixelRatio)==null?void 0:C[0])||((N=t.pixelRatio)==null?void 0:N[1])!==((w=V.pixelRatio)==null?void 0:w[1]))&&this.resetInitSegment()}else d=this.generateIS(e,t,s,o);const F=this.isVideoContiguous;let z=-1,U;if(S&&(z=OE(t.samples),!F&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,z>0){R.warn(`[mp4-remuxer]: Dropped ${z} out of ${E} video samples due to a missing keyframe`);const V=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(z),t.dropped+=z,y+=(t.samples[0].pts-V)/t.inputTimeScale,U=y}else z===-1&&(R.warn(`[mp4-remuxer]: No keyframe found out of ${E} video samples`),h=!1);if(this.ISGenerated){if(T&&S){const V=this.getVideoStartPts(t.samples),K=(mt(e.samples[0].pts,V)-V)/t.inputTimeScale;g+=Math.max(0,K),y+=Math.max(0,-K)}if(T){if(e.samplerate||(R.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(e,t,s,o)),c=this.remuxAudio(e,g,this.isAudioContiguous,o,x||S||l===X.AUDIO?y:void 0),S){const V=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(R.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(e,t,s,o)),u=this.remuxVideo(t,y,F,V)}}else S&&(u=this.remuxVideo(t,y,F,0));u&&(u.firstKeyFrame=z,u.independent=z!==-1,u.firstKeyFramePTS=U)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(m=vm(r,s,this._initPTS,this._initDTS)),i.samples.length&&(f=xm(i,s,this._initPTS))),{audio:c,video:u,initSegment:d,independent:h,text:f,id3:m}}generateIS(e,t,r,i){const s=e.samples,o=t.samples,a=this.typeSupported,l={},u=this._initPTS;let c=!u||i,d="audio/mp4",f,m,h;if(c&&(f=m=1/0),e.config&&s.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":a.mpeg?(d="audio/mpeg",e.codec=""):a.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&a.mpeg?new Uint8Array(0):I.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(h=e.inputTimeScale,!u||h!==u.timescale?f=m=s[0].pts-Math.round(h*r):c=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:I.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(h=t.inputTimeScale,!u||h!==u.timescale){const g=this.getVideoStartPts(o),y=Math.round(h*r);m=Math.min(m,mt(o[0].dts,g)-y),f=Math.min(f,g-y)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(this._initPTS={baseTime:f,timescale:h},this._initDTS={baseTime:m,timescale:h}):f=h=void 0,{tracks:l,initPTS:f,timescale:h}}remuxVideo(e,t,r,i){const s=e.inputTimeScale,o=e.samples,a=[],l=o.length,u=this._initPTS;let c=this.nextAvcDts,d=8,f=this.videoSampleDuration,m,h,g=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,p=!1;if(!r||c===null){const P=t*s,_=o[0].pts-mt(o[0].dts,o[0].pts);nr&&c!==null&&Math.abs(P-_-c)<15e3?r=!0:c=P-_}const x=u.baseTime*s/u.timescale;for(let P=0;P<l;P++){const _=o[P];_.pts=mt(_.pts-x,c),_.dts=mt(_.dts-x,c),_.dts<o[P>0?P-1:P].dts&&(p=!0)}p&&o.sort(function(P,_){const W=P.dts-_.dts,j=P.pts-_.pts;return W||j}),m=o[0].dts,h=o[o.length-1].dts;const E=h-m,T=E?Math.round(E/(l-1)):f||e.inputTimeScale/30;if(r){const P=m-c,_=P>T,W=P<-1;if((_||W)&&(_?R.warn(`AVC: ${Yr(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):R.warn(`AVC: ${Yr(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!W||c>=o[0].pts||nr)){m=c;const j=o[0].pts-P;if(_)o[0].dts=m,o[0].pts=j;else for(let te=0;te<o.length&&!(o[te].dts>j);te++)o[te].dts-=P,o[te].pts-=P;R.log(`Video: Initial PTS/DTS adjusted: ${Yr(j,!0)}/${Yr(m,!0)}, delta: ${Yr(P,!0)} ms`)}}m=Math.max(0,m);let S=0,A=0,L=m;for(let P=0;P<l;P++){const _=o[P],W=_.units,j=W.length;let te=0;for(let oe=0;oe<j;oe++)te+=W[oe].data.length;A+=te,S+=j,_.length=te,_.dts<L?(_.dts=L,L+=T/4|0||1):L=_.dts,g=Math.min(_.pts,g),y=Math.max(_.pts,y)}h=o[l-1].dts;const C=A+4*S+8;let N;try{N=new Uint8Array(C)}catch(P){this.observer.emit(v.ERROR,v.ERROR,{type:J.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:C,reason:`fail allocating video mdat ${C}`});return}const w=new DataView(N.buffer);w.setUint32(0,C),N.set(I.types.mdat,4);let F=!1,z=Number.POSITIVE_INFINITY,U=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,Y=Number.NEGATIVE_INFINITY;for(let P=0;P<l;P++){const _=o[P],W=_.units;let j=0;for(let pe=0,ce=W.length;pe<ce;pe++){const de=W[pe],Pt=de.data,Mr=de.data.byteLength;w.setUint32(d,Mr),d+=4,N.set(Pt,d),d+=Mr,j+=4+Mr}let te;if(P<l-1)f=o[P+1].dts-_.dts,te=o[P+1].pts-_.pts;else{const pe=this.config,ce=P>0?_.dts-o[P-1].dts:T;if(te=P>0?_.pts-o[P-1].pts:T,pe.stretchShortVideoTrack&&this.nextAudioPts!==null){const de=Math.floor(pe.maxBufferHole*s),Pt=(i?g+i*s:this.nextAudioPts)-_.pts;Pt>de?(f=Pt-ce,f<0?f=ce:F=!0,R.log(`[mp4-remuxer]: It is approximately ${Pt/90} ms to the next segment; using duration ${f/90} ms for the last video frame.`)):f=ce}else f=ce}const oe=Math.round(_.pts-_.dts);z=Math.min(z,f),V=Math.max(V,f),U=Math.min(U,te),Y=Math.max(Y,te),a.push(new Hd(_.key,f,j,oe))}if(a.length){if(nr){if(nr<70){const P=a[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(Ea&&Y-U<V-z&&T/V<.025&&a[0].cts===0){R.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=m;for(let _=0,W=a.length;_<W;_++){const j=P+a[_].duration,te=P+a[_].cts;if(_<W-1){const oe=j+a[_+1].cts;a[_].duration=oe-te}else a[_].duration=_?a[_-1].duration:T;a[_].cts=0,P=j}}}f=F||!f?T:f,this.nextAvcDts=c=h+f,this.videoSampleDuration=f,this.isVideoContiguous=!0;const O={data1:I.moof(e.sequenceNumber++,m,we({},e,{samples:a})),data2:N,startPTS:g/s,endPTS:(y+f)/s,startDTS:m/s,endDTS:c/s,type:"video",hasAudio:!1,hasVideo:!0,nb:a.length,dropped:e.dropped};return e.samples=[],e.dropped=0,O}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return PE;case"ac3":return FE;default:return Vd}}remuxAudio(e,t,r,i,s){const o=e.inputTimeScale,a=e.samplerate?e.samplerate:o,l=o/a,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,m=[],h=s!==void 0;let g=e.samples,y=f?0:8,p=this.nextAudioPts||-1;const x=t*o,E=d.baseTime*o/d.timescale;if(this.isAudioContiguous=r=r||g.length&&p>0&&(i&&Math.abs(x-p)<9e3||Math.abs(mt(g[0].pts-E,x)-p)<20*c),g.forEach(function(K){K.pts=mt(K.pts-E,x)}),!r||p<0){if(g=g.filter(K=>K.pts>=0),!g.length)return;s===0?p=0:i&&!h?p=Math.max(0,x):p=g[0].pts}if(e.segmentCodec==="aac"){const K=this.config.maxAudioFramesDrift;for(let Q=0,O=p;Q<g.length;Q++){const P=g[Q],_=P.pts,W=_-O,j=Math.abs(1e3*W/o);if(W<=-K*c&&h)Q===0&&(R.warn(`Audio frame @ ${(_/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*W/o)} ms.`),this.nextAudioPts=p=O=_);else if(W>=K*c&&j<bE&&h){let te=Math.round(W/c);O=_-te*c,O<0&&(te--,O+=c),Q===0&&(this.nextAudioPts=p=O),R.warn(`[mp4-remuxer]: Injecting ${te} audio frame @ ${(O/o).toFixed(3)}s due to ${Math.round(1e3*W/o)} ms gap.`);for(let oe=0;oe<te;oe++){const pe=Math.max(O,0);let ce=Gd.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);ce||(R.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ce=P.unit.subarray()),g.splice(Q,0,{unit:ce,pts:pe}),O+=c,Q++}}P.pts=O,O+=c}}let T=null,S=null,A,L=0,C=g.length;for(;C--;)L+=g[C].unit.byteLength;for(let K=0,Q=g.length;K<Q;K++){const O=g[K],P=O.unit;let _=O.pts;if(S!==null){const j=m[K-1];j.duration=Math.round((_-S)/l)}else if(r&&e.segmentCodec==="aac"&&(_=p),T=_,L>0){L+=y;try{A=new Uint8Array(L)}catch(j){this.observer.emit(v.ERROR,v.ERROR,{type:J.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:j,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(A.buffer).setUint32(0,L),A.set(I.types.mdat,4))}else return;A.set(P,y);const W=P.byteLength;y+=W,m.push(new Hd(!0,u,W,0)),S=_}const N=m.length;if(!N)return;const w=m[m.length-1];this.nextAudioPts=p=S+l*w.duration;const F=f?new Uint8Array(0):I.moof(e.sequenceNumber++,T/l,we({},e,{samples:m}));e.samples=[];const z=T/o,U=p/o,Y={data1:F,data2:A,startPTS:z,endPTS:U,startDTS:z,endDTS:U,type:"audio",hasAudio:!0,hasVideo:!1,nb:N};return this.isAudioContiguous=!0,Y}remuxEmptyAudio(e,t,r,i){const s=e.inputTimeScale,o=e.samplerate?e.samplerate:s,a=s/o,l=this.nextAudioPts,u=this._initDTS,c=u.baseTime*9e4/u.timescale,d=(l!==null?l:i.startDTS*s)+c,f=i.endDTS*s+c,m=a*Vd,h=Math.ceil((f-d)/m),g=Gd.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(R.warn("[mp4-remuxer]: remux empty Audio"),!g){R.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const y=[];for(let p=0;p<h;p++){const x=d+p*m;y.push({unit:g,pts:x,dts:x})}return e.samples=y,this.remuxAudio(e,t,r,!1)}}function mt(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function OE(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function vm(n,e,t,r){const i=n.samples.length;if(!i)return;const s=n.inputTimeScale;for(let a=0;a<i;a++){const l=n.samples[a];l.pts=mt(l.pts-t.baseTime*s/t.timescale,e*s)/s,l.dts=mt(l.dts-r.baseTime*s/r.timescale,e*s)/s}const o=n.samples;return n.samples=[],{samples:o}}function xm(n,e,t){const r=n.samples.length;if(!r)return;const i=n.inputTimeScale;for(let o=0;o<r;o++){const a=n.samples[o];a.pts=mt(a.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((o,a)=>o.pts-a.pts);const s=n.samples;return n.samples=[],{samples:s}}class Hd{constructor(e,t,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=i,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class NE{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(Vv(e,i)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const i=this.initData=K0(e);i.audio&&(t=Kd(i.audio,le.AUDIO)),i.video&&(r=Kd(i.video,le.VIDEO));const s={};i.audio&&i.video?s.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?s.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?s.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:R.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,i,s,o){var a,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};$(c)||(c=this.lastEndTime=s||0);const f=t.samples;if(!(f!=null&&f.length))return d;const m={initPTS:void 0,timescale:1};let h=this.initData;if((a=h)!=null&&a.length||(this.generateInitSegment(f),h=this.initData),!((l=h)!=null&&l.length))return R.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1);const g=Kv(f,h),y=Hv(h,f),p=y===null?s:y;(ME(u,p,s,g)||m.timescale!==u.timescale&&o)&&(m.initPTS=p-s,u&&u.timescale===1&&R.warn(`Adjusting initPTS by ${m.initPTS-u.baseTime}`),this.initPTS=u={baseTime:m.initPTS,timescale:1});const x=e?p-u.baseTime/u.timescale:c,E=x+g;zv(h,f,u.baseTime/u.timescale),g>0?this.lastEndTime=E:(R.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const T=!!h.audio,S=!!h.video;let A="";T&&(A+="audio"),S&&(A+="video");const L={data1:f,startPTS:x,startDTS:x,endPTS:E,endDTS:E,type:A,hasAudio:T,hasVideo:S,nb:1,dropped:0};return d.audio=L.type==="audio"?L:void 0,d.video=L.type!=="audio"?L:void 0,d.initSegment=m,d.id3=vm(r,s,u,u),i.samples.length&&(d.text=xm(i,s,u)),d}}function ME(n,e,t,r){if(n===null)return!0;const i=Math.max(r,1),s=e-n.baseTime/n.timescale;return Math.abs(s-t)>i}function Kd(n,e){const t=n?.codec;if(t&&t.length>4)return t;if(e===le.AUDIO){if(t==="ec-3"||t==="ac-3"||t==="alac")return t;if(t==="fLaC"||t==="Opus")return so(t,!1);const r="mp4a.40.5";return R.info(`Parsed audio codec "${t}" or audio object type not handled. Using "${r}"`),r}return R.warn(`Unhandled video codec "${t}"`),t==="hvc1"||t==="hev1"?"hvc1.1.6.L120.90":t==="av01"?"av01.0.04M.08":"avc1.42e01e"}let Qt;try{Qt=self.performance.now.bind(self.performance)}catch{R.debug("Unable to use Performance API on this environment"),Qt=_r?.Date.now}const Cs=[{demux:TE,remux:NE},{demux:hn,remux:ws},{demux:EE,remux:ws},{demux:kE,remux:ws}];Cs.splice(2,0,{demux:LE,remux:ws});class jd{constructor(e,t,r,i,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=s}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,i){const s=r.transmuxing;s.executeStart=Qt();let o=new Uint8Array(e);const{currentTransmuxState:a,transmuxConfig:l}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:m,initSegmentChange:h}=i||a,{audioCodec:g,videoCodec:y,defaultInitPts:p,duration:x,initSegmentData:E}=l,T=UE(o,t);if(T&&T.method==="AES-128"){const C=this.getDecrypter();if(C.isSync()){let N=C.softwareDecrypt(o,T.key.buffer,T.iv.buffer);if(r.part>-1&&(N=C.flush()),!N)return s.executeEnd=Qt(),Sa(r);o=new Uint8Array(N)}else return this.decryptionPromise=C.webCryptoDecrypt(o,T.key.buffer,T.iv.buffer).then(N=>{const w=this.push(N,null,r);return this.decryptionPromise=null,w}),this.decryptionPromise}const S=this.needsProbing(c,d);if(S){const C=this.configureTransmuxer(o);if(C)return R.warn(`[transmuxer] ${C.message}`),this.observer.emit(v.ERROR,v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),s.executeEnd=Qt(),Sa(r)}(c||d||h||S)&&this.resetInitSegment(E,g,y,x,t),(c||h||S)&&this.resetInitialTimestamp(p),u||this.resetContiguity();const A=this.transmux(o,T,m,f,r),L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,s.executeEnd=Qt(),A}flush(e){const t=e.transmuxing;t.executeStart=Qt();const{decrypter:r,currentTransmuxState:i,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(e));const o=[],{timeOffset:a}=i;if(r){const d=r.flush();d&&o.push(this.push(d,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u)return t.executeEnd=Qt(),[Sa(e)];const c=l.flush(a);return ks(c)?c.then(d=>(this.flushRemux(o,d,e),o)):(this.flushRemux(o,c,e),o)}flushRemux(e,t,r){const{audioTrack:i,videoTrack:s,id3Track:o,textTrack:a}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;R.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);const c=this.remuxer.remux(i,s,o,a,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=Qt()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,i,s){const{demuxer:o,remuxer:a}=this;!o||!a||(o.resetInitSegment(e,t,r,i),a.resetInitSegment(e,t,r,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,i,s){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,r,i,s):o=this.transmuxUnencrypted(e,r,i,s),o}transmuxUnencrypted(e,t,r,i){const{audioTrack:s,videoTrack:o,id3Track:a,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,o,a,l,t,r,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,r,i,s){return this.demuxer.demuxSampleAes(e,t,r).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,r,i,!1,this.id),chunkMeta:s}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:i,vendor:s}=this;let o;for(let f=0,m=Cs.length;f<m;f++){var a;if((a=Cs[f].demux)!=null&&a.probe(e)){o=Cs[f];break}}if(!o)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,u=this.remuxer,c=o.remux,d=o.demux;(!u||!(u instanceof c))&&(this.remuxer=new c(r,t,i,s)),(!l||!(l instanceof d))&&(this.demuxer=new d(r,t,i),this.probe=d.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Bu(this.config)),e}}function UE(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Sa=n=>({remuxResult:{},chunkMeta:n});function ks(n){return"then"in n&&n.then instanceof Function}class BE{constructor(e,t,r,i,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=i,this.defaultInitPts=s||null}}class $E{constructor(e,t,r,i,s,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=s,this.initSegmentChange=o}}var Em={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var m=new i(c,d||l,f),h=t?t+u:u;return l._events[h]?l._events[h].fn?l._events[h]=[l._events[h],m]:l._events[h].push(m):(l._events[h]=m,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,m=d.length,h=new Array(m);f<m;f++)h[f]=d[f].fn;return h},a.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(u,c,d,f,m,h){var g=t?t+u:u;if(!this._events[g])return!1;var y=this._events[g],p=arguments.length,x,E;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),p){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,d),!0;case 4:return y.fn.call(y.context,c,d,f),!0;case 5:return y.fn.call(y.context,c,d,f,m),!0;case 6:return y.fn.call(y.context,c,d,f,m,h),!0}for(E=1,x=new Array(p-1);E<p;E++)x[E-1]=arguments[E];y.fn.apply(y.context,x)}else{var T=y.length,S;for(E=0;E<T;E++)switch(y[E].once&&this.removeListener(u,y[E].fn,void 0,!0),p){case 1:y[E].fn.call(y[E].context);break;case 2:y[E].fn.call(y[E].context,c);break;case 3:y[E].fn.call(y[E].context,c,d);break;case 4:y[E].fn.call(y[E].context,c,d,f);break;default:if(!x)for(S=1,x=new Array(p-1);S<p;S++)x[S-1]=arguments[S];y[E].fn.apply(y[E].context,x)}}return!0},a.prototype.on=function(u,c,d){return s(this,u,c,d,!1)},a.prototype.once=function(u,c,d){return s(this,u,c,d,!0)},a.prototype.removeListener=function(u,c,d,f){var m=t?t+u:u;if(!this._events[m])return this;if(!c)return o(this,m),this;var h=this._events[m];if(h.fn)h.fn===c&&(!f||h.once)&&(!d||h.context===d)&&o(this,m);else{for(var g=0,y=[],p=h.length;g<p;g++)(h[g].fn!==c||f&&!h[g].once||d&&h[g].context!==d)&&y.push(h[g]);y.length?this._events[m]=y.length===1?y[0]:y:o(this,m)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(Em);var GE=Em.exports,ju=cv(GE);class Sm{constructor(e,t,r,i){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=e.config;this.hls=e,this.id=t,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;const o=(u,c)=>{c=c||{},c.frag=this.frag,c.id=this.id,u===v.ERROR&&(this.error=c.error),this.hls.trigger(u,c)};this.observer=new ju,this.observer.on(v.FRAG_DECRYPTED,o),this.observer.on(v.ERROR,o);const a=qn(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},l={mpeg:a.isTypeSupported("audio/mpeg"),mp3:a.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:a.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||oE())){try{s.workerPath?(R.log(`loading Web Worker ${s.workerPath} for "${t}"`),this.workerContext=lE(s.workerPath)):(R.log(`injecting Web Worker for "${t}"`),this.workerContext=aE()),this.onwmsg=d=>this.onWorkerMessage(d);const{worker:c}=this.workerContext;c.addEventListener("message",this.onwmsg),c.onerror=d=>{const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);s.enableWorker=!1,R.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})},c.postMessage({cmd:"init",typeSupported:l,vendor:"",id:t,config:JSON.stringify(s)})}catch(c){R.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.resetWorker(),this.error=null,this.transmuxer=new jd(this.observer,l,s,"",t)}return}this.transmuxer=new jd(this.observer,l,s,"",t)}resetWorker(){if(this.workerContext){const{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,i,s,o,a,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{transmuxer:m}=this,h=o?o.start:s.start,g=s.decryptdata,y=this.frag,p=!(y&&s.cc===y.cc),x=!(y&&u.level===y.level),E=y?u.sn-y.sn:-1,T=this.part?u.part-this.part.index:-1,S=E===0&&u.id>1&&u.id===y?.stats.chunkCount,A=!x&&(E===1||E===0&&(T===1||S&&T<=0)),L=self.performance.now();(x||E||s.stats.parsing.start===0)&&(s.stats.parsing.start=L),o&&(T||!A)&&(o.stats.parsing.start=L);const C=!(y&&((d=s.initSegment)==null?void 0:d.url)===((f=y.initSegment)==null?void 0:f.url)),N=new $E(p,A,l,x,h,C);if(!A||p||C){R.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${u.sn} p: ${u.part} level: ${u.level} id: ${u.id}
        discontinuity: ${p}
        trackSwitch: ${x}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${h}
        initSegmentChange: ${C}`);const w=new BE(r,i,t,a,c);this.configureTransmuxer(w)}if(this.frag=s,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:g,chunkMeta:u,state:N},e instanceof ArrayBuffer?[e]:[]);else if(m){const w=m.push(e,g,u,N);ks(w)?(m.async=!0,w.then(F=>{this.handleTransmuxComplete(F)}).catch(F=>{this.transmuxerError(F,u,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(w))}}flush(e){e.transmuxing.start=self.performance.now();const{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);ks(r)||t.async?(ks(r)||(r=Promise.resolve(r)),r.then(s=>{this.handleFlushResult(s,e)}).catch(s=>{this.transmuxerError(s,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){const t=e.data;if(!(t!=null&&t.event)){R.warn(`worker message received with no ${t?"event name":"data"}`);return}const r=this.hls;if(this.hls)switch(t.event){case"init":{var i;const s=(i=this.workerContext)==null?void 0:i.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":R[t.data.logType]&&R[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){const{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const zd=100;class VE extends $u{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",X.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){if(r==="main"){const o=t.cc;this.initPTS[t.cc]={baseTime:i,timescale:s},this.log(`InitPTS for cc: ${o} found from main: ${i}`),this.videoTrackCC=o,this.state===b.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=b.STOPPED;return}const t=this.lastCurrentTime;this.stopLoad(),this.setInterval(zd),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=b.IDLE):(this.loadedmetadata=!1,this.state=b.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case b.IDLE:this.doTickIdle();break;case b.WAITING_TRACK:{var e;const{levels:r,trackId:i}=this,s=r==null||(e=r[i])==null?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=b.WAITING_INIT_PTS}break}case b.FRAG_LOADING_WAITING_RETRY:{var t;const r=performance.now(),i=this.retryDate;if(!i||r>=i||(t=this.media)!=null&&t.seeking){const{levels:s,trackId:o}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(s?.[o]||null),this.state=b.IDLE}break}case b.WAITING_INIT_PTS:{const r=this.waitingData;if(r){const{frag:i,part:s,cache:o,complete:a}=r;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=b.FRAG_LOADING;const l=o.flush(),u={frag:i,part:s,payload:l,networkDetails:null};this._handleFragmentLoadProgress(u),a&&super._handleFragmentLoadComplete(u)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const l=this.getLoadPosition(),u=fe.bufferInfo(this.mediaBuffer,l,this.config.maxBufferHole);kl(u.end,this.config.maxFragLookUpTolerance,i)<0&&(this.log(`Waiting fragment cc (${i.cc}) @ ${i.start} cancelled because another fragment at ${u.end} is needed`),this.clearWaitingFragment())}}else this.state=b.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=b.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){const{hls:e,levels:t,media:r,trackId:i}=this,s=e.config;if(!this.buffering||!r&&(this.startFragRequested||!s.startFragPrefetch)||!(t!=null&&t[i]))return;const o=t[i],a=o.details;if(!a||a.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(a)){this.state=b.WAITING_TRACK;return}const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,le.AUDIO,X.AUDIO));const u=this.getFwdBufferInfo(l,X.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,a)){e.trigger(v.BUFFER_EOS,{type:"audio"}),this.state=b.ENDED;return}const c=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,X.MAIN),d=u.len,f=this.getMaxBufferLength(c?.len),m=a.fragments,h=m[0].start,g=this.getLoadPosition(),y=this.flushing?g:u.end;if(this.switchingTrack&&r){const T=g;a.PTSKnown&&T<h&&(u.end>h||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=h+.05)}if(d>=f&&!this.switchingTrack&&y<m[m.length-1].start)return;let p=this.getNextFragment(y,a),x=!1;if(p&&this.isLoopLoading(p,y)&&(x=!!p.gap,p=this.getNextFragmentLoopLoading(p,a,u,X.MAIN,f)),!p){this.bufferFlushed=!0;return}const E=c&&p.start>c.end+a.targetduration;if(E||!(c!=null&&c.len)&&u.len){const T=this.getAppendedFrag(p.start,X.MAIN);if(T===null||(x||(x=!!T.gap||!!E&&c.len===0),E&&!x||x&&u.nextStart&&u.nextStart<T.end))return}this.loadFragment(p,o,y)}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new br(r))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),r?this.setInterval(zd):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=b.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=b.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(v.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}const{levels:i}=this,{details:s,id:o}=t;if(!i){this.warn(`Audio tracks were reset while loading level ${o}`);return}this.log(`Audio track ${o} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const a=i[o];let l=0;if(s.live||(r=a.details)!=null&&r.live){this.checkLiveUpdate(s);const c=this.mainDetails;if(s.deltaUpdateFailed||!c)return;if(!a.details&&s.hasProgramDateTime&&c.hasProgramDateTime)co(s,c),l=s.fragments[0].start;else{var u;l=this.alignPlaylists(s,a.details,(u=this.levelLastLoaded)==null?void 0:u.details)}}a.details=s,this.levelLastLoaded=a,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,l),this.state===b.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=b.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{config:o,trackId:a,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const u=l[a];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}const d=o.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new Sm(this.hls,X.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const m=this.initPTS[r.cc],h=(t=r.initSegment)==null?void 0:t.data;if(m!==void 0){const y=i?i.index:-1,p=y!==-1,x=new Uu(r.level,r.sn,r.stats.chunkCount,s.byteLength,y,p);f.push(s,h,d,"",r,i,c.totalduration,!1,x,m)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${c.startSN} ,${c.endSN}],track ${a}`);const{cache:g}=this.waitingData=this.waitingData||{frag:r,part:i,cache:new sm,complete:!1};g.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=b.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r.type!==X.AUDIO){if(!this.loadedmetadata&&r.type===X.MAIN){const s=this.videoBuffer||this.media;s&&fe.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(v.AUDIO_TRACK_SWITCHED,Ne({},s)))}this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal){this.state=b.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.AUDIO,t);break;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===b.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===ie.AUDIO_TRACK&&(this.state=b.IDLE);break;case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===k.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==le.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==le.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===b.ENDED&&(this.state=b.IDLE);const r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,X.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{details:d}=c,{audio:f,text:m,id3:h,initSegment:g}=s;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=b.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),g!=null&&g.tracks){const y=l.initSegment||l;this._bufferInitSegment(c,g.tracks,y,o),i.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:y,id:r,tracks:g.tracks})}if(f){const{startPTS:y,endPTS:p,startDTS:x,endDTS:E}=f;u&&(u.elementaryStreams[le.AUDIO]={startPTS:y,endPTS:p,startDTS:x,endDTS:E}),l.setElementaryStreamInfo(le.AUDIO,y,p,x,E),this.bufferFragmentData(f,l,u,o)}if(h!=null&&(t=h.samples)!=null&&t.length){const y=we({id:r,frag:l,details:d},h);i.trigger(v.FRAG_PARSING_METADATA,y)}if(m){const y=we({id:r,frag:l,details:d},m);i.trigger(v.FRAG_PARSING_USERDATA,y)}}_bufferInitSegment(e,t,r,i){if(this.state!==b.PARSING)return;t.video&&delete t.video;const s=t.audio;if(!s)return;s.id="audio";const o=e.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${o}/${s.codec}]`),o&&o.split(",").length===1&&(s.levelCodec=o),this.hls.trigger(v.BUFFER_CODECS,t);const a=s.initSegment;if(a!=null&&a.byteLength){const l={type:"audio",frag:r,part:null,chunkMeta:i,parent:r.type,data:a};this.hls.trigger(v.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||i===Fe.NOT_LOADED||i===Fe.PARTIAL){var s;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((s=t.details)!=null&&s.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=b.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragments[0].start!==t.details.fragments[0].start&&co(t.details,o)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a}=this.bufferedTrack;Hn({name:t,lang:r,assocLang:i,characteristics:s,audioCodec:o,channels:a},e,On)||(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(v.AUDIO_TRACK_SWITCHED,Ne({},e))}}function Tm(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!ki(n[t].attrs,e[t].attrs))return!1;return!0}function ki(n,e,t){const r=n["STABLE-RENDITION-ID"];return r&&!t?r===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function _l(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class HE extends Mu{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(v.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Audio track with id:${r} and group:${i} not found in active group ${o?.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Audio track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||i?.length!==r?.length||r!=null&&r.some(a=>i?.indexOf(a)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(f=>f.default)&&(this.selectDefaultTrack=!1),a.forEach((f,m)=>{f.id=m});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.audioPreference;if(!s&&l){const f=Vt(l,a,On);if(f>-1)s=a[f];else{const m=Vt(l,this.tracks);s=this.tracks[m]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const c={audioTracks:a};this.log(`Updating audio tracks, ${a.length} track(s) found in group(s): ${r?.join(",")}`),this.hls.trigger(v.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(a.length&&d===-1){var o;const f=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${a.length}`);this.warn(f.message),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===ie.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const i=this.currentTrack;if(i&&Hn(e,i,On))return i;const s=Vt(e,this.tracksInGroup,On);if(s>-1){const o=this.tracksInGroup[s];return this.setAudioTrack(s),o}else if(i){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const a=Hx(e,t.levels,r,o,On);if(a===-1)return null;t.nextLoadLevel=a}if(e.channels||e.audioCodec){const o=Vt(e,r);if(o>-1)return r[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e],s=i.details&&!i.details.live;if(e===this.trackId&&i===r&&s||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(v.AUDIO_TRACK_SWITCHING,Ne({},i)),s))return;const o=this.switchParams(i.url,r?.details,i.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Hn(e,i,On)))return r}if(e){const{name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(Hn({name:r,lang:i,assocLang:s,characteristics:o,audioCodec:a,channels:l},c,On))return u}for(let u=0;u<t.length;u++){const c=t[u];if(ki(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(ki(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${i}`),this.clearTimer(),this.hls.trigger(v.AUDIO_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}}const Wd=500;class KE extends $u{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",X.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.ERROR,this.onError,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.ERROR,this.onError,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=b.IDLE,this.setInterval(Wd),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:i}=t;if(this.fragPrevious=r,this.state=b.IDLE,!i)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let o;const a=r.start;for(let u=0;u<s.length;u++)if(a>=s[u].start&&a<=s[u].end){o=s[u];break}const l=r.start+r.duration;o?o.end=l:(o={start:a,end:l},s.push(o)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){const{startOffset:r,endOffset:i}=t;if(r===0&&i!==Number.POSITIVE_INFINITY){const s=i-1;if(s<=0)return;t.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(o=>{for(let a=0;a<o.length;){if(o[a].end<=s){o.shift();continue}else if(o[a].start<s)o[a].start=s;else break;a++}}),this.fragmentTracker.removeFragmentsInRange(r,s,X.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===X.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){const r=t.frag;r?.type===X.SUBTITLE&&(t.details===k.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==b.STOPPED&&(this.state=b.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Tm(this.levels,t)){this.levels=t.map(r=>new br(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{const i=new br(r);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,X.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(Wd)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:i,levels:s}=this,{details:o,id:a}=t;if(!s){this.warn(`Subtitle tracks were reset while loading level ${a}`);return}const l=s[a];if(a>=s.length||!l)return;this.log(`Subtitle track ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(o.live||(r=l.details)!=null&&r.live){const d=this.mainDetails;if(o.deltaUpdateFailed||!d)return;const f=d.fragments[0];if(!l.details)o.hasProgramDateTime&&d.hasProgramDateTime?(co(o,d),u=o.fragments[0].start):f&&(u=f.start,Cl(o,u));else{var c;u=this.alignPlaylists(o,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,Cl(o,u))}}l.details=o,this.levelLastLoaded=l,a===i&&(!this.startFragRequested&&(this.mainDetails||!o.live)&&this.setStartPosition(this.mainDetails||o,u),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===b.IDLE&&(uo(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,i=t.decryptdata,s=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&i!=null&&i.key&&i.iv&&i.method==="AES-128"){const o=performance.now();this.decrypter.decrypt(new Uint8Array(r),i.key.buffer,i.iv.buffer).catch(a=>{throw s.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:a,reason:a.message,frag:t}),a}).then(a=>{const l=performance.now();s.trigger(v.FRAG_DECRYPTED,{frag:t,payload:a,stats:{tstart:o,tdecrypt:l}})}).catch(a=>{this.warn(`${a.name}: ${a.message}`),this.state=b.IDLE})}}doTick(){if(!this.media){this.state=b.IDLE;return}if(this.state===b.IDLE){const{currentTrackId:e,levels:t}=this,r=t?.[e];if(!r||!t.length||!r.details)return;const{config:i}=this,s=this.getLoadPosition(),o=fe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,i.maxBufferHole),{end:a,len:l}=o,u=this.getFwdBufferInfo(this.media,X.MAIN),c=r.details,d=this.getMaxBufferLength(u?.len)+c.levelTargetDuration;if(l>d)return;const f=c.fragments,m=f.length,h=c.edge;let g=null;const y=this.fragPrevious;if(a<h){const p=i.maxFragLookUpTolerance,x=a>h-p?0:p;g=uo(y,f,Math.max(f[0].start,a),x),!g&&y&&y.start<f[0].start&&(g=f[0])}else g=f[m-1];if(!g)return;if(g=this.mapToInitFragWhenRequired(g),g.sn!=="initSegment"){const p=g.sn-c.startSN,x=f[p-1];x&&x.cc===g.cc&&this.fragmentTracker.getState(x)===Fe.NOT_LOADED&&(g=x)}this.fragmentTracker.getState(g)===Fe.NOT_LOADED&&this.loadFragment(g,r,a)}}getMaxBufferLength(e){const t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new jE(this.tracksBuffered[this.currentTrackId]||[])}}class jE{constructor(e){this.buffered=void 0;const t=(r,i,s)=>{if(i=i>>>0,i>s-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${s})`);return e[i][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}}class zE extends Mu{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const r=As(this.media.textTracks);for(let s=0;s<r.length;s++)if(r[s].mode==="hidden")t=r[s];else if(r[s].mode==="showing"){t=r[s];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADING,this.onLevelLoading,this),e.off(v.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(v.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(v.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),As(this.media.textTracks).forEach(t=>{gr(t)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:i,details:s}=t,o=this.tracksInGroup[r];if(!o||o.groupId!==i){this.warn(`Subtitle track with id:${r} and group:${i} not found in active group ${o?.groupId}`);return}const a=o.details;o.details=t.details,this.log(`Subtitle track ${r} "${o.name}" lang:${o.lang} group:${i} loaded [${s.startSN}-${s.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,a)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,i=this.groupIds;let s=this.currentTrack;if(!r||i?.length!==r?.length||r!=null&&r.some(o=>i?.indexOf(o)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(c=>!r||r.indexOf(c.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(c=>c.default)&&(this.selectDefaultTrack=!1),o.forEach((c,d)=>{c.id=d});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const a=this.hls.config.subtitlePreference;if(!s&&a){this.selectDefaultTrack=!1;const c=Vt(a,o);if(c>-1)s=o[c];else{const d=Vt(a,this.tracks);s=this.tracks[d]}}let l=this.findTrackId(s);l===-1&&s&&(l=this.findTrackId(null));const u={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${r?.join(",")}" group-id`),this.hls.trigger(v.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const s=t[i];if(!(r&&!s.default||!r&&!e)&&(!e||Hn(s,e)))return i}if(e){for(let i=0;i<t.length;i++){const s=t[i];if(ki(e.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const s=t[i];if(ki(e.attrs,s.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const i=t[r];if(_l(i,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ie.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Hn(e,r))return r;const i=Vt(e,this.tracksInGroup);if(i>-1){const s=this.tracksInGroup[i];return this.setSubtitleTrack(i),s}else{if(r)return null;{const s=Vt(e,t);if(s>-1)return t[s]}}}}return null}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){const r=t.id,i=t.groupId;let s=t.url;if(e)try{s=e.addDirectives(s)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(v.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:i,deliveryDirectives:e||null})}}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=As(e.textTracks),r=this.currentTrack;let i;if(r&&(i=t.filter(s=>_l(r,s))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(s=>{s.mode!=="disabled"&&s!==i&&(s.mode="disabled")}),i){const s=this.subtitleDisplay?"showing":"hidden";i.mode!==s&&(i.mode=s)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!$(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const r=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:e});return}const s=!!i.details&&!i.details.live;if(e===this.trackId&&i===r&&s)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:o,groupId:a="",name:l,type:u,url:c}=i;this.hls.trigger(v.SUBTITLE_TRACK_SWITCH,{id:o,groupId:a,name:l,type:u,url:c});const d=this.switchParams(i.url,r?.details,i.details);this.loadPlaylist(d)}}class WE{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){const i=this.queues[t];i.push(e),i.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t;const r=new Promise(s=>{t=s}),i={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(i,e),r}executeNext(e){const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(i){R.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${i}`),r.onError(i);const s=this.buffers[e];s!=null&&s.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}}const Yd=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class YE{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:r,mediaSource:i}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(v.MEDIA_ATTACHED,{media:r,mediaSource:i})),i&&i.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:r,_objectUrl:i}=this;r!==i&&R.error(`Media element src was set while attaching MediaSource (${i} > ${r})`)},this.hls=e;const t="[buffer-controller]";this.appendSource=rx(qn(e.config.preferManagedMediaSource)),this.log=R.log.bind(R,t),this.warn=R.warn.bind(R,t),this.error=R.error.bind(R,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.BUFFER_RESET,this.onBufferReset,this),e.on(v.BUFFER_APPENDING,this.onBufferAppending,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.BUFFER_EOS,this.onBufferEos,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(v.FRAG_PARSED,this.onFragParsed,this),e.on(v.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.BUFFER_RESET,this.onBufferReset,this),e.off(v.BUFFER_APPENDING,this.onBufferAppending,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.BUFFER_EOS,this.onBufferEos,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(v.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(v.FRAG_PARSED,this.onFragParsed,this),e.off(v.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new WE(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){const r=this.media=t.media,i=qn(this.appendSource);if(r&&i){var s;const o=this.mediaSource=new i;this.log(`created media source: ${(s=o.constructor)==null?void 0:s.name}`),o.addEventListener("sourceopen",this._onMediaSourceOpen),o.addEventListener("sourceended",this._onMediaSourceEnded),o.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(o.addEventListener("startstreaming",this._onStartStreaming),o.addEventListener("endstreaming",this._onEndStreaming));const a=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{r.removeAttribute("src");const l=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||l&&o instanceof l,qd(r),qE(r,a),r.load()}catch{r.src=a}else r.src=a;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){this.warn(`onMediaDetaching: ${i.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&qd(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(v.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer(),this.hls.resumeBuffering()}resetBuffer(e){const t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(i){this.warn(`onBufferReset ${e}`,i)}}onBufferCodecs(e,t){const r=this.getSourceBufferTypes().length,i=Object.keys(t);if(i.forEach(o=>{if(r){const l=this.tracks[o];if(l&&typeof l.buffer.changeType=="function"){var a;const{id:u,codec:c,levelCodec:d,container:f,metadata:m}=t[o],h=pd(l.codec,l.levelCodec),g=h?.replace(Yd,"$1");let y=pd(c,d);const p=(a=y)==null?void 0:a.replace(Yd,"$1");if(y&&g!==p){o.slice(0,5)==="audio"&&(y=so(y,this.appendSource));const x=`${f};codecs=${y}`;this.appendChangeType(o,x),this.log(`switching codec ${h} to ${y}`),this.tracks[o]={buffer:l.buffer,codec:c,container:f,levelCodec:d,metadata:m,id:u}}}}else this.pendingTracks[o]=t[o]}),r)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${i.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){const{operationQueue:r}=this,i={execute:()=>{const s=this.sourceBuffer[e];s&&(this.log(`changing ${e} sourceBuffer type to ${t}`),s.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${e} SourceBuffer type`,s)}};r.append(i,e,!!this.pendingTracks[e])}onBufferAppending(e,t){const{hls:r,operationQueue:i,tracks:s}=this,{data:o,type:a,frag:l,part:u,chunkMeta:c}=t,d=c.buffering[a],f=self.performance.now();d.start=f;const m=l.stats.buffering,h=u?u.stats.buffering:null;m.start===0&&(m.start=f),h&&h.start===0&&(h.start=f);const g=s.audio;let y=!1;a==="audio"&&g?.container==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const p=l.start,x={execute:()=>{if(d.executeStart=self.performance.now(),y){const E=this.sourceBuffer[a];if(E){const T=p-E.timestampOffset;Math.abs(T)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${p} (delta: ${T}) sn: ${l.sn})`),E.timestampOffset=p)}}this.appendExecutor(o,a)},onStart:()=>{},onComplete:()=>{const E=self.performance.now();d.executeEnd=d.end=E,m.first===0&&(m.first=E),h&&h.first===0&&(h.first=E);const{sourceBuffer:T}=this,S={};for(const A in T)S[A]=fe.getBuffered(T[A]);this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(v.BUFFER_APPENDED,{type:a,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:S})},onError:E=>{const T={type:J.MEDIA_ERROR,parent:l.type,details:k.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:l,part:u,chunkMeta:c,error:E,err:E,fatal:!1};if(E.code===DOMException.QUOTA_EXCEEDED_ERR)T.details=k.BUFFER_FULL_ERROR;else{const S=++this.appendErrors[a];T.details=k.BUFFER_APPEND_ERROR,this.warn(`Failed ${S}/${r.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer`),S>=r.config.appendErrorMaxRetry&&(T.fatal=!0)}r.trigger(v.ERROR,T)}};i.append(x,a,!!this.pendingTracks[a])}onBufferFlushing(e,t){const{operationQueue:r}=this,i=s=>({execute:this.removeExecutor.bind(this,s,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(v.BUFFER_FLUSHED,{type:s})},onError:o=>{this.warn(`Failed to remove from ${s} SourceBuffer`,o)}});t.type?r.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(s=>{r.append(i(s),s)})}onFragParsed(e,t){const{frag:r,part:i}=t,s=[],o=i?i.elementaryStreams:r.elementaryStreams;o[le.AUDIOVIDEO]?s.push("audiovideo"):(o[le.AUDIO]&&s.push("audio"),o[le.VIDEO]&&s.push("video"));const a=()=>{const l=self.performance.now();r.stats.buffering.end=l,i&&(i.stats.buffering.end=l);const u=i?i.stats:r.stats;this.hls.trigger(v.FRAG_BUFFERED,{frag:r,part:i,stats:u,id:r.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(a,s)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((i,s)=>{const o=this.sourceBuffer[s];return o&&(!t.type||t.type===s)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${s} sourceBuffer now EOS`))),i&&!!(!o||o.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const o=this.sourceBuffer[s];o&&(o.ending=!1)});const{mediaSource:i}=this;if(!i||i.readyState!=="open"){i&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${i.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),i.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;const s=e.config,o=r.currentTime,a=t.levelTargetDuration,l=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if($(l)&&l>0){const u=Math.max(l,a),c=Math.floor(o/a)*a-u;this.flushBackBuffer(o,a,c)}if($(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const u=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),c=Math.max(u,a),d=Math.floor(o/a)*a+c;this.flushFrontBuffer(o,a,d)}}flushBackBuffer(e,t,r){const{details:i,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(a=>{const l=s[a];if(l){const u=fe.getBuffered(l);if(u.length>0&&r>u.start(0)){if(this.hls.trigger(v.BACK_BUFFER_REACHED,{bufferEnd:r}),i!=null&&i.live)this.hls.trigger(v.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(l.ended&&u.end(u.length-1)-e<t*2){this.log(`Cannot flush ${a} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:a})}}})}flushFrontBuffer(e,t,r){const{sourceBuffer:i}=this;this.getSourceBufferTypes().forEach(o=>{const a=i[o];if(a){const l=fe.getBuffered(a),u=l.length;if(u<2)return;const c=l.start(u-1),d=l.end(u-1);if(r>c||e>=c&&e<=d)return;if(a.ended&&e-d<2*t){this.log(`Cannot flush ${o} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(v.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:o})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:e,hls:t,media:r,mediaSource:i}=this,s=e.fragments[0].start+e.totalduration,o=r.duration,a=$(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(i.duration=1/0,this.updateSeekableRange(e)):(s>a&&s>o||!$(o))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),i.duration=s)}updateSeekableRange(e){const t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){const s=Math.max(0,r[0].start),o=Math.max(s,s+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${s}-${o}.`),t.setLiveSeekableRange(s,o)}}checkPendingTracks(){const{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,i=Object.keys(r).length;if(i&&(!e||i===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(v.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(o=>{t.executeNext(o)});else{const o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}}createSourceBuffers(e){const{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(const s in e)if(!t[s]){var i;const o=e[s];if(!o)throw Error(`source buffer exists for track ${s}, however track does not`);let a=((i=o.levelCodec)==null?void 0:i.indexOf(","))===-1?o.levelCodec:o.codec;a&&s.slice(0,5)==="audio"&&(a=so(a,this.appendSource));const l=`${o.container};codecs=${a}`;this.log(`creating sourceBuffer(${l})`);try{const u=t[s]=r.addSourceBuffer(l),c=s;this.addBufferListener(c,"updatestart",this._onSBUpdateStart),this.addBufferListener(c,"updateend",this._onSBUpdateEnd),this.addBufferListener(c,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(c,"bufferedchange",(d,f)=>{const m=f.removedRanges;m!=null&&m.length&&this.hls.trigger(v.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:u,codec:a,container:o.container,levelCodec:o.levelCodec,metadata:o.metadata,id:o.id}}catch(u){this.error(`error while trying to add sourceBuffer: ${u.message}`),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:s,mimeType:l})}}}get mediaSrc(){var e,t;const r=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return r?.src}_onSBUpdateStart(e){const{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${i}`,t),this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const s=this.operationQueue.current(e);s&&s.onError(i)}removeExecutor(e,t,r){const{media:i,mediaSource:s,operationQueue:o,sourceBuffer:a}=this,l=a[e];if(!i||!s||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),o.shiftAndExecuteNext(e);return}const u=$(i.duration)?i.duration:1/0,c=$(s.duration)?s.duration:1/0,d=Math.max(0,t),f=Math.min(r,u,c);f>d&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${d},${f}] from the ${e} SourceBuffer`),l.remove(d,f)):o.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}const{operationQueue:r}=this,i=t.map(s=>r.appendBlocker(s));Promise.all(i).then(()=>{e(),t.forEach(s=>{const o=this.sourceBuffer[s];o!=null&&o.updating||r.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){const i=this.sourceBuffer[e];if(!i)return;const s=r.bind(this,e);this.listeners[e].push({event:t,listener:s}),i.addEventListener(t,s)}removeBufferListeners(e){const t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}}function qd(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function qE(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}const XE={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Lm=n=>String.fromCharCode(XE[n]||n),Rt=15,Yt=100,QE={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},JE={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ZE={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},eS={25:2,26:4,29:6,30:8,31:10,27:13,28:15},tS=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class nS{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r=typeof t=="function"?t():t;R.log(`${this.time} [${e}] ${r}`)}}}const _n=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class Am{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class rS{constructor(){this.uchar=" ",this.penState=new Am}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class iS{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Am,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Yt;t++)this.chars.push(new rS);this.logger=e}equals(e){for(let t=0;t<Yt;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Yt;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Yt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Yt&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Yt)}moveCursor(e){const t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Lm(e);if(this.pos>=Yt){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Yt;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<Yt;r++){const i=this.chars[r].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ta{constructor(e){this.rows=[],this.currRow=Rt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Rt;t++)this.rows.push(new iS(e));this.logger=e}reset(){for(let e=0;e<Rt;e++)this.rows[e].clear();this.currRow=Rt-1}equals(e){let t=!0;for(let r=0;r<Rt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<Rt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Rt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let a=0;a<Rt;a++)this.rows[a].clear();const s=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const a=o.rows[s].cueStartTime,l=this.logger.time;if(a!==null&&l!==null&&a<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(o.rows[s+u])}}this.currRow=t;const r=this.rows[this.currRow];if(e.indent!==null){const s=e.indent,o=Math.max(s-1,0);r.setCursor(e.indent),e.color=r.chars[o].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",i=-1;for(let s=0;s<Rt;s++){const o=this.rows[s].getTextString();o&&(i=s+1,e?t.push("Row "+i+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}}class Xd{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ta(r),this.nonDisplayedMemory=new Ta(r),this.lastOutputScreen=new Ta(r),this.currRollUpRow=this.displayedMemory.rows[Rt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Rt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qd{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=oS(),this.logger=void 0;const i=this.logger=new nS;this.channels=[null,new Xd(e,t,i),new Xd(e+1,r,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let r=0;r<t.length;r+=2){const i=t[r]&127,s=t[r+1]&127;let o=!1,a=null;if(i===0&&s===0)continue;this.logger.log(3,()=>"["+_n([t[r],t[r+1]])+"] -> ("+_n([i,s])+")");const l=this.cmdHistory;if(i>=16&&i<=31){if(sS(i,s,l)){as(null,null,l),this.logger.log(3,()=>"Repeated command ("+_n([i,s])+") is dropped");continue}as(i,s,this.cmdHistory),o=this.parseCmd(i,s),o||(o=this.parseMidrow(i,s)),o||(o=this.parsePAC(i,s)),o||(o=this.parseBackgroundAttributes(i,s))}else as(null,null,l);if(!o&&(a=this.parseChars(i,s),a)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(a):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!a&&this.logger.log(2,()=>"Couldn't parse cleaned data "+_n([i,s])+" orig: "+_n([t[r],t[r+1]]))}}parseCmd(e,t){const r=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(r||i))return!1;const s=e===20||e===21||e===23?1:2,o=this.channels[s];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=s,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[r];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+_n([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,s=(e===16||e===24)&&t>=64&&t<=95;if(!(i||s))return!1;const o=e<=23?1:2;t>=64&&t<=95?r=o===1?QE[e]:ZE[e]:r=o===1?JE[e]:eS[e];const a=this.channels[o];return a?(a.setPAC(this.interpretPAC(r,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let r;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,i.underline=(r&1)===1,r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((r-16)/2)*4,i}parseChars(e,t){let r,i=null,s=null;if(e>=25?(r=2,s=e-8):(r=1,s=e),s>=17&&s<=19){let o;s===17?o=t+80:s===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+Lm(o)+"' in channel "+r),i=[o]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+_n(i).join(",")),i}parseBackgroundAttributes(e,t){const r=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(r||i))return!1;let s;const o={};e===16||e===24?(s=Math.floor((t-32)/2),o.background=tS[s],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const a=e<=23?1:2;return this.channels[a].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}as(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function as(n,e,t){t.a=n,t.b=e}function sS(n,e,t){return t.a===n&&t.b===e}function oS(){return{a:null,b:null}}class ls{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var zu=function(){if(_r!=null&&_r.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(a,l){if(typeof l!="string"||!Array.isArray(a))return!1;const u=l.toLowerCase();return~a.indexOf(u)?u:!1}function r(a){return t(n,a)}function i(a){return t(e,a)}function s(a,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)a[d]=c[d]}return a}function o(a,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",m=!1,h=a,g=l,y=u,p=null,x="",E=!0,T="auto",S="start",A=50,L="middle",C=50,N="middle";Object.defineProperty(c,"id",s({},d,{get:function(){return f},set:function(w){f=""+w}})),Object.defineProperty(c,"pauseOnExit",s({},d,{get:function(){return m},set:function(w){m=!!w}})),Object.defineProperty(c,"startTime",s({},d,{get:function(){return h},set:function(w){if(typeof w!="number")throw new TypeError("Start time must be set to a number.");h=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",s({},d,{get:function(){return g},set:function(w){if(typeof w!="number")throw new TypeError("End time must be set to a number.");g=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",s({},d,{get:function(){return y},set:function(w){y=""+w,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",s({},d,{get:function(){return p},set:function(w){p=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",s({},d,{get:function(){return x},set:function(w){const F=r(w);if(F===!1)throw new SyntaxError("An invalid or illegal string was specified.");x=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",s({},d,{get:function(){return E},set:function(w){E=!!w,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",s({},d,{get:function(){return T},set:function(w){if(typeof w!="number"&&w!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",s({},d,{get:function(){return S},set:function(w){const F=i(w);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");S=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",s({},d,{get:function(){return A},set:function(w){if(w<0||w>100)throw new Error("Position must be between 0 and 100.");A=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",s({},d,{get:function(){return L},set:function(w){const F=i(w);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");L=F,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",s({},d,{get:function(){return C},set:function(w){if(w<0||w>100)throw new Error("Size must be between 0 and 100.");C=w,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",s({},d,{get:function(){return N},set:function(w){const F=i(w);if(!F)throw new SyntaxError("An invalid or illegal string was specified.");N=F,this.hasBeenReset=!0}})),c.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class aS{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Rm(n){function e(r,i,s,o){return(r|0)*3600+(i|0)*60+(s|0)+parseFloat(o||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class lS{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Im(n,e,t,r){const i=r?n.split(r):[n];for(const s in i){if(typeof i[s]!="string")continue;const o=i[s].split(t);if(o.length!==2)continue;const a=o[0],l=o[1];e(a,l)}}const bl=new zu(0,0,""),us=bl.align==="middle"?"middle":"center";function uS(n,e,t){const r=n;function i(){const a=Rm(n);if(a===null)throw new Error("Malformed timestamp: "+r);return n=n.replace(/^[^\sa-zA-Z-]+/,""),a}function s(a,l){const u=new lS;Im(a,function(f,m){let h;switch(f){case"region":for(let g=t.length-1;g>=0;g--)if(t[g].id===m){u.set(f,t[g].region);break}break;case"vertical":u.alt(f,m,["rl","lr"]);break;case"line":h=m.split(","),u.integer(f,h[0]),u.percent(f,h[0])&&u.set("snapToLines",!1),u.alt(f,h[0],["auto"]),h.length===2&&u.alt("lineAlign",h[1],["start",us,"end"]);break;case"position":h=m.split(","),u.percent(f,h[0]),h.length===2&&u.alt("positionAlign",h[1],["start",us,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,m);break;case"align":u.alt(f,m,["start",us,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&bl.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",us);let d=u.get("position","auto");d==="auto"&&bl.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function o(){n=n.replace(/^\s+/,"")}if(o(),e.startTime=i(),o(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+r);n=n.slice(3),o(),e.endTime=i(),o(),s(n,e)}function wm(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class cS{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new aS,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let s=t.buffer,o=0;for(s=wm(s);o<s.length&&s[o]!=="\r"&&s[o]!==`
`;)++o;const a=s.slice(0,o);return s[o]==="\r"&&++o,s[o]===`
`&&++o,t.buffer=s.slice(o),a}function i(s){Im(s,function(o,a){},/:/)}try{let s="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;s=r();const a=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(a!=null&&a[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:s=r(),t.state){case"HEADER":/:/.test(s)?i(s):s||(t.state="ID");continue;case"NOTE":s||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){t.state="NOTE";break}if(!s)continue;if(t.cue=new zu(0,0,""),t.state="CUE",s.indexOf("-->")===-1){t.cue.id=s;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{uS(s,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const a=s.indexOf("-->")!==-1;if(!s||a&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=s}continue;case"BADCUE":s||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const dS=/\r\n|\n\r|\n|\r/g,La=function(e,t,r=0){return e.slice(r,r+t.length)===t},fS=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),s=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!$(t)||!$(r)||!$(i)||!$(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*i,t+=60*60*1e3*s,t},Aa=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function Wu(n,e,t){return Aa(n.toString())+Aa(e.toString())+Aa(t)}const hS=function(e,t,r){let i=e[t],s=e[i.prevCC];if(!s||!s.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(o=s)!=null&&o.new;){var o;e.ccOffset+=i.start-s.start,i.new=!1,i=s,s=e[i.prevCC]}e.presentationOffset=r};function mS(n,e,t,r,i,s,o){const a=new cS,l=jt(new Uint8Array(n)).trim().replace(dS,`
`).split(`
`),u=[],c=e?_E(e.baseTime,e.timescale):0;let d="00:00.000",f=0,m=0,h,g=!0;a.oncue=function(y){const p=t[r];let x=t.ccOffset;const E=(f-c)/9e4;if(p!=null&&p.new&&(m!==void 0?x=t.ccOffset=p.start:hS(t,r,E)),E){if(!e){h=new Error("Missing initPTS for VTT MPEGTS");return}x=E-t.presentationOffset}const T=y.endTime-y.startTime,S=mt((y.startTime+x-m)*9e4,i*9e4)/9e4;y.startTime=Math.max(S,0),y.endTime=Math.max(S+T,0);const A=y.text.trim();y.text=decodeURIComponent(encodeURIComponent(A)),y.id||(y.id=Wu(y.startTime,y.endTime,A)),y.endTime>0&&u.push(y)},a.onparsingerror=function(y){h=y},a.onflush=function(){if(h){o(h);return}s(u)},l.forEach(y=>{if(g)if(La(y,"X-TIMESTAMP-MAP=")){g=!1,y.slice(16).split(",").forEach(p=>{La(p,"LOCAL:")?d=p.slice(6):La(p,"MPEGTS:")&&(f=parseInt(p.slice(7)))});try{m=fS(d)/1e3}catch(p){h=p}return}else y===""&&(g=!1);a.parse(y+`
`)}),a.flush()}const Ra="stpp.ttml.im1t",Cm=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,km=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,gS={left:"start",center:"center",right:"end",start:"start",end:"end"};function Jd(n,e,t,r){const i=Z(new Uint8Array(n),["mdat"]);if(i.length===0){r(new Error("Could not parse IMSC1 mdat"));return}const s=i.map(a=>jt(a)),o=DE(e.baseTime,1,e.timescale);try{s.forEach(a=>t(pS(a,o)))}catch(a){r(a)}}function pS(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(s).reduce((d,f)=>(d[f]=i.getAttribute(`ttp:${f}`)||s[f],d),{}),a=i.getAttribute("xml:space")!=="preserve",l=Zd(Ia(i,"styling","style")),u=Zd(Ia(i,"layout","region")),c=Ia(i,"body","[begin]");return[].map.call(c,d=>{const f=Dm(d,a);if(!f||!d.hasAttribute("begin"))return null;const m=Ca(d.getAttribute("begin"),o),h=Ca(d.getAttribute("dur"),o);let g=Ca(d.getAttribute("end"),o);if(m===null)throw ef(d);if(g===null){if(h===null)throw ef(d);g=m+h}const y=new zu(m-e,g-e,f);y.id=Wu(y.startTime,y.endTime,y.text);const p=u[d.getAttribute("region")],x=l[d.getAttribute("style")],E=yS(p,x,l),{textAlign:T}=E;if(T){const S=gS[T];S&&(y.lineAlign=S),y.align=T}return we(y,E),y}).filter(d=>d!==null)}function Ia(n,e,t){const r=n.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(t)):[]}function Zd(n){return n.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function Dm(n,e){return[].slice.call(n.childNodes).reduce((t,r,i)=>{var s;return r.nodeName==="br"&&i?t+`
`:(s=r.childNodes)!=null&&s.length?Dm(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent},"")}function yS(n,e,t){const r="http://www.w3.org/ns/ttml#styling";let i=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(i=t[o]),s.reduce((a,l)=>{const u=wa(e,r,l)||wa(n,r,l)||wa(i,r,l);return u&&(a[l]=u),a},{})}function wa(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function ef(n){return new Error(`Could not parse ttml timestamp ${n}`)}function Ca(n,e){if(!n)return null;let t=Rm(n);return t===null&&(Cm.test(n)?t=vS(n,e):km.test(n)&&(t=xS(n,e))),t}function vS(n,e){const t=Cm.exec(n),r=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+r/e.frameRate}function xS(n,e){const t=km.exec(n),r=Number(t[1]);switch(t[2]){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}class ES{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nf(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(v.FRAG_LOADING,this.onFragLoading,this),e.on(v.FRAG_LOADED,this.onFragLoaded,this),e.on(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(v.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(v.FRAG_LOADING,this.onFragLoading,this),e.off(v.FRAG_LOADED,this.onFragLoaded,this),e.off(v.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(v.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(v.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(v.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(v.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const e=new ls(this,"textTrack1"),t=new ls(this,"textTrack2"),r=new ls(this,"textTrack3"),i=new ls(this,"textTrack4");this.cea608Parser1=new Qd(1,e,t),this.cea608Parser2=new Qd(3,r,i)}}addCues(e,t,r,i,s){let o=!1;for(let a=s.length;a--;){const l=s[a],u=SS(l[0],l[1],t,r);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],r),o=!0,u/(r-t)>.5))return}if(o||s.push([t,r]),this.config.renderTextTracksNatively){const a=this.captionsTracks[e];this.Cues.newCue(a,t,r,i)}else{const a=this.Cues.newCue(null,t,r,i);this.hls.trigger(v.CUES_PARSED,{type:"captions",cues:a,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:i,timescale:s}){const{unparsedVttFrags:o}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:i,timescale:s}),o.length&&(this.unparsedVttFrags=[],o.forEach(a=>{this.onFragLoaded(v.FRAG_LOADED,a)}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let i=0;i<r.textTracks.length;i++){const s=r.textTracks[i];if(tf(s,{name:e,lang:t,attrs:{}}))return s}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:i}=this,{label:s,languageCode:o}=t[e],a=this.getExistingTrack(s,o);if(a)r[e]=a,gr(r[e]),X0(r[e],i);else{const l=this.createTextTrack("captions",s,o);l&&(l[e]=!0,r[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r=t.label,i={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,r){const i=this.media;if(i)return i.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:e}=this;Object.keys(e).forEach(t=>{gr(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=nf(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let r=0;r<t.length;r++)gr(t[r])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],i=r.some(s=>s.textCodec===Ra);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Tm(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const o=this.media,a=o?As(o.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(a){let d=null;for(let f=0;f<a.length;f++)if(a[f]&&tf(a[f],l)){d=a[f],a[f]=null;break}d&&(c=d)}if(c)gr(c);else{const d=_m(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),a!=null&&a.length){const l=a.filter(u=>u!==null).map(u=>u.label);l.length&&R.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(a=>({label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}));this.hls.trigger(v.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{const i=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!i)return;const s=`textTrack${i[1]}`,o=this.captionsProperties[s];o&&(o.label=r.name,r.lang&&(o.languageCode=r.lang),o.media=r)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===X.MAIN){var r,i;const{cea608Parser1:s,cea608Parser2:o,lastSn:a}=this,{cc:l,sn:u}=t.frag,c=(r=(i=t.part)==null?void 0:i.index)!=null?r:-1;s&&o&&(u!==a+1||u===a&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(s.reset(),o.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:r,payload:i}=t;if(r.type===X.SUBTITLE)if(i.byteLength){const s=r.decryptdata,o="stats"in t;if(s==null||!s.encrypted||o){const a=this.tracks[r.level],l=this.vttCCs;l[r.cc]||(l[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),a&&a.textCodec===Ra?this._parseIMSC1(r,i):this._parseVTTs(t)}}else this.hls.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;Jd(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),r.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{R.log(`Failed to parse IMSC1: ${i}`),r.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:r,payload:i}=e,{initPTS:s,unparsedVttFrags:o}=this,a=s.length-1;if(!s[r.cc]&&a===-1){o.push(e);return}const l=this.hls,u=(t=r.initSegment)!=null&&t.data?St(r.initSegment.data,new Uint8Array(i)):i;mS(u,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,c=>{this._appendCues(c,r.level),l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?o.push(e):this._fallbackToIMSC1(r,i),R.log(`Failed to parse VTT cue: ${c}`),!(d&&a>r.cc)&&l.trigger(v.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:c})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||Jd(t,this.initPTS[e.cc],()=>{r.textCodec=Ra,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(s=>Q0(i,s))}else{const i=this.tracks[t];if(!i)return;const s=i.default?"default":"subtitles"+t;r.trigger(v.CUES_PARSED,{type:"subtitles",cues:e,track:s})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===X.SUBTITLE&&this.onFragLoaded(v.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();const{cea608Parser1:r,cea608Parser2:i}=this;if(!this.enabled||!r||!i)return;const{frag:s,samples:o}=t;if(!(s.type===X.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<o.length;a++){const l=o[a].bytes;if(l){const u=this.extractCea608Data(l);r.addData(o[a].pts,u[0]),i.addData(o[a].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:i,type:s}){const{media:o}=this;if(!(!o||o.currentTime<r)){if(!s||s==="video"){const{captionsTracks:a}=this;Object.keys(a).forEach(l=>Rl(a[l],t,r))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:a}=this;Object.keys(a).forEach(l=>Rl(a[l],t,i))}}}extractCea608Data(e){const t=[[],[]],r=e[0]&31;let i=2;for(let s=0;s<r;s++){const o=e[i++],a=127&e[i++],l=127&e[i++];if(a===0&&l===0)continue;if((4&o)!==0){const c=3&o;(c===0||c===1)&&(t[c].push(a),t[c].push(l))}}return t}}function _m(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function tf(n,e){return!!n&&n.kind===_m(e)&&_l(e,n)}function SS(n,e,t,r){return Math.min(e,r)-Math.max(n,t)}function nf(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class Yu{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.BUFFER_CODECS,this.onBufferCodecs,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(v.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.BUFFER_CODECS,this.onBufferCodecs,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&$(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&R.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((i,s)=>this.isLevelAllowed(i)&&s<=e);return this.clientRect=null,Yu.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,!t.width&&!t.height&&(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}isLevelAllowed(e){return!this.restrictedLevels.some(r=>e.bitrate===r.bitrate&&e.width===r.width&&e.height===r.height)}static getMaxLevelByMediaSize(e,t,r){if(!(e!=null&&e.length))return-1;const i=(a,l)=>l?a.width!==l.width||a.height!==l.height:!0;let s=e.length-1;const o=Math.max(t,r);for(let a=0;a<e.length;a+=1){const l=e[a];if((l.width>=o||l.height>=o)&&i(l,e[a+1])){s=a;break}}return s}}class TS{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(v.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){const i=performance.now();if(t){if(this.lastTime){const s=i-this.lastTime,o=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,l=1e3*o/s,u=this.hls;if(u.trigger(v.FPS_DROP,{currentDropped:o,currentDecoded:a,totalDroppedFrames:r}),l>0&&o>u.config.fpsDroppedMonitoringThreshold*a){let c=u.currentLevel;R.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(v.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}const cs="[eme]";class Tr{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=Tr.CDMCleanupPromise?[Tr.CDMCleanupPromise]:[],this.debug=R.debug.bind(R,cs),this.log=R.log.bind(R,cs),this.warn=R.warn.bind(R,cs),this.error=R.error.bind(R,cs),this.onMediaEncrypted=t=>{const{initDataType:r,initData:i}=t,s=`"${t.type}" event: init data type: "${r}"`;if(this.debug(s),i!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=es(this.config));const a=o.map(ca).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(a)}this.keyFormatPromise.then(o=>{const a=la(o);let l,u;if(r==="sinf"){if(a!==ae.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const h=Ce(new Uint8Array(i));try{const g=Pu(JSON.parse(h).sinf),y=j0(g);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=y.subarray(8,24),u=ae.FAIRPLAY}catch(g){this.warn(`${s} Failed to parse sinf: ${g}`);return}}else{if(a!==ae.WIDEVINE&&a!==ae.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${r}" for selected key-system ${a}`);return}const h=Zv(i),g=h.filter(p=>!!p.systemId&&ua(p.systemId)===a);g.length>1&&this.warn(`${s} Using first of ${g.length} pssh found for selected key-system ${a}`);const y=g[0];if(!y){h.length===0||h.some(p=>!p.systemId)?this.warn(`${s} contains incomplete or invalid pssh data`):this.log(`ignoring ${s} for ${h.map(p=>ua(p.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(u=ua(y.systemId),y.version===0&&y.data)if(u===ae.WIDEVINE){const p=y.data.length-22;l=y.data.subarray(p,p+16)}else u===ae.PLAYREADY&&(l=M0(y.data))}if(!u||!l){this.log(`Unable to handle ${s} with key-system ${a}`);return}const c=Ut.hexDump(l),{keyIdToKeySessionPromise:d,mediaKeySessions:f}=this;let m=d[c];for(let h=0;h<f.length;h++){const g=f[h],y=g.decryptdata;if(!y.keyId)continue;const p=Ut.hexDump(y.keyId);if(c===p||y.uri.replace(/-/g,"").indexOf(c)!==-1){if(m=d[p],y.pssh)break;delete d[p],y.pssh=new Uint8Array(i),y.keyId=l,m=d[c]=m.then(()=>this.generateRequestWithPreferredKeySession(g,r,i,"encrypted-event-key-match")),m.catch(x=>this.handleError(x));break}}if(!m){if(u!==a){this.log(`Ignoring "${s}" with ${u} init data for selected key-system ${a}`);return}m=d[c]=this.getKeySystemSelectionPromise([u]).then(({keySystem:h,mediaKeys:g})=>{var y;this.throwIfDestroyed();const p=new wi("ISO-23001-7",c,(y=ca(h))!=null?y:"");return p.pssh=new Uint8Array(i),p.keyId=l,this.attemptSetMediaKeys(h,g).then(()=>{this.throwIfDestroyed();const x=this.createMediaKeySessionContext({decryptdata:p,keySystem:h,mediaKeys:g});return this.generateRequestWithPreferredKeySession(x,r,i,"encrypted-event-no-match")})}),m.catch(h=>this.handleError(h))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(v.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(v.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(v.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(v.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,i=t[e];if(i)return i.licenseUrl;if(e===ae.WIDEVINE&&r)return r}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(o,a,l)=>!!o&&l.indexOf(o)===a,i=t.map(o=>o.audioCodec).filter(r),s=t.map(o=>o.videoCodec).filter(r);return i.length+s.length===0&&s.push("avc1.42e01e"),new Promise((o,a)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,i,s).then(d=>o({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof ht?a(d):a(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if(typeof r!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${r}`;return N0===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return r(e,t)}getMediaKeysPromise(e,t,r){const i=Cv(e,t,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[e];let o=s?.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${JSON.stringify(i)}`),o=this.requestMediaKeySystemAccess(e,i);const a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(l=>{this.log(`Failed to obtain access to key-system "${e}": ${l}`)}),o.then(l=>{this.log(`Access for key-system "${l.keySystem}" obtained`);const u=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),a.mediaKeys=l.createMediaKeys().then(c=>(this.log(`Media-keys created for "${e}"`),u.then(d=>d?this.setMediaKeysServerCertificate(c,e,d):c))),a.mediaKeys.catch(c=>{this.error(`Failed to create media-keys for "${e}"}: ${c}`)}),a.mediaKeys})}return o.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${Ut.hexDump(e.keyId||[])}`);const i=r.createSession(),s={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),i=this.getKeyIdString(t),s="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,s,t.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Ut.hexDump(e.keyId)}updateKeySession(e,t){var r;const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyID ${Ut.hexDump(((r=e.decryptdata)==null?void 0:r.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),i.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,r)=>{const i=es(this.config),s=e.map(la).filter(o=>!!o&&i.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:o})=>{const a=ca(o);a?t(a):r(new Error(`Unable to find format for key-system "${o}"`))}).catch(r)})}loadKey(e){const t=e.keyInfo.decryptdata,r=this.getKeyIdString(t),i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);let s=this.keyIdToKeySessionPromise[r];return s||(s=this.keyIdToKeySessionPromise[r]=this.getKeySystemForKeyPromise(t).then(({keySystem:o,mediaKeys:a})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(o,a).then(()=>{this.throwIfDestroyed();const l=this.createMediaKeySessionContext({keySystem:o,mediaKeys:a,decryptdata:t});return this.generateRequestWithPreferredKeySession(l,"cenc",t.pssh,"playlist-key")}))),s.catch(o=>this.handleError(o))),s}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof ht?this.hls.trigger(v.ERROR,e.data):this.hls.trigger(v.ERROR,{type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),r=this.keyIdToKeySessionPromise[t];if(!r){const i=la(e.keyFormat),s=i?[i]:es(this.config);return this.attemptKeySystemAccess(s)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=es(this.config)),e.length===0)throw new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(r).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>r.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(e,t,r,i){var s,o;const a=(s=this.config.drmSystems)==null||(o=s[e.keySystem])==null?void 0:o.generateRequest;if(a)try{const h=a.call(this.hls,t,r,e);if(!h)throw new Error("Invalid response from configured generateRequest filter");t=h.initDataType,r=e.decryptdata.pssh=h.initData?new Uint8Array(h.initData):null}catch(h){var l;if(this.warn(h.message),(l=this.hls)!=null&&l.config.debug)throw h}if(r===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const u=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${i}": ${u} (init data type: ${t} length: ${r?r.byteLength:null})`);const c=new ju,d=e._onmessage=h=>{const g=e.mediaKeysSession;if(!g){c.emit("error",new Error("invalid state"));return}const{messageType:y,message:p}=h;this.log(`"${y}" message event for session "${g.sessionId}" message size: ${p.byteLength}`),y==="license-request"||y==="license-renewal"?this.renewLicense(e,p).catch(x=>{this.handleError(x),c.emit("error",x)}):y==="license-release"?e.keySystem===ae.FAIRPLAY&&(this.updateKeySession(e,Ll("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${y}"`)},f=e._onkeystatuseschange=h=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const y=e.keyStatus;c.emit("keyStatus",y),y==="expired"&&(this.warn(`${e.keySystem} expired for key ${u}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",d),e.mediaKeysSession.addEventListener("keystatuseschange",f);const m=new Promise((h,g)=>{c.on("error",g),c.on("keyStatus",y=>{y.startsWith("usable")?h():y==="output-restricted"?g(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):y==="internal-error"?g(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${y}"`)):y==="expired"?g(new Error("key expired while generating request")):this.warn(`unhandled key status change "${y}"`)})});return e.mediaKeysSession.generateRequest(t,r).then(()=>{var h;this.log(`Request generated for key-session "${(h=e.mediaKeysSession)==null?void 0:h.sessionId}" keyId: ${u}`)}).catch(h=>{throw new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_SESSION,error:h,fatal:!1},`Error generating key-session request: ${h}`)}).then(()=>m).catch(h=>{throw c.removeAllListeners(),this.removeSession(e),h}).then(()=>(c.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,r)=>{this.log(`key status change "${t}" for keyStatuses keyId: ${Ut.hexDump("buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r))} session keyId: ${Ut.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,r=t.loader,i=new r(t),s=this.getServerCertificateUrl(e);return s?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,a)=>{const l={responseType:"arraybuffer",url:s},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,h,g)=>{o(f.data)},onError:(f,m,h,g)=>{a(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:Ne({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${s}). Status: ${f.code} (${f.text})`))},onTimeout:(f,m,h)=>{a(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:h,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${s})`))},onAbort:(f,m,h)=>{a(new Error("aborted"))}};i.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((i,s)=>{e.setServerCertificate(r).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${r?.byteLength}) on "${t}"`),i(e)}).catch(o=>{s(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(r=>this.updateKeySession(e,new Uint8Array(r)).catch(i=>{throw new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:i,fatal:!0},i.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(r,"application/xml"),s=i.querySelectorAll("HttpHeader");if(s.length>0){let c;for(let d=0,f=s.length;d<f;d++){var o,a;c=s[d];const m=(o=c.querySelector("name"))==null?void 0:o.textContent,h=(a=c.querySelector("value"))==null?void 0:a.textContent;m&&h&&e.setRequestHeader(m,h)}}const l=i.querySelector("Challenge"),u=l?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Ll(atob(u))}setupLicenseXHR(e,t,r,i){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return s.call(this.hls,e,t,r,i)}).catch(o=>{if(!r.decryptdata)throw o;return e.open("POST",t,!0),s.call(this.hls,e,t,r,i)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((i,s)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return s(new Error("invalid state"));if(a.readyState===4)if(a.status===200){this._requestLicenseFailureCount=0;let l=a.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,a,o,e)}catch(c){this.error(c)}i(l)}else{const l=r.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||a.status>=400&&a.status<500)s(new ht({type:J.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:a,response:{url:o,data:void 0,code:a.status,text:a.statusText}},`License Request XHR failed (${o}). Status: ${a.status} (${a.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(i,s)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=a,this.setupLicenseXHR(a,o,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==ae.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media,t=this.mediaKeySessions;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},wi.clearKeyUriToKeyIdMap();const r=t.length;Tr.CDMCleanupPromise=Promise.all(t.map(i=>this.removeSession(i)).concat(e?.setMediaKeys(null).catch(i=>{this.log(`Could not clear media keys: ${i}`)}))).then(()=>{r&&(this.log("finished closing key sessions and clearing media keys"),t.length=0)}).catch(i=>{this.log(`Could not close sessions and clear media keys: ${i}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const r=t.reduce((i,s)=>(i.indexOf(s.keyFormat)===-1&&i.push(s.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);return i>-1&&this.mediaKeySessions.splice(i,1),t.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>t.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}Tr.CDMCleanupPromise=void 0;class ht extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}var Ke;(function(n){n.MANIFEST="m",n.AUDIO="a",n.VIDEO="v",n.MUXED="av",n.INIT="i",n.CAPTION="c",n.TIMED_TEXT="tt",n.KEY="k",n.OTHER="o"})(Ke||(Ke={}));var Pl;(function(n){n.DASH="d",n.HLS="h",n.SMOOTH="s",n.OTHER="o"})(Pl||(Pl={}));var Bn;(function(n){n.OBJECT="CMCD-Object",n.REQUEST="CMCD-Request",n.SESSION="CMCD-Session",n.STATUS="CMCD-Status"})(Bn||(Bn={}));const LS={[Bn.OBJECT]:["br","d","ot","tb"],[Bn.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Bn.SESSION]:["cid","pr","sf","sid","st","v"],[Bn.STATUS]:["bs","rtp"]};class Pr{constructor(e,t){this.value=void 0,this.params=void 0,Array.isArray(e)&&(e=e.map(r=>r instanceof Pr?r:new Pr(r))),this.value=e,this.params=t}}class bm{constructor(e){this.description=void 0,this.description=e}}const AS="Dict";function RS(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function IS(n,e,t,r){return new Error(`failed to ${n} "${RS(e)}" as ${t}`,{cause:r})}const rf="Bare Item",wS="Boolean",CS="Byte Sequence",kS="Decimal",DS="Integer";function _S(n){return n<-999999999999999||999999999999999<n}const bS=/[\x00-\x1f\x7f]+/,PS="Token",FS="Key";function zt(n,e,t){return IS("serialize",n,e,t)}function OS(n){if(typeof n!="boolean")throw zt(n,wS);return n?"?1":"?0"}function NS(n){return btoa(String.fromCharCode(...n))}function MS(n){if(ArrayBuffer.isView(n)===!1)throw zt(n,CS);return`:${NS(n)}:`}function Pm(n){if(_S(n))throw zt(n,DS);return n.toString()}function US(n){return`@${Pm(n.getTime()/1e3)}`}function Fm(n,e){if(n<0)return-Fm(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}function BS(n){const e=Fm(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw zt(n,kS);const t=e.toString();return t.includes(".")?t:`${t}.0`}const $S="String";function GS(n){if(bS.test(n))throw zt(n,$S);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function VS(n){return n.description||n.toString().slice(7,-1)}function sf(n){const e=VS(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw zt(e,PS);return e}function Fl(n){switch(typeof n){case"number":if(!$(n))throw zt(n,rf);return Number.isInteger(n)?Pm(n):BS(n);case"string":return GS(n);case"symbol":return sf(n);case"boolean":return OS(n);case"object":if(n instanceof Date)return US(n);if(n instanceof Uint8Array)return MS(n);if(n instanceof bm)return sf(n);default:throw zt(n,rf)}}function Ol(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw zt(n,FS);return n}function qu(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Ol(e)}`:`;${Ol(e)}=${Fl(t)}`).join("")}function Om(n){return n instanceof Pr?`${Fl(n.value)}${qu(n.params)}`:Fl(n)}function HS(n){return`(${n.value.map(Om).join(" ")})${qu(n.params)}`}function KS(n,e={whitespace:!0}){if(typeof n!="object")throw zt(n,AS);const t=n instanceof Map?n.entries():Object.entries(n),r=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([i,s])=>{s instanceof Pr||(s=new Pr(s));let o=Ol(i);return s.value===!0?o+=qu(s.params):(o+="=",Array.isArray(s.value)?o+=HS(s):o+=Om(s)),o}).join(`,${r}`)}function jS(n,e){return KS(n,e)}const zS=n=>n==="ot"||n==="sf"||n==="st",WS=n=>typeof n=="number"?$(n):n!=null&&n!==""&&n!==!1;function YS(n,e){const t=new URL(n),r=new URL(e);if(t.origin!==r.origin)return n;const i=t.pathname.split("/").slice(1),s=r.pathname.split("/").slice(1,-1);for(;i[0]===s[0];)i.shift(),s.shift();for(;s.length;)s.shift(),i.unshift("..");return i.join("/")}function qS(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const s=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?s:s&3|8).toString(16)})}}}const Ds=n=>Math.round(n),XS=(n,e)=>(e!=null&&e.baseUrl&&(n=YS(n,e.baseUrl)),encodeURIComponent(n)),ds=n=>Ds(n/100)*100,QS={br:Ds,d:Ds,bl:ds,dl:ds,mtp:ds,nor:XS,rtp:ds,tb:Ds};function JS(n,e){const t={};if(n==null||typeof n!="object")return t;const r=Object.keys(n).sort(),i=we({},QS,e?.formatters),s=e?.filter;return r.forEach(o=>{if(s!=null&&s(o))return;let a=n[o];const l=i[o];l&&(a=l(a,e)),!(o==="v"&&a===1)&&(o=="pr"&&a===1||WS(a)&&(zS(o)&&typeof a=="string"&&(a=new bm(a)),t[o]=a))}),t}function Nm(n,e={}){return n?jS(JS(n,e),we({whitespace:!1},e)):""}function ZS(n,e={}){if(!n)return{};const t=Object.entries(n),r=Object.entries(LS).concat(Object.entries(e?.customHeaderMap||{})),i=t.reduce((s,o)=>{var a,l;const[u,c]=o,d=((a=r.find(f=>f[1].includes(u)))==null?void 0:a[0])||Bn.REQUEST;return(l=s[d])!=null||(s[d]={}),s[d][u]=c,s},{});return Object.entries(i).reduce((s,[o,a])=>(s[o]=Nm(a,e),s),{})}function eT(n,e,t){return we(n,ZS(e,t))}const tT="CMCD";function nT(n,e={}){if(!n)return"";const t=Nm(n,e);return`${tT}=${encodeURIComponent(t)}`}const of=/CMCD=[^&#]+/;function rT(n,e,t){const r=nT(e,t);if(!r)return n;if(of.test(n))return n.replace(of,r);const i=n.includes("?")?"&":"?";return`${n}${i}${r}`}class iT{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Ke.MANIFEST,su:!this.initialized})}catch(s){R.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=i=>{try{const s=i.frag,o=this.hls.levels[s.level],a=this.getObjectType(s),l={d:s.duration*1e3,ot:a};(a===Ke.VIDEO||a===Ke.AUDIO||a==Ke.MUXED)&&(l.br=o.bitrate/1e3,l.tb=this.getTopBandwidth(a)/1e3,l.bl=this.getBufferLength(a)),this.apply(i,l)}catch(s){R.warn("Could not generate segment CMCD data.",s)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||qS(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHED,this.onMediaDetached,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHED,this.onMediaDetached,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,i;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:Pl.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){we(t,this.createData());const r=t.ot===Ke.INIT||t.ot===Ke.VIDEO||t.ot===Ke.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((s,o)=>(i.includes(o)&&(s[o]=t[o]),s),{})),this.useHeaders?(e.headers||(e.headers={}),eT(e.headers,t)):e.url=rT(e.url,t)}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ke.TIMED_TEXT;if(e.sn==="initSegment")return Ke.INIT;if(t==="audio")return Ke.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ke.VIDEO:Ke.MUXED}getTopBandwidth(e){let t=0,r;const i=this.hls;if(e===Ke.AUDIO)r=i.audioTracks;else{const s=i.maxAutoLevel,o=s>-1?s+1:i.levels.length;r=i.levels.slice(0,o)}for(const s of r)s.bitrate>t&&(t=s.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.hls.media,r=e===Ke.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:fe.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new r(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,o,a){t(s),this.loader.load(s,o,a)}}}}const sT=3e5;class oT{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=R.log.bind(R,"[content-steering]:"),this.registerListeners()}registerListeners(){const e=this.hls;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if(r?.action===Ue.SendAlternateToPenaltyBox&&r.flags===At.MoveAllAlternatesMatchingHost){const i=this.levels;let s=this.pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:a,pathwayId:l,type:u}=t.context;a&&i?o=this.getPathwayForGroupId(a,u,o):l&&(o=l)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!s&&i&&(s=i.reduce((a,l)=>(a.indexOf(l.pathwayId)===-1&&a.push(l.pathwayId),a),[])),s&&s.length>1&&(this.updatePathwayPriority(s),r.resolved=this.pathwayId!==o),r.resolved||R.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${i&&i.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t;const r=this.penalizedPathways,i=performance.now();Object.keys(r).forEach(s=>{i-r[s]>sT&&delete r[s]});for(let s=0;s<e.length;s++){const o=e[s];if(o in r)continue;if(o===this.pathwayId)return;const a=this.hls.nextLoadLevel,l=this.hls.levels[a];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,tm(t),this.hls.trigger(v.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[a];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const i=this.getLevelsForPathway(r).concat(this.levels||[]);for(let s=0;s<i.length;s++)if(t===ie.AUDIO_TRACK&&i[s].hasAudioGroup(e)||t===ie.SUBTITLE_TRACK&&i[s].hasSubtitleGroup(e))return i[s].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},i={};e.forEach(s=>{const{ID:o,"BASE-ID":a,"URI-REPLACEMENT":l}=s;if(t.some(c=>c.pathwayId===o))return;const u=this.getLevelsForPathway(a).map(c=>{const d=new xe(c.attrs);d["PATHWAY-ID"]=o;const f=d.AUDIO&&`${d.AUDIO}_clone_${o}`,m=d.SUBTITLES&&`${d.SUBTITLES}_clone_${o}`;f&&(r[d.AUDIO]=f,d.AUDIO=f),m&&(i[d.SUBTITLES]=m,d.SUBTITLES=m);const h=Mm(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),g=new br({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:h,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let y=1;y<c.audioGroups.length;y++)g.addGroupId("audio",`${c.audioGroups[y]}_clone_${o}`);if(c.subtitleGroups)for(let y=1;y<c.subtitleGroups.length;y++)g.addGroupId("text",`${c.subtitleGroups[y]}_clone_${o}`);return g});t.push(...u),af(this.audioTracks,r,l,o),af(this.subtitleTracks,i,l,o)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+c)}const s={responseType:"json",url:i.href},o=t.steeringManifestLoadPolicy.default,a=o.errorRetry||o.timeoutRetry||{},l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},u={onSuccess:(c,d,f,m)=>{this.log(`Loaded steering manifest: "${i}"`);const h=c.data;if(h.VERSION!==1){this.log(`Steering VERSION ${h.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=h.TTL;const{"RELOAD-URI":g,"PATHWAY-CLONES":y,"PATHWAY-PRIORITY":p}=h;if(g)try{this.uri=new self.URL(g,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${g}`);return}this.scheduleRefresh(this.uri||f.url),y&&this.clonePathways(y);const x={steeringManifest:h,url:i.toString()};this.hls.trigger(v.STEERING_MANIFEST_LOADED,x),p&&this.updatePathwayPriority(p)},onError:(c,d,f,m)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let h=this.timeToLoad*1e3;if(c.code===429){const g=this.loader;if(typeof g?.getResponseHeader=="function"){const y=g.getResponseHeader("Retry-After");y&&(h=parseFloat(y)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,h)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(s,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;const i=(r=this.hls)==null?void 0:r.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function af(n,e,t,r){n&&Object.keys(e).forEach(i=>{const s=n.filter(o=>o.groupId===i).map(o=>{const a=we({},o);return a.details=void 0,a.attrs=new xe(a.attrs),a.url=a.attrs.URI=Mm(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),a.groupId=a.attrs["GROUP-ID"]=e[i],a.attrs["PATHWAY-ID"]=r,a});n.push(...s)})}function Mm(n,e,t,r){const{HOST:i,PARAMS:s,[t]:o}=r;let a;e&&(a=o?.[e],a&&(n=a));const l=new self.URL(n);return i&&!a&&(l.host=i),s&&Object.keys(s).sort().forEach(u=>{u&&l.searchParams.set(u,s[u])}),l.href}const aT=/^age:\s*[\d.]+\s*$/im;class Um{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new _o,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==r||this.stats.aborted))return s(r,t.url)}).catch(o=>{if(!(this.loader!==r||this.stats.aborted))return r.open("GET",t.url,!0),s(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(o=>{this.callbacks.onError({code:r.status,text:o.message},t,r,i)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:o}=r.loadPolicy;if(i)for(const a in i)e.setRequestHeader(a,i[a]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=s&&$(s)?s:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const i=t.readyState,s=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const o=t.status,a=t.responseType==="text"?t.responseText:null;if(o>=200&&o<300){const d=a??t.response;if(d!=null){r.loading.end=Math.max(self.performance.now(),r.loading.first);const f=t.responseType==="arraybuffer"?d.byteLength:d.length;if(r.loaded=r.total=f,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;const m=this.callbacks.onProgress;if(m&&m(r,e,d,t),!this.callbacks)return;const h={url:t.responseURL,data:d,code:o};this.callbacks.onSuccess(h,r,e,t);return}}const l=s.loadPolicy.errorRetry,u=r.retry,c={url:e.url,data:void 0,code:o};lo(l,u,!1,c)?this.retry(l):(R.error(`${o} while loading ${e.url}`),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(lo(e,t,!0))this.retry(e);else{var r;R.warn(`timeout while loading ${(r=this.context)==null?void 0:r.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Nu(e,r.retry),r.retry++,R.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&aT.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}function lT(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const uT=/(\d+)-(\d+)\/(\d+)/;class lf{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||hT,this.controller=new self.AbortController,this.stats=new _o}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const s=cT(e,this.controller.signal),o=r.onProgress,a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:u,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,s),self.clearTimeout(this.requestTimeout),t.timeout=u&&$(u)?u:c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},t.timeout),self.fetch(this.request).then(d=>{this.response=this.loader=d;const f=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(i,e,this.response)},c-(f-i.loading.start)),!d.ok){const{status:m,statusText:h}=d;throw new mT(h||"fetch, bad network response",m,d)}return i.loading.first=f,i.total=fT(d.headers)||i.total,o&&$(t.highWaterMark)?this.loadProgressively(d,i,e,t.highWaterMark,o):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{const f=this.response;if(!f)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const m=d[l];m&&(i.loaded=i.total=m);const h={url:f.url,data:d,code:f.status};o&&!$(t.highWaterMark)&&o(i,e,d,f),r.onSuccess(h,i,e,f)}).catch(d=>{if(self.clearTimeout(this.requestTimeout),i.aborted)return;const f=d&&d.code||0,m=d?d.message:null;r.onError({code:f,text:m},e,d?d.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,i=0,s){const o=new sm,a=e.body.getReader(),l=()=>a.read().then(u=>{if(u.done)return o.dataLength&&s(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<i||o.dataLength?(o.push(c),o.dataLength>=i&&s(t,r,o.flush(),e)):s(t,r,c,e),l()}).catch(()=>Promise.reject());return l()}}function cT(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(we({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function dT(n){const e=uT.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function fT(n){const e=n.get("Content-Range");if(e){const r=dT(e);if($(r))return r}const t=n.get("Content-Length");if(t)return parseInt(t)}function hT(n,e){return new self.Request(n.url,e)}class mT extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const gT=/\s/,pT={newCue(n,e,t,r){const i=[];let s,o,a,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<r.rows.length;f++)if(s=r.rows[f],a=!0,l=0,u="",!s.isEmpty()){var d;for(let g=0;g<s.chars.length;g++)gT.test(s.chars[g].uchar)&&a?l++:(u+=s.chars[g].uchar,a=!1);s.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const m=wm(u.trim()),h=Wu(e,t,m);n!=null&&(d=n.cues)!=null&&d.getCueById(h)||(o=new c(e,t,m),o.id=h,o.line=f+1,o.align="left",o.position=10+Math.min(80,Math.floor(l*8/32)*10),i.push(o))}return n&&i.length&&(i.sort((f,m)=>f.line==="auto"||m.line==="auto"?0:f.line>8&&m.line>8?m.line-f.line:f.line-m.line),i.forEach(f=>Q0(n,f))),i}},yT={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Bm=Ne(Ne({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Um,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Kx,bufferController:YE,capLevelController:Yu,errorController:bx,fpsController:TS,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:N0,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:yT},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},vT()),{},{subtitleStreamController:KE,subtitleTrackController:zE,timelineController:ES,audioStreamController:VE,audioTrackController:HE,emeController:Tr,cmcdController:iT,contentSteeringController:oT});function vT(){return{cueHandler:pT,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function xT(n,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const t=Nl(n),r=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(s=>{const o=`${s==="level"?"playlist":s}LoadPolicy`,a=e[o]===void 0,l=[];i.forEach(u=>{const c=`${s}Loading${u}`,d=e[c];if(d!==void 0&&a){l.push(c);const f=t[o].default;switch(e[o]={default:f},u){case"TimeOut":f.maxLoadTimeMs=d,f.maxTimeToFirstByteMs=d;break;case"MaxRetry":f.errorRetry.maxNumRetry=d,f.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":f.errorRetry.retryDelayMs=d,f.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":f.errorRetry.maxRetryDelayMs=d,f.timeoutRetry.maxRetryDelayMs=d;break}}}),l.length&&R.warn(`hls.js config: "${l.join('", "')}" setting(s) are deprecated, use "${o}": ${JSON.stringify(e[o])}`)}),Ne(Ne({},t),e)}function Nl(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(Nl):Object.keys(n).reduce((e,t)=>(e[t]=Nl(n[t]),e),{}):n}function ET(n){const e=n.loader;e!==lf&&e!==Um?(R.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):lT()&&(n.loader=lf,n.progressive=!0,n.enableSoftwareAES=!0,R.log("[config]: Progressive streaming enabled, using FetchLoader"))}let ka;class ST extends Mu{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this),e.on(v.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this),e.off(v.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,i=[],s={},o={};let a=!1,l=!1,u=!1;t.levels.forEach(c=>{var d,f;const m=c.attrs;let{audioCodec:h,videoCodec:g}=c;((d=h)==null?void 0:d.indexOf("mp4a.40.34"))!==-1&&(ka||(ka=/chrome|firefox/i.test(navigator.userAgent)),ka&&(c.audioCodec=h=void 0)),h&&(c.audioCodec=h=so(h,r)),((f=g)==null?void 0:f.indexOf("avc1"))===0&&(g=c.videoCodec=ax(g));const{width:y,height:p,unknownCodecs:x}=c;if(a||(a=!!(y&&p)),l||(l=!!g),u||(u=!!h),x!=null&&x.length||h&&!ma(h,"audio",r)||g&&!ma(g,"video",r))return;const{CODECS:E,"FRAME-RATE":T,"HDCP-LEVEL":S,"PATHWAY-ID":A,RESOLUTION:L,"VIDEO-RANGE":C}=m,w=`${`${A||"."}-`}${c.bitrate}-${L}-${T}-${E}-${C}-${S}`;if(s[w])if(s[w].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const F=o[w]+=1;c.attrs["PATHWAY-ID"]=new Array(F+1).join(".");const z=new br(c);s[w]=z,i.push(z)}else s[w].addGroupId("audio",m.AUDIO),s[w].addGroupId("text",m.SUBTITLES);else{const F=new br(c);s[w]=F,o[w]=1,i.push(F)}}),this.filterAndSortMediaOptions(i,t,a,l,u)}filterAndSortMediaOptions(e,t,r,i,s){let o=[],a=[],l=e;if((r||i)&&s&&(l=l.filter(({videoCodec:h,videoRange:g,width:y,height:p})=>(!!h||!!(y&&p))&&Ex(g))),l.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);const h=new Error("no level with compatible codecs found in manifest");this.hls.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:h,reason:h.message})}});return}if(t.audioTracks){const{preferManagedMediaSource:h}=this.hls.config;o=t.audioTracks.filter(g=>!g.audioCodec||ma(g.audioCodec,"audio",h)),uf(o)}t.subtitles&&(a=t.subtitles,uf(a));const u=l.slice(0);l.sort((h,g)=>{if(h.attrs["HDCP-LEVEL"]!==g.attrs["HDCP-LEVEL"])return(h.attrs["HDCP-LEVEL"]||"")>(g.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&h.height!==g.height)return h.height-g.height;if(h.frameRate!==g.frameRate)return h.frameRate-g.frameRate;if(h.videoRange!==g.videoRange)return oo.indexOf(h.videoRange)-oo.indexOf(g.videoRange);if(h.videoCodec!==g.videoCodec){const y=gd(h.videoCodec),p=gd(g.videoCodec);if(y!==p)return p-y}if(h.uri===g.uri&&h.codecSet!==g.codecSet){const y=io(h.codecSet),p=io(g.codecSet);if(y!==p)return p-y}return h.averageBitrate!==g.averageBitrate?h.averageBitrate-g.averageBitrate:0});let c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length)){for(let h=0;h<u.length;h++)if(u[h].pathwayId===l[0].pathwayId){c=u[h];break}}this._levels=l;for(let h=0;h<l.length;h++)if(l[h]===c){var d;this._firstLevel=h;const g=c.bitrate,y=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${g}`),((d=this.hls.userConfig)==null?void 0:d.abrEwmaDefaultEstimate)===void 0){const p=Math.min(g,this.hls.config.abrEwmaDefaultEstimateMax);p>y&&y===Bm.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=p)}break}const f=s&&!i,m={levels:l,audioTracks:o,subtitleTracks:a,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:i,altAudio:!f&&o.some(h=>!!h.url)};this.hls.trigger(v.MANIFEST_PARSED,m),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(v.ERROR,{type:J.OTHER_ERROR,details:k.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,i=this.currentLevel,s=i?i.attrs["PATHWAY-ID"]:void 0,o=t[e],a=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,r===e&&o.details&&i&&s===a)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${a?" with Pathway "+a:""} from level ${r}${s?" with Pathway "+s:""}`);const l={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(v.LEVEL_SWITCHING,l);const u=o.details;if(!u||u.live){const c=this.switchParams(o.uri,i?.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===ie.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===X.MAIN){const r=t.elementaryStreams;if(!Object.keys(r).some(s=>!!r[s]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var r;const{level:i,details:s}=t,o=this._levels[i];if(!o){var a;this.warn(`Invalid level index ${i}`),(a=t.deliveryDirectives)!=null&&a.skip&&(s.deltaUpdateFailed=!0);return}i===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0),this.playlistLoaded(i,t,o.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();const t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let i=r.uri;if(e)try{i=e.addDirectives(i)}catch(o){this.warn(`Could not construct new URL with HLS Delivery Directives: ${o}`)}const s=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""} with${s?" Pathway "+s:""} ${i}`),this.clearTimer(),this.hls.trigger(v.LEVEL_LOADING,{url:i,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;const r=this._levels.filter((i,s)=>s!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));tm(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(v.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(v.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function uf(n){const e={};n.forEach(t=>{const r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++})}class TT{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyUriToKeyInfo){const i=this.keyUriToKeyInfo[r].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=k.KEY_LOAD_ERROR,r,i,s){return new Xt({type:J.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:s,error:r,networkDetails:i})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:r,cc:i}=e;for(let s=0;s<t.length;s++){const o=t[s];if(i<=o.cc&&(r==="initSegment"||o.sn==="initSegment"||r<o.sn)){this.emeController.selectKeySystemFormat(o).then(a=>{o.setKeyFormat(a)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,i;t&&e.setKeyFormat(t);const s=e.decryptdata;if(!s){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,u))}const o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let a=this.keyUriToKeyInfo[o];if((r=a)!=null&&r.decryptdata.key)return s.key=a.decryptdata.key,Promise.resolve({frag:e,keyInfo:a});if((i=a)!=null&&i.keyLoadPromise){var l;switch((l=a.mediaKeySessionContext)==null?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return a.keyLoadPromise.then(u=>(s.key=u.keyInfo.decryptdata.key,{frag:e,keyInfo:a}))}}switch(a=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(a,e):this.loadKeyEME(a,e);case"AES-128":return this.loadKeyHTTP(a,e);default:return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(s=>(e.mediaKeySessionContext=s,r))).catch(s=>{throw e.keyLoadPromise=null,s})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,i=r.loader,s=new i(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((o,a)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,m,h,g)=>{const{frag:y,keyInfo:p,url:x}=h;if(!y.decryptdata||p!==this.keyUriToKeyInfo[x])return a(this.createKeyLoadError(y,k.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),g));p.decryptdata.key=y.decryptdata.key=new Uint8Array(f.data),y.keyLoader=null,p.loader=null,o({frag:y,keyInfo:p})},onError:(f,m,h,g)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),h,Ne({url:l.url,data:void 0},f)))},onTimeout:(f,m,h)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),h))},onAbort:(f,m,h)=>{this.resetLoader(m),a(this.createKeyLoadError(t,k.INTERNAL_ABORTED,new Error("key loading aborted"),h))}};s.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:r,url:i}=e,s=r.loader;t.keyLoader===s&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],s&&s.destroy()}}function $m(){return self.SourceBuffer||self.WebKitSourceBuffer}function Gm(){if(!qn())return!1;const e=$m();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function LT(){if(!Gm())return!1;const n=qn();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Ci(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Ci(e,"audio"))))}function AT(){var n;const e=$m();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const RT=250,_s=2,IT=.1,wT=.05;class CT{constructor(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){const{config:r,media:i,stalled:s}=this;if(i===null)return;const{currentTime:o,seeking:a}=i,l=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,o!==e){if(this.moved=!0,a||(this.nudgeRetry=0),s!==null){if(this.stallReported){const y=self.performance.now()-s;R.warn(`playback not stuck anymore @${o}, after ${Math.round(y)}ms`),this.stallReported=!1}this.stalled=null}return}if(u||l){this.stalled=null;return}if(i.paused&&!a||i.ended||i.playbackRate===0||!fe.getBuffered(i).length){this.nudgeRetry=0;return}const c=fe.bufferInfo(i,o,0),d=c.nextStart||0;if(a){const y=c.len>_s,p=!d||t&&t.start<=o||d-o>_s&&!this.fragmentTracker.getPartialFragment(o);if(y||p)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var f;if(!(c.len>0)&&!d)return;const p=Math.max(d,c.start||0)-o,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,T=(x==null||(f=x.details)==null?void 0:f.live)?x.details.targetduration*2:_s,S=this.fragmentTracker.getPartialFragment(o);if(p>0&&(p<=T||S)){i.paused||this._trySkipBufferHole(S);return}}const m=self.performance.now();if(s===null){this.stalled=m;return}const h=m-s;if(!a&&h>=RT&&(this._reportStall(c),!this.media))return;const g=fe.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(g,h)}_tryFixBufferStall(e,t){const{config:r,fragmentTracker:i,media:s}=this;if(s===null)return;const o=s.currentTime,a=i.getPartialFragment(o);a&&(this._trySkipBufferHole(a)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(R.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){const{hls:t,media:r,stallReported:i}=this;if(!i&&r){this.stallReported=!0;const s=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);R.warn(s.message),t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:e.len})}}_trySkipBufferHole(e){const{config:t,hls:r,media:i}=this;if(i===null)return 0;const s=i.currentTime,o=fe.bufferInfo(i,s,0),a=s<o.start?o.start:o.nextStart;if(a){const l=o.len<=t.maxBufferHole,u=o.len>0&&o.len<1&&i.readyState<3,c=a-s;if(c>0&&(l||u)){if(c>t.maxBufferHole){const{fragmentTracker:f}=this;let m=!1;if(s===0){const h=f.getAppendedFrag(0,X.MAIN);h&&a<h.end&&(m=!0)}if(!m){const h=e||f.getAppendedFrag(s,X.MAIN);if(h){let g=!1,y=h.end;for(;y<a;){const p=f.getPartialFragment(y);if(p)y+=p.duration;else{g=!0;break}}if(g)return 0}}}const d=Math.max(a+wT,s+IT);if(R.warn(`skipping hole, adjusting currentTime from ${s} to ${d}`),this.moved=!0,this.stalled=null,i.currentTime=d,e&&!e.gap){const f=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${d}`);r.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:e})}return d}}return 0}_tryNudgeBuffer(){const{config:e,hls:t,media:r,nudgeRetry:i}=this;if(r===null)return;const s=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){const o=s+(i+1)*e.nudgeOffset,a=new Error(`Nudging 'currentTime' from ${s} to ${o}`);R.warn(a.message),r.currentTime=o,t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_NUDGE_ON_STALL,error:a,fatal:!1})}else{const o=new Error(`Playhead still not moving while enough data buffered @${s} after ${e.nudgeMaxRetry} nudges`);R.error(o.message),t.trigger(v.ERROR,{type:J.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}}const kT=100;class DT extends $u{constructor(e,t,r){super(e,t,r,"[stream-controller]",X.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(v.MANIFEST_LOADING,this.onManifestLoading,this),e.on(v.MANIFEST_PARSED,this.onManifestParsed,this),e.on(v.LEVEL_LOADING,this.onLevelLoading,this),e.on(v.LEVEL_LOADED,this.onLevelLoaded,this),e.on(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(v.ERROR,this.onError,this),e.on(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(v.BUFFER_CREATED,this.onBufferCreated,this),e.on(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(v.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:e}=this;e.off(v.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(v.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(v.MANIFEST_LOADING,this.onManifestLoading,this),e.off(v.MANIFEST_PARSED,this.onManifestParsed,this),e.off(v.LEVEL_LOADED,this.onLevelLoaded,this),e.off(v.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(v.ERROR,this.onError,this),e.off(v.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(v.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(v.BUFFER_CREATED,this.onBufferCreated,this),e.off(v.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(v.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(v.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){const{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(kT),this.level=-1,!this.startFragRequested){let i=r.startLevel;i===-1&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.firstAutoLevel),r.nextLoadLevel=i,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=b.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=b.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case b.WAITING_LEVEL:{const{levels:t,level:r}=this,i=t?.[r],s=i?.details;if(s&&(!s.live||this.levelLastLoaded===i)){if(this.waitForCdnTuneIn(s))break;this.state=b.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=b.IDLE;break}break}case b.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){const{levels:i,level:s}=this,o=i?.[s];this.resetStartWhenNotLoaded(o||null),this.state=b.IDLE}}break}this.state===b.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:i}=this;if(t===null||!i&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(r!=null&&r[s]))return;const o=r[s],a=this.getMainFwdBufferInfo();if(a===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(a,l)){const g={};this.altAudio&&(g.type="video"),this.hls.trigger(v.BUFFER_EOS,g),this.state=b.ENDED;return}if(!this.buffering)return;e.loadLevel!==s&&e.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=e.nextLoadLevel=s;const u=o.details;if(!u||this.state===b.WAITING_LEVEL||u.live&&this.levelLastLoaded!==o){this.level=s,this.state=b.WAITING_LEVEL;return}const c=a.len,d=this.getMaxBufferLength(o.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>a.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:a.end;let m=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&m&&m.sn!=="initSegment"&&this.fragmentTracker.getState(m)!==Fe.OK){var h;const y=((h=this.backtrackFragment)!=null?h:m).sn-u.startSN,p=u.fragments[y-1];p&&m.cc===p.cc&&(m=p,this.fragmentTracker.removeFragment(p))}else this.backtrackFragment&&a.len&&(this.backtrackFragment=null);if(m&&this.isLoopLoading(m,f)){if(!m.gap){const y=this.audioOnly&&!this.altAudio?le.AUDIO:le.VIDEO,p=(y===le.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;p&&this.afterBufferFlushed(p,y,X.MAIN)}m=this.getNextFragmentLoopLoading(m,u,a,X.MAIN,d)}m&&(m.initSegment&&!m.initSegment.data&&!this.bitrateTest&&(m=m.initSegment),this.loadFragment(m,o,f))}loadFragment(e,t,r){const i=this.fragmentTracker.getState(e);this.fragCurrent=e,i===Fe.NOT_LOADED||i===Fe.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,X.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let r;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const a=this.getMainFwdBufferInfo();if(!a||a.len<s.targetduration*2)return}if(!t.paused&&e){const a=this.hls.nextLoadLevel,l=e[a],u=this.fragLastKbps;u&&this.fragCurrent?r=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:r=0}else r=0;const o=this.getBufferedFrag(t.currentTime+r);if(o){const a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();const l=a.maxStartPTS?a.maxStartPTS:a.start,u=a.duration,c=Math.max(o.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case b.KEY_LOADING:case b.FRAG_LOADING:case b.FRAG_LOADING_WAITING_RETRY:case b.PARSING:case b.PARSED:this.state=b.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new CT(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const e=this.media,t=e?e.currentTime:null;$(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);const r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(v.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,i=!1;t.levels.forEach(s=>{const o=s.audioCodec;o&&(r=r||o.indexOf("mp4a.40.2")!==-1,i=i||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&i&&!AT(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==b.IDLE)return;const i=r[t.level];(!i.details||i.details.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(i.details))&&(this.state=b.WAITING_LEVEL)}onLevelLoaded(e,t){var r;const{levels:i}=this,s=t.level,o=t.details,a=o.totalduration;if(!i){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${a}`);const l=i[s],u=this.fragCurrent;u&&(this.state===b.FRAG_LOADING||this.state===b.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(o.live||(r=l.details)!=null&&r.live){var d;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,l.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(l.details=o,this.levelLastLoaded=l,this.hls.trigger(v.LEVEL_UPDATED,{details:o,level:s}),this.state===b.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=b.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,c),this.tick()}_handleFragmentLoadProgress(e){var t;const{frag:r,part:i,payload:s}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}const a=o[r.level],l=a.details;if(!l){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}const u=a.videoCodec,c=l.PTSKnown||!l.live,d=(t=r.initSegment)==null?void 0:t.data,f=this._getAudioCodec(a),m=this.transmuxer=this.transmuxer||new Sm(this.hls,X.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=i?i.index:-1,g=h!==-1,y=new Uu(r.level,r.sn,r.stats.chunkCount,s.byteLength,h,g),p=this.initPTS[r.cc];m.push(s,d,f,u,r,i,l.totalduration,c,y,p)}onAudioTrackSwitching(e,t){const r=this.altAudio;if(!!!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;r&&(s.trigger(v.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(v.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=t.id,i=!!this.hls.audioTracks[r].url;if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i,this.tick()}onBufferCreated(e,t){const r=t.tracks;let i,s,o=!1;for(const a in r){const l=r[a];if(l.id==="main"){if(s=a,i=l,a==="video"){const u=r[a];u&&(this.videoBuffer=u.buffer)}}else o=!0}o&&i?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:i}=t;if(r&&r.type!==X.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${i?" p: "+i.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===b.PARSED&&(this.state=b.IDLE);return}const s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}onError(e,t){var r;if(t.fatal){this.state=b.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(X.MAIN,t);break;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===b.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===ie.LEVEL&&(this.state=b.IDLE);break;case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===k.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){const{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!fe.getBuffered(e).length){const r=this.state!==b.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=b.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==le.AUDIO||this.audioOnly&&!this.altAudio){const r=(t===le.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,X.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}const i=fe.getBuffered(e),o=(i.length?i.start(0):0)-r;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{const{hls:i}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=b.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=e.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(v.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const r="main",{hls:i}=this,{remuxResult:s,chunkMeta:o}=e,a=this.getCurrentContext(o);if(!a){this.resetWhenMissingContext(o);return}const{frag:l,part:u,level:c}=a,{video:d,text:f,id3:m,initSegment:h}=s,{details:g}=c,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=b.PARSING,h){if(h!=null&&h.tracks){const E=l.initSegment||l;this._bufferInitSegment(c,h.tracks,E,o),i.trigger(v.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:r,tracks:h.tracks})}const p=h.initPTS,x=h.timescale;$(p)&&(this.initPTS[l.cc]={baseTime:p,timescale:x},i.trigger(v.INIT_PTS_FOUND,{frag:l,id:r,initPTS:p,timescale:x}))}if(d&&g&&l.sn!=="initSegment"){const p=g.fragments[l.sn-1-g.startSN],x=l.sn===g.startSN,E=!p||l.cc>p.cc;if(s.independent!==!1){const{startPTS:T,endPTS:S,startDTS:A,endDTS:L}=d;if(u)u.elementaryStreams[d.type]={startPTS:T,endPTS:S,startDTS:A,endDTS:L};else if(d.firstKeyFrame&&d.independent&&o.id===1&&!E&&(this.couldBacktrack=!0),d.dropped&&d.independent){const C=this.getMainFwdBufferInfo(),N=(C?C.end:this.getLoadPosition())+this.config.maxBufferHole,w=d.firstKeyFramePTS?d.firstKeyFramePTS:T;if(!x&&N<w-this.config.maxBufferHole&&!E){this.backtrack(l);return}else E&&(l.gap=!0);l.setElementaryStreamInfo(d.type,l.start,S,l.start,L,!0)}else x&&T>_s&&(l.gap=!0);l.setElementaryStreamInfo(d.type,T,S,A,L),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(d,l,u,o,x||E)}else if(x||E)l.gap=!0;else{this.backtrack(l);return}}if(y){const{startPTS:p,endPTS:x,startDTS:E,endDTS:T}=y;u&&(u.elementaryStreams[le.AUDIO]={startPTS:p,endPTS:x,startDTS:E,endDTS:T}),l.setElementaryStreamInfo(le.AUDIO,p,x,E,T),this.bufferFragmentData(y,l,u,o)}if(g&&m!=null&&(t=m.samples)!=null&&t.length){const p={id:r,frag:l,details:g,samples:m.samples};i.trigger(v.FRAG_PARSING_METADATA,p)}if(g&&f){const p={id:r,frag:l,details:g,samples:f.samples};i.trigger(v.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,r,i){if(this.state!==b.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;const{audio:s,video:o,audiovideo:a}=t;if(s){let l=e.audioCodec;const u=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){l&&(l.indexOf("mp4a.40.5")!==-1?l="mp4a.40.2":l="mp4a.40.5");const c=s.metadata;c&&"channelCount"in c&&(c.channelCount||1)!==1&&u.indexOf("firefox")===-1&&(l="mp4a.40.5")}l&&l.indexOf("mp4a.40.5")!==-1&&u.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(l="mp4a.40.2",this.log(`Android: force audio codec to ${l}`)),e.audioCodec&&e.audioCodec!==l&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${l}"`),s.levelCodec=l,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${l||""}/${e.audioCodec||""}/${s.codec}]`)}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${o.codec}]`)),a&&this.log(`Init audiovideo buffer, container:${a.container}, codecs[level/parsed]=[${e.codecs}/${a.codec}]`),this.hls.trigger(v.BUFFER_CODECS,t),Object.keys(t).forEach(l=>{const c=t[l].initSegment;c!=null&&c.byteLength&&this.hls.trigger(v.BUFFER_APPENDING,{type:l,data:c,frag:r,part:null,chunkMeta:i,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,X.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=b.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const r=e.currentTime;if(fe.isBuffered(e,r)?t=this.getAppendedFrag(r):fe.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,s=t.level;(!i||t.sn!==i.sn||i.level!==s)&&(this.fragPlaying=t,this.hls.trigger(v.FRAG_CHANGED,{frag:t}),(!i||i.level!==s)&&this.hls.trigger(v.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){const e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){const e=this.media;if(e){const t=e.currentTime,r=this.currentFrag;if(r&&$(t)&&$(r.programDateTime)){const i=r.programDateTime+(t-r.start)*1e3;return new Date(i)}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class at{static get version(){return"1.5.20"}static isMSESupported(){return Gm()}static isSupported(){return LT()}static getMediaSource(){return qn()}static get Events(){return v}static get ErrorTypes(){return J}static get ErrorDetails(){return k}static get DefaultConfig(){return at.defaultConfig?at.defaultConfig:Bm}static set DefaultConfig(e){at.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new ju,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,vv(e.debug||!1,"Hls instance");const t=this.config=xT(at.DefaultConfig,e);this.userConfig=e,t.progressive&&ET(t);const{abrController:r,bufferController:i,capLevelController:s,errorController:o,fpsController:a}=t,l=new o(this),u=this.abrController=new r(this),c=this.bufferController=new i(this),d=this.capLevelController=new s(this),f=new a(this),m=new fx(this),h=new yx(this),g=t.contentSteeringController,y=g?new g(this):null,p=this.levelController=new ST(this,y),x=new zx(this),E=new TT(this.config),T=this.streamController=new DT(this,x,E);d.setStreamController(T),f.setStreamController(T);const S=[m,p,T];y&&S.splice(1,0,y),this.networkControllers=S;const A=[u,c,d,f,h,x];this.audioTrackController=this.createController(t.audioTrackController,S);const L=t.audioStreamController;L&&S.push(new L(this,x,E)),this.subtitleTrackController=this.createController(t.subtitleTrackController,S);const C=t.subtitleStreamController;C&&S.push(new C(this,x,E)),this.createController(t.timelineController,A),E.emeController=this.emeController=this.createController(t.emeController,A),this.cmcdController=this.createController(t.cmcdController,A),this.latencyController=this.createController(vx,A),this.coreComponents=A,S.push(l);const N=l.onErrorOut;typeof N=="function"&&this.on(v.ERROR,N,l)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,i){this._emitter.off(e,t,r,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){if(R.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),!this.triggeringException){this.triggeringException=!0;const i=e===v.ERROR;this.trigger(v.ERROR,{type:J.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:i,event:e,error:r}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){R.log("destroy"),this.trigger(v.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){R.log("attachMedia"),this._media=e,this.trigger(v.MEDIA_ATTACHING,{media:e})}detachMedia(){R.log("detachMedia"),this.trigger(v.MEDIA_DETACHING,void 0),this._media=null}loadSource(e){this.stopLoad();const t=this.media,r=this.url,i=this.url=bu.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,R.log(`loadSource:${i}`),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(v.MANIFEST_LOADING,{url:e})}startLoad(e=-1){R.log(`startLoad(${e})`),this.started=!0,this.resumeBuffering();for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].startLoad(e),!(!this.started||!this.networkControllers));t++);}stopLoad(){R.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}resumeBuffering(){R.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()})}pauseBuffering(){R.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()})}swapAudioCodec(){R.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){R.log("recoverMediaError");const e=this._media;this.detachMedia(),e&&this.attachMedia(e)}removeLevel(e){this.levelController.removeLevel(e)}get levels(){const e=this.levelController.levels;return e||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){R.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){R.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){R.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){R.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){R.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(R.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){xx(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,r)for(let s=i;s--;){const o=e[s].attrs["HDCP-LEVEL"];if(o&&o<=r)return s}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(e){var t;return(t=this.audioTrackController)==null?void 0:t.setAudioOption(e)}setSubtitleOption(e){var t;return(t=this.subtitleTrackController)==null||t.setSubtitleOption(e),null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}at.defaultConfig=void 0;df().then(()=>{Hm("webgl"),console.log("TensorFlow.js initialized with backend:",Km())});const _T=.5,bT=100,PT=100,FT=2e3,OT=5e3,NT={debug:!1,enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:60*1e3*1e3,maxBufferHole:.5,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:10,liveDurationInfinity:!0,liveBackBufferLength:null,progressive:!0,xhrSetup:n=>{n.withCredentials=!1}},MT=({id:n,source:e,onRemove:t})=>{const r=ne.useRef(null),i=ne.useRef(null),s=ne.useRef(null),[o,a]=ne.useState({width:0,height:0}),{streams:l,addStream:u,removeStream:c}=lv(),{addCustomer:d,updateCustomer:f,deactivateCustomer:m,updateCustomerSnapshot:h}=_u(),g=ne.useRef(null),[y,p]=ne.useState(!1),[x,E]=ne.useState(!1),[T,S]=ne.useState(!1),[A,L]=ne.useState(null),C=ne.useRef(new Map),N=ne.useRef(new Map),w=ne.useRef(new Map),[F,z]=ne.useState(""),U=ne.useRef(null),V=ne.useRef(null),Y=ne.useRef(null),[K,Q]=ne.useState(!1),O=ne.useRef(0),P=3,[_,W]=ne.useState(!1),j=async()=>{if(s.current)try{_?document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen():s.current.requestFullscreen?await s.current.requestFullscreen():s.current.webkitRequestFullscreen?await s.current.webkitRequestFullscreen():s.current.msRequestFullscreen&&await s.current.msRequestFullscreen()}catch(H){console.error("Fullscreen error:",H)}};ne.useEffect(()=>{const H=()=>{W(document.fullscreenElement===s.current||document.webkitFullscreenElement===s.current||document.msFullscreenElement===s.current)};return document.addEventListener("fullscreenchange",H),document.addEventListener("webkitfullscreenchange",H),document.addEventListener("msfullscreenchange",H),()=>{document.removeEventListener("fullscreenchange",H),document.removeEventListener("webkitfullscreenchange",H),document.removeEventListener("msfullscreenchange",H)}},[]);const te=async(H,G)=>{try{const ee=document.createElement("canvas");if(ee.width=H.width||H.clientWidth,ee.height=H.height||H.clientHeight,ee.width===0||ee.height===0)return console.warn("Invalid canvas dimensions:",{width:ee.width,height:ee.height}),null;const Le=ee.getContext("2d");if(!Le)return null;Le.drawImage(H,0,0,ee.width,ee.height);const[We,_e,ye,Tt]=G;Le.strokeStyle="#00ff00",Le.lineWidth=2,Le.strokeRect(We,_e,ye,Tt);const st=20,Ft=Math.max(0,We-st),ln=Math.max(0,_e-st),Ur=Math.min(ye+st*2,ee.width-Ft),Br=Math.min(Tt+st*2,ee.height-ln);if(Ur<=0||Br<=0)return console.warn("Invalid crop dimensions",{cropWidth:Ur,cropHeight:Br}),null;const Oi=document.createElement("canvas");Oi.width=Ur,Oi.height=Br;const Xu=Oi.getContext("2d");return Xu?(Xu.drawImage(ee,Ft,ln,Ur,Br,0,0,Ur,Br),Oi.toDataURL("image/jpeg",.8)):null}catch(ee){return console.warn("Failed to capture snapshot:",ee),null}},oe=H=>{if(!r.current||!r.current.parentElement)return;const G=document.createElement("img");G.crossOrigin="anonymous",G.style.width="100%",G.style.height="100%",G.style.objectFit="contain",r.current.parentElement.appendChild(G),r.current.style.display="none",V.current=G;const ee=()=>{if(!V.current)return;const Le=new Date().getTime();V.current.src=`${H}?t=${Le}`,V.current.onload=()=>{V.current&&a({width:V.current.naturalWidth,height:V.current.naturalHeight})},V.current.onerror=()=>{x&&L("MJPEG stream error. Retrying...")}};ee(),Y.current=window.setInterval(ee,100),z("MJPEG")},pe=H=>{if(r.current){if(U.current&&U.current.destroy(),!at.isSupported())return r.current.canPlayType("application/vnd.apple.mpegurl")?(r.current.src=H,!0):(L("HLS is not supported in this browser"),!1);try{const G=new at(NT);return U.current=G,G.on(at.Events.MEDIA_ATTACHED,()=>{console.log("HLS: Media attached"),G.loadSource(H)}),G.on(at.Events.MANIFEST_PARSED,()=>{console.log("HLS: Manifest parsed"),r.current?.play().then(()=>{E(!0),Pt(),O.current=0}).catch(ee=>{console.error("HLS play error:",ee),L(`Failed to play HLS stream: ${ee.message}`)}).finally(()=>{Q(!1)})}),G.on(at.Events.ERROR,(ee,Le)=>{if(Le.fatal)switch(Le.type){case at.ErrorTypes.NETWORK_ERROR:O.current<P?(console.log("HLS: Fatal network error encountered, trying to recover..."),G.startLoad(),O.current++):(L(`Network error: ${Le.details}`),de());break;case at.ErrorTypes.MEDIA_ERROR:O.current<P?(console.log("HLS: Fatal media error encountered, trying to recover..."),G.recoverMediaError(),O.current++):(L(`Media error: ${Le.details}`),de());break;default:L(`Stream error: ${Le.details}`),de();break}}),G.attachMedia(r.current),!0}catch(G){return console.error("HLS initialization error:",G),L(`Failed to initialize HLS: ${G.message}`),!1}}},ce=async()=>{try{if(L(null),Q(!0),O.current=0,!r.current)throw new Error("Video element not found");if(r.current.srcObject&&(r.current.srcObject.getTracks().forEach(G=>G.stop()),r.current.srcObject=null),r.current.removeAttribute("src"),r.current.load(),e?.type==="webcam")try{const H=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});if(!r.current)throw H.getTracks().forEach(G=>G.stop()),new Error("Video element no longer available");r.current.srcObject=H,z("Webcam"),u(n,H),r.current.onloadedmetadata=()=>{r.current&&r.current.play().then(()=>{E(!0),Pt()}).catch(G=>{console.error("Webcam play error:",G),L(`Failed to start webcam: ${G.message}`),de()}).finally(()=>{Q(!1)})},r.current.onerror=G=>{console.error("Video error:",G),L("Failed to access webcam"),de(),Q(!1)}}catch(H){console.error("Webcam access error:",H);const G=H instanceof Error?H.message:"Failed to access webcam";L(G),Q(!1);return}else if(e?.type==="ip"||e?.type==="file"){if(!e.url)throw Q(!1),new Error("No URL provided");const H=e.url.toLowerCase();H.endsWith(".m3u8")?(z("HLS"),pe(e.url)||Q(!1)):H.includes("mjpg")||H.includes("mjpeg")?(oe(e.url),E(!0),Pt(),Q(!1)):(z("Direct"),r.current.src=e.url,r.current.onloadedmetadata=()=>{r.current?.play().then(()=>{E(!0),Pt()}).catch(G=>{console.error("Video play error:",G),L(`Failed to play video: ${G.message}`)}).finally(()=>{Q(!1)})},r.current.onerror=G=>{console.error("Video error:",G),L("Failed to load video"),de(),Q(!1)})}else throw Q(!1),new Error("Invalid source type")}catch(H){const G=H instanceof Error?H.message:"Failed to start video stream";console.error("Stream error:",H),L(G),de(),Q(!1)}},de=()=>{S(!1);const H=l[n];H&&(H.getTracks().forEach(G=>G.stop()),c(n)),r.current&&(r.current.pause(),r.current.srcObject&&(r.current.srcObject.getTracks().forEach(ee=>ee.stop()),r.current.srcObject=null),r.current.removeAttribute("src"),r.current.style.display="",r.current.load()),U.current&&(U.current.destroy(),U.current=null),V.current&&(V.current.remove(),V.current=null),Y.current!==null&&(clearInterval(Y.current),Y.current=null),E(!1),L(null),z(""),O.current=0},Pt=async()=>{if(g.current)S(!0);else try{p(!0),await df(),g.current=await jm.load({base:"lite_mobilenet_v2"}),S(!0)}catch(H){console.error("Model loading error:",H);const G=H instanceof Error?H.message:"Failed to load detection model";L(G)}finally{p(!1)}},Mr=H=>{let G=null,ee=PT;for(const[Le,We]of N.current.entries()){const _e=H[0]-We[0],ye=H[1]-We[1],Tt=Math.sqrt(_e*_e+ye*ye);Tt<ee&&(ee=Tt,G=Le)}return G},Vm=async H=>{if(!i.current||!r.current)return;const G=i.current.getContext("2d");if(!G)return;G.clearRect(0,0,G.canvas.width,G.canvas.height);const ee=Date.now(),Le=new Set,We=H.filter(_e=>_e.class==="person"&&_e.score>=_T).sort((_e,ye)=>ye.score-_e.score);for(const _e of We){const ye=_e.bbox,Tt=[ye[0]+ye[2]/2,ye[1]+ye[3]/2],st=Mr(Tt);if(st){Le.add(st),C.current.set(st,ee),N.current.set(st,Tt),await f(st,Tt,ye);const Ft=w.current.get(st)||0;if(ee-Ft>=OT){const ln=await te(V.current||r.current,ye);ln&&(h(st,ln),w.current.set(st,ee))}G.strokeStyle="#00ff00",G.lineWidth=2,G.strokeRect(...ye)}else{const Ft=await d(Tt,ye);Le.add(Ft),C.current.set(Ft,ee),N.current.set(Ft,Tt);const ln=await te(V.current||r.current,ye);ln&&(h(Ft,ln),w.current.set(Ft,ee)),G.strokeStyle="#ff0000",G.lineWidth=2,G.strokeRect(...ye)}}for(const[_e,ye]of C.current.entries())!Le.has(_e)&&ee-ye>FT&&(await m(_e),C.current.delete(_e),N.current.delete(_e))};return ne.useEffect(()=>{let H=null,G=0;const ee=async Le=>{if(!T||!g.current||!i.current){H!==null&&cancelAnimationFrame(H);return}const We=V.current||r.current;if(!We){H=requestAnimationFrame(ee);return}if((We instanceof HTMLVideoElement?We.readyState===We.HAVE_ENOUGH_DATA:We.complete&&We.naturalWidth>0)&&Le-G>=bT)try{const ye=await g.current.detect(We);await Vm(ye),G=Le}catch(ye){console.error("Detection error:",ye)}H=requestAnimationFrame(ee)};return x&&T&&(H=requestAnimationFrame(ee)),()=>{H!==null&&cancelAnimationFrame(H)}},[x,T]),ne.useEffect(()=>{const H=()=>{if(r.current&&i.current){const G=r.current.videoWidth||r.current.clientWidth,ee=r.current.videoHeight||r.current.clientHeight;G&&ee&&(a({width:G,height:ee}),i.current.width=G,i.current.height=ee)}};return r.current&&(r.current.addEventListener("loadedmetadata",H),r.current.addEventListener("playing",H)),()=>{r.current&&(r.current.removeEventListener("loadedmetadata",H),r.current.removeEventListener("playing",H))}},[]),ne.useEffect(()=>()=>{de()},[]),D.jsxs("div",{className:"relative bg-white rounded-lg shadow-lg p-4",children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsxs("div",{children:[D.jsxs("h3",{className:"text-lg font-semibold",children:[e?.type==="webcam"?"Webcam":e?.type==="ip"?"IP Camera":e?.type==="file"?"Video File":"Camera"," ",n]}),F&&D.jsxs("span",{className:"text-sm text-gray-500",children:["Stream type: ",F]})]}),D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx("button",{onClick:j,className:"text-gray-600 hover:text-gray-800 transition-colors",title:_?"Exit fullscreen":"Enter fullscreen",children:_?D.jsx(Cy,{className:"w-5 h-5"}):D.jsx(wy,{className:"w-5 h-5"})}),D.jsx("button",{onClick:t,className:"text-red-500 hover:text-red-700",title:"Remove stream",children:D.jsx(ky,{className:"w-5 h-5"})})]})]}),D.jsxs("div",{ref:s,className:`relative bg-black rounded-lg overflow-hidden ${_?"fixed inset-0 z-50":"aspect-video"}`,children:[D.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,crossOrigin:"anonymous",className:"w-full h-full object-contain"}),D.jsx("canvas",{ref:i,className:"absolute top-0 left-0 w-full h-full pointer-events-none",width:o.width,height:o.height}),(A||y||K)&&D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/75 text-white",children:A?D.jsxs("div",{className:"flex items-center gap-2 text-red-500",children:[D.jsx(R0,{className:"w-5 h-5"}),D.jsx("p",{className:"text-center px-4",children:A})]}):K?D.jsx("p",{className:"text-blue-400",children:"Initializing stream..."}):D.jsx("p",{className:"text-blue-400",children:"Loading detection model..."})})]}),D.jsx("div",{className:"mt-4 flex justify-center",children:D.jsx("button",{onClick:x?de:ce,disabled:y||K,className:`flex items-center gap-2 px-4 py-2 rounded-lg ${x?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"} text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,children:x?D.jsxs(D.Fragment,{children:[D.jsx(by,{className:"w-5 h-5"}),"Stop Stream"]}):K?D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Initializing..."]}):D.jsxs(D.Fragment,{children:[D.jsx(I0,{className:"w-5 h-5"}),"Start Stream"]})})})]})},UT=()=>{const[n,e]=ne.useState([{id:"camera-1",source:{type:"webcam"}}]),[t,r]=ne.useState(!1),i=o=>{const a=`stream-${n.length+1}`;e(l=>[...l,{id:a,source:o||{type:"webcam"}}]),r(!1)},s=o=>{e(a=>a.filter(l=>l.id!==o))};return D.jsxs("div",{className:"space-y-6",children:[D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[D.jsx(Ty,{className:"w-6 h-6 text-blue-500"}),"Video Streams"]}),D.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[D.jsx(_y,{className:"w-5 h-5"}),"Add Stream"]})]}),t&&D.jsx(uv,{onSourceSelected:i}),D.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:n.map(({id:o,source:a})=>D.jsx(MT,{id:o,source:a,onRemove:()=>s(o)},o))})]})},BT=()=>{const{customers:n}=_u(),e=async()=>{let t=`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Analytics Export - ${new Date().toLocaleString()}</title>
        <style>
          body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
          }
          .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
          }
          h1 {
            color: #2563eb;
            margin-bottom: 20px;
          }
          table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
          }
          th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
          }
          th {
            background: #f8fafc;
            font-weight: 600;
            color: #4b5563;
          }
          tr:hover {
            background: #f8fafc;
          }
          .snapshot {
            max-width: 200px;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
          }
          .status {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
          }
          .status-active {
            background: #dcfce7;
            color: #166534;
          }
          .status-left {
            background: #f3f4f6;
            color: #4b5563;
          }
          .download-csv {
            display: inline-block;
            margin-top: 20px;
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 0.875rem;
          }
          .download-csv:hover {
            background: #1d4ed8;
          }
          .meta {
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 20px;
          }
        </style>
      </head>
      <body>
        <div class="container">
          <h1>Analytics Export</h1>
          <div class="meta">
            <div>Generated: ${new Date().toLocaleString()}</div>
            <div>Total Records: ${n.length}</div>
          </div>
          <table>
            <thead>
              <tr>
                <th>Customer ID</th>
                <th>First Seen</th>
                <th>Last Seen</th>
                <th>Time Spent</th>
                <th>Status</th>
                <th>Snapshot</th>
              </tr>
            </thead>
            <tbody>
    `;for(const o of n){const a=Math.floor((o.lastSeen.getTime()-o.firstSeen.getTime())/1e3);t+=`
        <tr>
          <td>${o.id.slice(0,8)}</td>
          <td>${o.firstSeen.toLocaleString()}</td>
          <td>${o.lastSeen.toLocaleString()}</td>
          <td>${Math.floor(a/60)}m ${a%60}s</td>
          <td>
            <span class="status ${o.isActive?"status-active":"status-left"}">
              ${o.isActive?"Active":"Left"}
            </span>
          </td>
          <td>
            ${o.snapshot?`<img src="${o.snapshot}" class="snapshot" alt="Customer snapshot">`:"No snapshot available"}
          </td>
        </tr>
      `}t+=`
            </tbody>
          </table>
        </div>
      </body>
      </html>
    `;const r=new Blob([t],{type:"text/html"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`analytics_${new Date().toISOString()}.html`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)};return D.jsxs("button",{onClick:e,className:"flex items-center gap-2 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-colors",children:[D.jsx(Ay,{className:"w-5 h-5"}),"Export Report"]})},$T=()=>{const{customers:n}=_u(),e=n.filter(o=>o.isActive).length,t=n.length,r=o=>(o.isActive?new Date:o.lastSeen).getTime()-o.firstSeen.getTime(),i=()=>{if(n.length===0)return 0;const o=n.map(a=>r(a));return Math.round(o.reduce((a,l)=>a+l,0)/o.length)},s=o=>{const a=Math.floor(o/1e3),l=Math.floor(a/60),u=a%60;return`${l}m ${u.toString().padStart(2,"0")}s`};return D.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200",children:[D.jsx("div",{className:"p-4 border-b border-slate-200",children:D.jsxs("div",{className:"flex justify-between items-center",children:[D.jsx("h2",{className:"text-lg font-semibold text-slate-800",children:"Real-time Analytics"}),D.jsx(BT,{})]})}),D.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 p-4",children:[D.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-lg p-4 text-white",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx(Fy,{className:"w-6 h-6 opacity-80"}),e>0?D.jsx(sa,{className:"w-5 h-5"}):D.jsx(Sy,{className:"w-5 h-5"})]}),D.jsx("p",{className:"text-3xl font-bold mt-2",children:e}),D.jsx("p",{className:"text-indigo-100 text-sm",children:"Current People"})]}),D.jsxs("div",{className:"bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-lg p-4 text-white",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx(Ry,{className:"w-6 h-6 opacity-80"}),D.jsx(sa,{className:"w-5 h-5"})]}),D.jsx("p",{className:"text-3xl font-bold mt-2",children:t}),D.jsx("p",{className:"text-emerald-100 text-sm",children:"Total Detected"})]}),D.jsxs("div",{className:"bg-gradient-to-br from-violet-500 to-violet-600 rounded-lg p-4 text-white",children:[D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsx(Ly,{className:"w-6 h-6 opacity-80"}),D.jsx(sa,{className:"w-5 h-5"})]}),D.jsx("p",{className:"text-3xl font-bold mt-2",children:s(i())}),D.jsx("p",{className:"text-violet-100 text-sm",children:"Average Time"})]})]}),D.jsx("div",{className:"p-4",children:D.jsx("div",{className:"overflow-x-auto",children:D.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[D.jsx("thead",{children:D.jsxs("tr",{children:[D.jsx("th",{className:"px-4 py-3 bg-slate-50 text-left text-xs font-medium text-slate-500 uppercase tracking-wider rounded-tl-lg",children:"ID"}),D.jsx("th",{className:"px-4 py-3 bg-slate-50 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Status"}),D.jsx("th",{className:"px-4 py-3 bg-slate-50 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Time Present"}),D.jsx("th",{className:"px-4 py-3 bg-slate-50 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"First Seen"}),D.jsx("th",{className:"px-4 py-3 bg-slate-50 text-left text-xs font-medium text-slate-500 uppercase tracking-wider rounded-tr-lg",children:"Last Seen"})]})}),D.jsxs("tbody",{className:"bg-white divide-y divide-slate-200",children:[n.map((o,a)=>D.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[D.jsx("td",{className:"px-4 py-3 text-sm font-medium text-slate-900",children:o.id.slice(0,8)}),D.jsx("td",{className:"px-4 py-3",children:D.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.isActive?"bg-emerald-100 text-emerald-800":"bg-slate-100 text-slate-800"}`,children:o.isActive?"Present":"Left"})}),D.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:s(r(o))}),D.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:o.firstSeen.toLocaleTimeString()}),D.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:o.isActive?"Now":o.lastSeen.toLocaleTimeString()})]},o.id)),n.length===0&&D.jsx("tr",{children:D.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-slate-500",children:"No data available yet"})})]})]})})})]})};function GT(){return D.jsxs("div",{className:"min-h-screen bg-slate-100",children:[D.jsx("header",{className:"bg-white border-b border-slate-200",children:D.jsx("div",{className:"max-w-[2000px] mx-auto px-4 py-3",children:D.jsxs("div",{className:"flex items-center gap-2",children:[D.jsx(Dy,{className:"w-8 h-8 text-indigo-600"}),D.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"AI Analyzer"})]})})}),D.jsx("main",{className:"max-w-[2000px] mx-auto px-4 py-6",children:D.jsxs("div",{className:"grid lg:grid-cols-[2fr,1fr] gap-6",children:[D.jsx("section",{className:"space-y-6",children:D.jsx(UT,{})}),D.jsx("section",{className:"lg:max-h-[calc(100vh-6rem)] lg:overflow-y-auto lg:sticky lg:top-6",children:D.jsx($T,{})})]})})]})}A0(document.getElementById("root")).render(D.jsx(ne.StrictMode,{children:D.jsx(GT,{})}));
